{"version":3,"file":"useMemoizedStyles.web.js","sources":["../../../../../../../src/components/Box/BaseBox/useMemoizedStyles.web.ts"],"sourcesContent":["import React from 'react';\nimport type { CSSObject } from 'styled-components';\nimport { getBaseBoxStyles } from './baseBoxStyles';\nimport type { BaseBoxProps } from './types';\nimport type { Theme } from '~components/BladeProvider';\nimport { useTheme } from '~components/BladeProvider';\nimport type { ColorSchemeNames } from '~tokens/theme';\nimport { logger } from '~utils/logger';\n\nconst getMemoDependency = (\n  props: BaseBoxProps & { theme?: Theme } & { colorScheme: ColorSchemeNames },\n): string | BaseBoxProps => {\n  // These are the props that change nothing in the getBaseBoxStyles calculations\n  const { theme, colorScheme, children, className, id, ...rest } = props;\n  let dependencyPropString: string | BaseBoxProps = '';\n  try {\n    // I know this looks illegal but Dan approves it - https://twitter.com/dan_abramov/status/1104414272753487872?s=20\n    // A lot of times passing object to dependency prop isn't efficient and mostly won't work\n    // Hence we JSON.strinfigy and pass the string as dependency prop. React handles this way better.\n    dependencyPropString = `${JSON.stringify(rest)}-${theme?.name}-${colorScheme}`;\n  } catch (err: unknown) {\n    if (__DEV__) {\n      logger({\n        message: `stringification of props failed in BaseBox so falling back to re-calculations on all changes\\n\\n If you see this warning, please create issue on https://github.com/razorpay/blade as this could degrade runtime styling performance ${err}`,\n        moduleName: 'BaseBox',\n        type: 'warn',\n      });\n    }\n\n    dependencyPropString = rest;\n  }\n\n  return dependencyPropString;\n};\n\n/**\n * Uses `React.useMemo` to watch over changing dependencies and only calculate `getBaseBoxStyles` when needed.\n *\n * This helps us in not doing the CSS calculations on screen size change or randomly when not required\n *\n * Without memo, the Box style recalculations will run on things like screen size change or randomly during scroll.\n * With memo, it only runs once for each box and then runs when any of the prop changes\n *\n * Checkout: https://github.com/razorpay/blade/pull/1009#discussion_r1113767442 for benchmarks\n */\nconst useMemoizedStyles = (boxProps: BaseBoxProps & { theme: Theme }): CSSObject => {\n  const { colorScheme } = useTheme();\n  const boxPropsMemoDependency = getMemoDependency({ ...boxProps, colorScheme });\n  const boxPropsCSSObject = React.useMemo(\n    () => getBaseBoxStyles({ ...boxProps, theme: boxProps.theme }),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [boxPropsMemoDependency],\n  );\n\n  return boxPropsCSSObject;\n};\n\nexport { useMemoizedStyles, getMemoDependency };\n"],"names":["getMemoDependency","props","theme","colorScheme","children","className","id","rest","_objectWithoutProperties","_excluded","dependencyPropString","concat","JSON","stringify","name","err","logger","message","moduleName","type","useMemoizedStyles","boxProps","_useTheme","useTheme","boxPropsMemoDependency","_objectSpread","boxPropsCSSObject","React","useMemo","getBaseBoxStyles"],"mappings":";;;;;;;;;;;;AASA,IAAMA,iBAAiB,GAAG,SAApBA,iBAAiBA,CACrBC,KAA2E,EACjD;AAC1B;AACA,EAAA,IAAQC,KAAK,GAAoDD,KAAK,CAA9DC,KAAK;IAAEC,WAAW,GAAuCF,KAAK,CAAvDE,WAAW;IAAEC,QAAQ,GAA6BH,KAAK,CAA1CG,QAAQ;IAAEC,SAAS,GAAkBJ,KAAK,CAAhCI,SAAS;IAAEC,EAAE,GAAcL,KAAK,CAArBK,EAAE;AAAKC,IAAAA,IAAI,GAAAC,wBAAA,CAAKP,KAAK,EAAAQ,SAAA,CAAA,CAAA;EACtE,IAAIC,oBAA2C,GAAG,EAAE,CAAA;EACpD,IAAI;AACF;AACA;AACA;IACAA,oBAAoB,GAAA,EAAA,CAAAC,MAAA,CAAMC,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC,EAAAI,GAAAA,CAAAA,CAAAA,MAAA,CAAIT,KAAK,KAAA,IAAA,IAALA,KAAK,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAALA,KAAK,CAAEY,IAAI,EAAAH,GAAAA,CAAAA,CAAAA,MAAA,CAAIR,WAAW,CAAE,CAAA;GAC/E,CAAC,OAAOY,GAAY,EAAE;AACrB,IAAA,IAAI,IAAO,EAAE;AACXC,MAAAA,MAAM,CAAC;AACLC,QAAAA,OAAO,EAAAN,uOAAAA,CAAAA,MAAA,CAA0OI,GAAG,CAAE;AACtPG,QAAAA,UAAU,EAAE,SAAS;AACrBC,QAAAA,IAAI,EAAE,MAAA;AACR,OAAC,CAAC,CAAA;AACJ,KAAA;AAEAT,IAAAA,oBAAoB,GAAGH,IAAI,CAAA;AAC7B,GAAA;AAEA,EAAA,OAAOG,oBAAoB,CAAA;AAC7B,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMU,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAIC,QAAyC,EAAgB;AAClF,EAAA,IAAAC,SAAA,GAAwBC,QAAQ,EAAE;IAA1BpB,WAAW,GAAAmB,SAAA,CAAXnB,WAAW,CAAA;EACnB,IAAMqB,sBAAsB,GAAGxB,iBAAiB,CAAAyB,aAAA,CAAAA,aAAA,KAAMJ,QAAQ,CAAA,EAAA,EAAA,EAAA;AAAElB,IAAAA,WAAW,EAAXA,WAAAA;AAAW,GAAA,CAAE,CAAC,CAAA;AAC9E,EAAA,IAAMuB,iBAAiB,GAAGC,cAAK,CAACC,OAAO,CACrC,YAAA;AAAA,IAAA,OAAMC,gBAAgB,CAAAJ,aAAA,CAAAA,aAAA,KAAMJ,QAAQ,CAAA,EAAA,EAAA,EAAA;MAAEnB,KAAK,EAAEmB,QAAQ,CAACnB,KAAAA;AAAK,KAAA,CAAE,CAAC,CAAA;AAAA,GAAA;AAC9D;EACA,CAACsB,sBAAsB,CACzB,CAAC,CAAA;AAED,EAAA,OAAOE,iBAAiB,CAAA;AAC1B;;;;"}