{"version":3,"file":"utils.js","sources":["../../../../../../src/components/SpotlightPopoverTour/utils.ts"],"sourcesContent":["/* eslint-disable consistent-return */\n/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\n/* eslint-disable one-var */\n/* eslint-disable prefer-const */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport React from 'react';\nimport { usePrevious } from '~utils';\nimport { throwBladeError } from '~utils/logger';\nimport { useScrollLock } from '~utils/useScrollLock';\n\n/**\n * Hook to delay the state change\n *\n * This is used to delay the active step change to allow for transitions to finish\n * This prevents the popover's footer from changing it's JSX while it's transitioning\n */\nfunction useDelayedState<T>(\n  initialState: T,\n  delay: number,\n): [T, React.Dispatch<React.SetStateAction<T>>] {\n  const [delayedState, _setDelayedState] = React.useState(initialState);\n  const timeoutRef = React.useRef<number | undefined>(undefined);\n\n  React.useEffect(() => {\n    timeoutRef.current = window.setTimeout(() => {\n      _setDelayedState(initialState);\n    }, delay);\n\n    return () => {\n      window.clearTimeout(timeoutRef.current);\n    };\n  }, [delay, initialState]);\n\n  const setDelayedState = React.useCallback((newState: React.SetStateAction<T>) => {\n    _setDelayedState(newState);\n    window.clearTimeout(timeoutRef.current);\n  }, []);\n\n  return [delayedState, setDelayedState];\n}\n\n/**\n * Keep track of when we are transitioning between steps\n *\n * This is used to prevent the popover from jumping to the next step before animations are finished\n */\nconst useIsTransitioningBetweenSteps = (activeStep: number, transitionDelay: number) => {\n  const prevActiveStep = usePrevious(activeStep);\n  const [isTransitioning, setIsTransitioning] = React.useState(false);\n\n  // Keep track of when we are transitioning between steps\n  React.useEffect(() => {\n    if (prevActiveStep === undefined) return;\n    setIsTransitioning(true);\n    const timeout = setTimeout(() => {\n      setIsTransitioning(false);\n    }, transitionDelay);\n\n    return () => {\n      clearTimeout(timeout);\n    };\n  }, [prevActiveStep, transitionDelay]);\n\n  return isTransitioning;\n};\n\n// https://stackoverflow.com/questions/46795955/how-to-know-scroll-to-element-is-done-in-javascript\nfunction smoothScroll(element: Element | null, options: ScrollIntoViewOptions) {\n  return new Promise((resolve) => {\n    if (__DEV__) {\n      if (!(element instanceof Element)) {\n        throwBladeError({\n          moduleName: 'smoothScroll',\n          message: 'argument \"element\" must be an instance of Element',\n        });\n      }\n    }\n\n    let same = 0;\n    let lastPos: undefined | null | number = null;\n    const scrollOptions = { behavior: 'smooth', ...options } as const;\n\n    element!.scrollIntoView(scrollOptions);\n    requestAnimationFrame(check);\n\n    // eslint-disable-next-line consistent-return\n    function check() {\n      const newPos = element?.getBoundingClientRect().top;\n      if (newPos === lastPos) {\n        if (same++ > 2) {\n          return resolve(null);\n        }\n      } else {\n        same = 0;\n        lastPos = newPos;\n      }\n      requestAnimationFrame(check);\n    }\n  });\n}\n\nfunction useIntersectionObserver(\n  elementRef: React.RefObject<Element>,\n  { threshold = 0, root = null, rootMargin = '0%' }: IntersectionObserverInit,\n): IntersectionObserverEntry | undefined {\n  const [entry, setEntry] = React.useState<IntersectionObserverEntry>();\n\n  const updateEntry = ([entry]: IntersectionObserverEntry[]): void => {\n    setEntry(entry);\n  };\n\n  React.useEffect(() => {\n    const node = elementRef?.current; // DOM Ref\n    const hasIOSupport = !!window.IntersectionObserver;\n\n    if (!hasIOSupport || !node) return;\n\n    const observerParams = { threshold, root, rootMargin };\n    const observer = new IntersectionObserver(updateEntry, observerParams);\n\n    observer.observe(node);\n\n    return () => observer.disconnect();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [elementRef?.current, JSON.stringify(threshold), root, rootMargin]);\n\n  return entry;\n}\n\nconst useLockBodyScroll = (shouldLock: boolean) => {\n  const scrollLockRef = useScrollLock({\n    enabled: true,\n    reserveScrollBarGap: true,\n  });\n\n  React.useEffect(() => {\n    const lockRef = scrollLockRef.current;\n    if (shouldLock) {\n      lockRef.activate();\n    } else {\n      lockRef.deactivate();\n    }\n    return () => {\n      lockRef.deactivate();\n    };\n  }, [shouldLock, scrollLockRef]);\n};\n\nexport {\n  useDelayedState,\n  useIsTransitioningBetweenSteps,\n  smoothScroll,\n  useIntersectionObserver,\n  useLockBodyScroll,\n};\n"],"names":["useDelayedState","initialState","delay","_React$useState","React","useState","_React$useState2","_slicedToArray","delayedState","_setDelayedState","timeoutRef","useRef","undefined","useEffect","current","window","setTimeout","clearTimeout","setDelayedState","useCallback","newState","useIsTransitioningBetweenSteps","activeStep","transitionDelay","prevActiveStep","usePrevious","_React$useState3","_React$useState4","isTransitioning","setIsTransitioning","timeout","smoothScroll","element","options","Promise","resolve","Element","throwBladeError","moduleName","message","same","lastPos","scrollOptions","_objectSpread","behavior","scrollIntoView","requestAnimationFrame","check","newPos","getBoundingClientRect","top","useIntersectionObserver","elementRef","_ref","_ref$threshold","threshold","_ref$root","root","_ref$rootMargin","rootMargin","_React$useState5","_React$useState6","entry","setEntry","updateEntry","_ref2","_ref3","node","hasIOSupport","IntersectionObserver","observerParams","observer","observe","disconnect","JSON","stringify","useLockBodyScroll","shouldLock","scrollLockRef","useScrollLock","enabled","reserveScrollBarGap","lockRef","activate","deactivate"],"mappings":"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"}