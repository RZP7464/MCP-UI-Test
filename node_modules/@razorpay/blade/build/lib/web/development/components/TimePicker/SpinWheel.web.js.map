{"version":3,"file":"SpinWheel.web.js","sources":["../../../../../../src/components/TimePicker/SpinWheel.web.tsx"],"sourcesContent":["import React, { useRef, useEffect, useMemo } from 'react';\nimport styled from 'styled-components';\nimport type { SpinWheelProps } from './types';\nimport { Text } from '~components/Typography';\nimport BaseBox from '~components/Box/BaseBox';\nimport { useIsMobile } from '~utils/useIsMobile';\nimport { size } from '~tokens/global';\nimport { makeSize } from '~utils/makeSize';\nimport debounce from '~utils/lodashButBetter/debounce';\n\n// Styled scroll container with scroll snap\nconst StyledScrollContainer = styled(BaseBox)`\n  scroll-snap-type: y proximity; /* Changed from mandatory to proximity for smoother scrolling */\n  scroll-behavior: smooth;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  scrollbar-width: none;\n`;\n\n// Styled scroll item with scroll snap\nconst StyledScrollItem = styled(BaseBox)`\n  scroll-snap-align: center;\n  /* Removed scroll-snap-stop: always for smoother interaction */\n`;\n\n/**\n * Reusable SpinWheel component for time selection\n * Creates a scrollable column of values where the center item is selected.\n */\nconst SpinWheel = ({\n  className,\n  values,\n  selectedValue,\n  onChange,\n  activeIndex,\n  onActiveIndexChange,\n  displayValue,\n  scrollContainerRef,\n  tabIndex,\n}: SpinWheelProps): React.ReactElement => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const itemRefs = useRef<(HTMLDivElement | null)[]>([]);\n  const programmaticScrollTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isMobile = useIsMobile();\n\n  // Memoized debounced onChange to avoid jerky scrolling and prevent memory leaks\n  const debouncedOnChange = useMemo(\n    () =>\n      debounce((value: string | number, index: number) => {\n        onChange(value, index);\n      }, 150),\n    [onChange],\n  );\n\n  // Flag to prevent onValueChange from being triggered during auto-positioning\n  // Problem: When minuteStep > 1 and user types \"03\", we auto-position to nearest step \"00\"\n  // This programmatic scroll triggers handleScroll -> onValueChange -> changes value from \"03\" to \"00\"\n  // But we want to preserve the typed value \"03\" and only visually position at \"00\"\n  // Solution: Set this flag during programmatic scrolls to prevent onValueChange calls\n  // preserving user's typed value while showing correct visual positioning\n  const isProgrammaticScroll = useRef(false);\n\n  // Use displayValue for visual positioning, selectedValue for actual data\n  // This supports minute steps: user types \"03\", displayValue shows \"00\" for positioning,\n  // but selectedValue preserves \"03\" for form submission\n  const positioningValue = displayValue ?? selectedValue;\n\n  // Auto-scroll to positioned item when dropdown opens or positioning value changes\n  useEffect(() => {\n    // Clear any existing programmatic scroll timeout\n    if (programmaticScrollTimeoutRef.current) {\n      clearTimeout(programmaticScrollTimeoutRef.current);\n    }\n\n    const positionIndex = values.findIndex((val) => String(val) === String(positioningValue));\n    if (positionIndex >= 0 && itemRefs.current[positionIndex]) {\n      isProgrammaticScroll.current = true;\n\n      itemRefs.current[positionIndex]?.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n      });\n\n      // Reset flag after scroll finishes\n      programmaticScrollTimeoutRef.current = setTimeout(() => {\n        isProgrammaticScroll.current = false;\n      }, 300);\n    }\n  }, [positioningValue, values]);\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (programmaticScrollTimeoutRef.current) {\n        clearTimeout(programmaticScrollTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  // Scroll event handler to update selection based on center position\n  const handleScroll = (): void => {\n    if (isProgrammaticScroll.current || !containerRef.current) return;\n\n    // Use document.elementFromPoint for efficient center detection (similar to Carousel)\n    const containerBB = containerRef.current.getBoundingClientRect();\n    const pointX = containerBB.left + containerBB.width * 0.5; // Center horizontally\n    const pointY = containerBB.top + containerBB.height * 0.5; // Center vertically\n\n    const element = document.elementFromPoint(pointX, pointY);\n    const spinWheelItem = element?.closest('[data-item-index]');\n\n    if (!spinWheelItem) return;\n\n    const itemIndex = Number(spinWheelItem.getAttribute('data-item-index'));\n    if (isNaN(itemIndex) || itemIndex < 0 || itemIndex >= values.length) return;\n\n    // Update active index immediately for visual feedback\n    onActiveIndexChange?.(itemIndex);\n\n    // Debounce the actual value change to avoid jerky scrolling\n    debouncedOnChange(values[itemIndex], itemIndex);\n  };\n\n  const handleItemClick = (value: string | number, index: number): void => {\n    // Always allow explicit user selection via click, even when displayValue is present\n    // This lets users choose to override their typed value with a step value if desired\n    onChange(value, index);\n    onActiveIndexChange?.(index);\n  };\n\n  return (\n    <BaseBox\n      className={className}\n      display=\"flex\"\n      flexDirection=\"column\"\n      alignItems=\"center\"\n      width={isMobile ? makeSize(size[82]) : makeSize(size[66])}\n      height={makeSize(size[172])}\n    >\n      <BaseBox position=\"relative\" width=\"100%\" overflow=\"hidden\">\n        {/* Scrollable container */}\n        <StyledScrollContainer\n          ref={(node: HTMLDivElement | null) => {\n            containerRef.current = node;\n            if (typeof scrollContainerRef === 'function') {\n              scrollContainerRef(node);\n            } else if (scrollContainerRef && 'current' in scrollContainerRef) {\n              (scrollContainerRef as React.MutableRefObject<HTMLDivElement | null>).current = node;\n            }\n          }}\n          height=\"100%\"\n          overflowY=\"auto\"\n          onScroll={handleScroll}\n          tabIndex={typeof tabIndex === 'number' ? tabIndex : undefined}\n        >\n          {/* Invisible spacer at top - allows first item to scroll to center */}\n          <BaseBox height=\"68px\" />\n\n          {values.map((value, index) => {\n            // Show visual selection based on positioning value (for smooth minute steps)\n            // but preserve actual selectedValue for form data integrity\n            const isVisuallySelected =\n              activeIndex === index || String(value) === String(positioningValue);\n\n            return (\n              <StyledScrollItem\n                key={`${value}-${index}`}\n                ref={(el) => (itemRefs.current[index] = el)}\n                height=\"34px\"\n                display=\"flex\"\n                alignItems=\"center\"\n                justifyContent=\"center\"\n                onClick={() => handleItemClick(value, index)}\n                style={{ cursor: 'pointer' }}\n                data-item-index={index}\n              >\n                <Text\n                  variant=\"body\"\n                  size={isVisuallySelected ? 'large' : 'medium'}\n                  weight={isVisuallySelected ? 'semibold' : 'regular'}\n                  color={\n                    isVisuallySelected\n                      ? 'interactive.text.gray.normal'\n                      : 'interactive.text.gray.muted'\n                  }\n                  textAlign=\"center\"\n                >\n                  {String(value).padStart(2, '0')}\n                </Text>\n              </StyledScrollItem>\n            );\n          })}\n\n          {/* Invisible spacer at bottom - allows last item to scroll to center */}\n          <BaseBox height=\"68px\" />\n        </StyledScrollContainer>\n      </BaseBox>\n    </BaseBox>\n  );\n};\n\nexport { SpinWheel };\n"],"names":["StyledScrollContainer","styled","BaseBox","withConfig","displayName","componentId","StyledScrollItem","SpinWheel","_ref","className","values","selectedValue","onChange","activeIndex","onActiveIndexChange","displayValue","scrollContainerRef","tabIndex","containerRef","useRef","itemRefs","programmaticScrollTimeoutRef","isMobile","useIsMobile","debouncedOnChange","useMemo","debounce","value","index","isProgrammaticScroll","positioningValue","useEffect","current","clearTimeout","positionIndex","findIndex","val","String","_itemRefs$current$pos","scrollIntoView","behavior","block","setTimeout","handleScroll","containerBB","getBoundingClientRect","pointX","left","width","pointY","top","height","element","document","elementFromPoint","spinWheelItem","closest","itemIndex","Number","getAttribute","isNaN","length","handleItemClick","_jsx","display","flexDirection","alignItems","makeSize","size","children","position","overflow","_jsxs","ref","node","overflowY","onScroll","undefined","map","isVisuallySelected","el","justifyContent","onClick","style","cursor","Text","variant","weight","color","textAlign","padStart","concat"],"mappings":"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"}