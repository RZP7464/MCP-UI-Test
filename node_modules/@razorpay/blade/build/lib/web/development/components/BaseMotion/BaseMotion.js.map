{"version":3,"file":"BaseMotion.js","sources":["../../../../../../src/components/BaseMotion/BaseMotion.tsx"],"sourcesContent":["import React from 'react';\nimport { m as motion, AnimatePresence } from 'framer-motion';\nimport styled from 'styled-components';\nimport { mergeRefs } from '@mantine/hooks';\nimport type { BaseMotionBoxProps, MotionMeta, BaseMotionEntryExitProps } from './types';\nimport { makeAnimationVariables, useMotionVariants } from './baseMotionUtils';\nimport { useAnimateInteractions } from '~components/AnimateInteractions/AnimateInteractionsProvider';\nimport { useStagger } from '~components/Stagger/StaggerProvider';\nimport type { BladeElementRef } from '~utils/types';\nimport { useMemoizedStyles } from '~components/Box/BaseBox/useMemoizedStyles';\nimport type { BoxProps } from '~components/Box';\nimport type { Theme } from '~components/BladeProvider';\n\n// Creating empty styled component so that the final component supports `as` prop\nconst StyledDiv = styled.div((props: BoxProps & { theme: Theme }) => {\n  // We're turning normal div into Box here because our BaseBox does not forward the props to next component which is needed for enhancer component wrapper\n  const boxStyles = useMemoizedStyles(props);\n  return boxStyles;\n});\n\nconst MotionDiv = motion(StyledDiv);\n\nconst _BaseMotionBox = (\n  {\n    children,\n    motionVariants: userMotionVariants,\n    type = 'inout',\n    motionTriggers = ['mount'],\n    animateVisibility,\n    ...rest\n  }: BaseMotionBoxProps,\n  ref: React.Ref<BladeElementRef>,\n): React.ReactElement => {\n  const { isInsideAnimateInteractionsContainer } = useAnimateInteractions();\n  const { isInsideStaggerContainer, staggerType } = useStagger();\n  const shouldSkipAnimationVariables =\n    (isInsideAnimateInteractionsContainer && motionTriggers.includes('on-animate-interactions')) ||\n    isInsideStaggerContainer;\n\n  const animationVariables = shouldSkipAnimationVariables\n    ? {}\n    : makeAnimationVariables(motionTriggers, {\n        animateVisibility,\n      });\n\n  const motionVariants = useMotionVariants(\n    userMotionVariants,\n    isInsideStaggerContainer ? staggerType : type,\n  );\n\n  return (\n    <MotionDiv\n      ref={ref as never}\n      viewport={{ amount: 0.8, once: true }}\n      variants={motionVariants}\n      {...animationVariables}\n      {...rest}\n    >\n      {children}\n    </MotionDiv>\n  );\n};\n\n/**\n * Base motion component that handles animation variables, reduced motion, type and motionTriggers prop, etc\n */\nconst BaseMotionBox = React.forwardRef(_BaseMotionBox);\n\nconst _BaseMotionEnhancerBox: React.ForwardRefRenderFunction<HTMLDivElement, BaseMotionBoxProps> = (\n  { children, ...motionBoxArgs },\n  ref,\n) => {\n  return (\n    <BaseMotionBox\n      // we need the ref of this item in AnimateInteractions to pass down ref that adds focusWithin logic\n      ref={mergeRefs(children.props.ref, ref)}\n      as={children.type}\n      {...motionBoxArgs}\n      // We pass the props of children and not pass the children itself since the `as` prop already renders the children and we don't want to re-render it inside\n      {...children.props}\n    />\n  );\n};\n\n/**\n * Used in AnimateInteraction, Scale, etc\n *\n * Enhances the child to add motion support\n */\nconst BaseMotionEnhancerBox = React.forwardRef(_BaseMotionEnhancerBox);\n\n/**\n * Base component for entry / exit animations\n *\n * Handles states, entry exit controls, animation variables, mount / unmount, etc\n */\nconst BaseMotionEntryExit = ({\n  children,\n  motionVariants,\n  isVisible = true,\n  type = 'inout',\n  motionTriggers = ['mount'],\n  shouldUnmountWhenHidden = false,\n}: BaseMotionEntryExitProps): React.ReactElement => {\n  // Only need AnimatePresence when we have to unmount the component\n  const AnimateWrapper = shouldUnmountWhenHidden ? AnimatePresence : React.Fragment;\n  // keep it always mounted when shouldUnmountWhenHidden is false\n  const isMounted = shouldUnmountWhenHidden ? isVisible : true;\n\n  const motionMeta: MotionMeta = React.useMemo(() => {\n    return {\n      isEnhanced: true,\n      // @ts-expect-error: ref does exist on children prop\n      innerRef: children.ref,\n    };\n    // @ts-expect-error: ref does exist on children prop\n  }, [children.ref]);\n\n  return (\n    <AnimateWrapper>\n      {isMounted ? (\n        <BaseMotionBox\n          as={children.type}\n          motionVariants={motionVariants}\n          motionTriggers={motionTriggers}\n          type={type}\n          {...(shouldUnmountWhenHidden\n            ? {}\n            : { animateVisibility: isVisible ? 'animate' : 'exit' })}\n          // We pass the props of children and not pass the children itself since the `as` prop already renders the children and we don't want to re-render it inside\n          {...children.props}\n          _motionMeta={motionMeta}\n        />\n      ) : null}\n    </AnimateWrapper>\n  );\n};\n\nexport { MotionDiv, BaseMotionBox, BaseMotionEnhancerBox, BaseMotionEntryExit };\n"],"names":["StyledDiv","styled","div","withConfig","displayName","componentId","props","boxStyles","useMemoizedStyles","MotionDiv","motion","_BaseMotionBox","_ref","ref","children","userMotionVariants","motionVariants","_ref$type","type","_ref$motionTriggers","motionTriggers","animateVisibility","rest","_objectWithoutProperties","_excluded","_useAnimateInteractio","useAnimateInteractions","isInsideAnimateInteractionsContainer","_useStagger","useStagger","isInsideStaggerContainer","staggerType","shouldSkipAnimationVariables","includes","animationVariables","makeAnimationVariables","useMotionVariants","_jsx","_objectSpread","viewport","amount","once","variants","BaseMotionBox","React","forwardRef","_BaseMotionEnhancerBox","_ref2","motionBoxArgs","_excluded2","mergeRefs","as","BaseMotionEnhancerBox","BaseMotionEntryExit","_ref3","_ref3$isVisible","isVisible","_ref3$type","_ref3$motionTriggers","_ref3$shouldUnmountWh","shouldUnmountWhenHidden","AnimateWrapper","AnimatePresence","Fragment","isMounted","motionMeta","useMemo","isEnhanced","innerRef","_motionMeta"],"mappings":"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"}