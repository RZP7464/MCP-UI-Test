{"version":3,"file":"useBreakpoint.js","sources":["../../../../../../src/utils/useBreakpoint/useBreakpoint.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/restrict-plus-operands */\nimport { useState, useCallback, useMemo } from 'react';\nimport { getPlatformType } from '../getPlatformType';\nimport { getMediaQuery } from '../getMediaQuery';\nimport type { Breakpoints } from '~tokens/global';\nimport { useIsomorphicLayoutEffect } from '~utils/useIsomorphicLayoutEffect';\n\nconst deviceType = {\n  desktop: 'desktop',\n  mobile: 'mobile',\n} as const;\n\ntype DeviceType = keyof typeof deviceType;\ntype Breakpoint = keyof Breakpoints | undefined;\n\ntype BreakpointAndDevice = {\n  matchedBreakpoint: Breakpoint;\n  matchedDeviceType: DeviceType;\n};\n\nexport const useBreakpoint = ({\n  breakpoints,\n}: {\n  breakpoints: Breakpoints;\n}): BreakpointAndDevice => {\n  const supportsMatchMedia =\n    typeof document !== 'undefined' &&\n    typeof window !== 'undefined' &&\n    typeof window?.matchMedia === 'function';\n\n  const breakpointsTokenAndQueryCollection = useMemo(\n    () =>\n      (supportsMatchMedia\n        ? Object.entries(breakpoints).map(([token, screenSize], index, breakpointsArray) => {\n            const min = screenSize;\n            const maxValue = breakpointsArray[index + 1]?.[1];\n            const mediaQuery = getMediaQuery({ min, max: maxValue ? maxValue - 1 : undefined });\n            return { token, screenSize, mediaQuery };\n          })\n        : []) as {\n        token: keyof Breakpoints;\n        screenSize: number;\n        mediaQuery: string;\n      }[],\n    [breakpoints, supportsMatchMedia],\n  );\n\n  const getMatchedDeviceType = useCallback((matchedBreakpoint: Breakpoint): DeviceType => {\n    let matchedDeviceType: DeviceType = deviceType.mobile;\n    const platform = getPlatformType();\n    if (platform === 'react-native') {\n      matchedDeviceType = deviceType.mobile;\n    } else if (platform === 'browser') {\n      if (matchedBreakpoint && ['base', 'xs', 's'].includes(matchedBreakpoint)) {\n        // tablet is also categorised as mobile\n        matchedDeviceType = deviceType.mobile;\n      } else {\n        matchedDeviceType = deviceType.desktop;\n      }\n    } else if (platform === 'node') {\n      //@TODO: Check for useragent for node\n      matchedDeviceType = deviceType.desktop;\n    }\n    return matchedDeviceType;\n  }, []);\n\n  const getMatchedBreakpoint = useCallback(\n    (event?: MediaQueryListEvent): Breakpoint => {\n      const matchedBreakpoint =\n        breakpointsTokenAndQueryCollection.find(({ mediaQuery = '' }) => {\n          // this will run whenever mediaQuery change event is triggered\n          if (event?.media === mediaQuery) {\n            return true;\n          }\n\n          // this will run when the state is initialised for the first time and hence the event object will be empty because the event listener wouldn't have triggered\n          if (window.matchMedia(mediaQuery).matches) {\n            return true;\n          }\n\n          return false;\n        })?.token ?? undefined;\n\n      return matchedBreakpoint;\n    },\n    [breakpointsTokenAndQueryCollection],\n  );\n\n  const [breakpointAndDevice, setBreakpointAndDevice] = useState<BreakpointAndDevice>({\n    matchedBreakpoint: undefined,\n    matchedDeviceType: deviceType.desktop,\n  });\n\n  useIsomorphicLayoutEffect(() => {\n    // set the breakpoint and devicetype for the first time because eventlisteners will only trigger after the screen is actually changed\n    setBreakpointAndDevice(() => {\n      const matchedBreakpoint = getMatchedBreakpoint();\n      const matchedDeviceType = getMatchedDeviceType(matchedBreakpoint);\n      return { matchedBreakpoint, matchedDeviceType };\n    });\n\n    // for react-native and SSR we don't need to register event listeners\n    if (!supportsMatchMedia) {\n      return undefined;\n    }\n\n    const handleMediaQueryChange = (event: MediaQueryListEvent): void => {\n      setBreakpointAndDevice(() => {\n        const matchedBreakpoint = getMatchedBreakpoint(event);\n        const matchedDeviceType = getMatchedDeviceType(matchedBreakpoint);\n        return { matchedBreakpoint, matchedDeviceType };\n      });\n    };\n\n    const mediaQueryInstances = breakpointsTokenAndQueryCollection.map(({ mediaQuery = '' }) => {\n      const mediaQueryInstance = window.matchMedia(mediaQuery);\n      /**\n       * the mediaquery event listener is available on mediaQuery instances and not `window`\n       * we iterate over all the breakpoints we have, register each instance and store them as `mediaQueryInstances` so we can later unregister all of them.\n       */\n      if (mediaQueryInstance.addEventListener) {\n        mediaQueryInstance.addEventListener('change', handleMediaQueryChange);\n      } else {\n        // In older browsers MediaQueryList do not yet inherit from EventTarget, So using addListener as fallback - https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/addListener\n        mediaQueryInstance.addListener(handleMediaQueryChange);\n      }\n      return mediaQueryInstance;\n    });\n\n    return (): void => {\n      mediaQueryInstances.forEach((mediaQueryInstance) => {\n        if (mediaQueryInstance.removeEventListener) {\n          mediaQueryInstance.removeEventListener('change', handleMediaQueryChange);\n        } else {\n          // In older browsers MediaQueryList do not yet inherit from EventTarget, So using removeListener as fallback - https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/removeListener\n          mediaQueryInstance.removeListener(handleMediaQueryChange);\n        }\n      });\n    };\n  }, [\n    breakpointsTokenAndQueryCollection,\n    getMatchedBreakpoint,\n    getMatchedDeviceType,\n    supportsMatchMedia,\n  ]);\n  return breakpointAndDevice;\n};\n\nexport type { DeviceType };\n"],"names":["deviceType","desktop","mobile","useBreakpoint","_ref","_window","breakpoints","supportsMatchMedia","document","window","matchMedia","breakpointsTokenAndQueryCollection","useMemo","Object","entries","map","_ref2","index","breakpointsArray","_breakpointsArray","_ref3","_slicedToArray","token","screenSize","min","maxValue","mediaQuery","getMediaQuery","max","undefined","getMatchedDeviceType","useCallback","matchedBreakpoint","matchedDeviceType","platform","getPlatformType","includes","getMatchedBreakpoint","event","_breakpointsTokenAndQ","_breakpointsTokenAndQ2","find","_ref4","_ref4$mediaQuery","media","matches","_useState","useState","_useState2","breakpointAndDevice","setBreakpointAndDevice","useIsomorphicLayoutEffect","handleMediaQueryChange","mediaQueryInstances","_ref5","_ref5$mediaQuery","mediaQueryInstance","addEventListener","addListener","forEach","removeEventListener","removeListener"],"mappings":"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"}