{"version":3,"file":"bladeCoverage.js","sources":["../../../../../src/utils/bladeCoverage.ts"],"sourcesContent":["const getBladeCoverage = (): {\n  bladeCoverage: number;\n  totalNodes: number;\n  bladeNodes: number;\n} => {\n  /**\n   * Checks if DOM node is hidden or not\n   */\n  const isElementHidden = (element: Element): boolean => {\n    if (element.parentElement && isElementHidden(element.parentElement)) {\n      return true;\n    }\n    if (!(element instanceof HTMLElement)) {\n      return false;\n    }\n    if (element.hidden) {\n      return true;\n    }\n    const style = getComputedStyle(element);\n    return style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0';\n  };\n\n  /**\n   * Checks if DOM node is a media element or not\n   */\n  const isMediaElement = (element: Element): boolean => {\n    const mediaTags = ['img', 'video', 'audio', 'source', 'picture'];\n    return mediaTags.includes(element.tagName.toLowerCase());\n  };\n\n  /**\n   * Checks if DOM element is empty or not\n   */\n  const isElementEmpty = (element: Element): boolean => {\n    if (!element) return true;\n    if (!element.childNodes.length) {\n      return true;\n    }\n    return false;\n  };\n\n  const allDomElements = document.querySelectorAll('body *');\n\n  const bladeNodeElements = [];\n  const totalNodeElements = [];\n\n  allDomElements.forEach((elm) => {\n    if (isElementHidden(elm)) return;\n    if (isElementEmpty(elm)) return;\n    if (isMediaElement(elm)) return;\n\n    // skip svg nodes but not blade icons\n    const closestSvgNode = elm.closest('svg');\n    // if this is a blade icon then add it\n    if (elm.tagName.toLocaleLowerCase() === 'svg' && elm.hasAttribute('data-blade-component')) {\n      bladeNodeElements.push(elm);\n      totalNodeElements.push(elm);\n      return;\n    }\n    // if it's a svg node inside a blade icon then skip it\n    if (closestSvgNode?.getAttribute('data-blade-component') === 'icon') {\n      return;\n    }\n    // if it's a svg node but not a blade icon then skip it\n    if (closestSvgNode && !elm.hasAttribute('data-blade-component')) {\n      return;\n    }\n\n    totalNodeElements.push(elm);\n\n    // If element has data-blade-component add it\n    if (elm.hasAttribute('data-blade-component')) {\n      bladeNodeElements.push(elm);\n    }\n  });\n\n  const totalNodes = totalNodeElements.length;\n  const bladeNodes = bladeNodeElements.length;\n  let bladeCoverage = Number(((bladeNodes / totalNodes) * 100).toFixed(2));\n  // NaN guard\n  if (totalNodes === 0) {\n    bladeCoverage = 0;\n  }\n\n  return {\n    bladeCoverage,\n    totalNodes,\n    bladeNodes,\n  };\n};\n\nconst assertBladeCoverage = async ({\n  page,\n  expect,\n  threshold = 70,\n}: {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  page: any;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  expect: any;\n  threshold: number;\n}): Promise<void> => {\n  const { bladeCoverage } = await page.evaluate((coverageFnStr: string) => {\n    // eslint-disable-next-line @typescript-eslint/no-implied-eval, no-new-func\n    const calculateBladeCoverage = new Function(`return (${coverageFnStr})()`);\n    return calculateBladeCoverage();\n  }, getBladeCoverage.toString());\n\n  expect(bladeCoverage).toBeGreaterThanOrEqual(threshold);\n};\n\nmodule.exports = { getBladeCoverage, assertBladeCoverage };\n"],"names":["getBladeCoverage","isElementHidden","element","parentElement","HTMLElement","hidden","style","getComputedStyle","display","visibility","opacity","isMediaElement","mediaTags","includes","tagName","toLowerCase","isElementEmpty","childNodes","length","allDomElements","document","querySelectorAll","bladeNodeElements","totalNodeElements","forEach","elm","closestSvgNode","closest","toLocaleLowerCase","hasAttribute","push","getAttribute","totalNodes","bladeNodes","bladeCoverage","Number","toFixed","assertBladeCoverage","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","page","expect","_ref$threshold","threshold","_yield$page$evaluate","wrap","_context","prev","next","evaluate","coverageFnStr","calculateBladeCoverage","Function","concat","toString","sent","toBeGreaterThanOrEqual","stop","_x","apply","arguments","module","exports"],"mappings":"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"}