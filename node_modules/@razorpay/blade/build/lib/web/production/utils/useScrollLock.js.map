{"version":3,"file":"useScrollLock.js","sources":["../../../../../src/utils/useScrollLock.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-empty-function */\nimport { disableBodyScroll, enableBodyScroll } from 'body-scroll-lock-upgrade';\nimport React from 'react';\n\ntype UseScrollLockProps = {\n  targetRef?: React.RefObject<Element>;\n  enabled: boolean;\n  reserveScrollBarGap: boolean;\n};\n\ntype ScrollLockMethods = {\n  activate: () => void;\n  deactivate: () => void;\n  active: React.MutableRefObject<boolean>;\n};\n\n/**\n * Modified from: https://github.com/stipsan/react-spring-bottom-sheet/blob/main/src/hooks/useScrollLock.tsx\n * Handle scroll locking to ensure a good dragging experience on Android and iOS.\n *\n * On iOS the following may happen if scroll isn't locked:\n * - When dragging the sheet the background gets dragged at the same time.\n * - When dragging the page scroll is also affected, causing the drag to feel buggy and \"slow\".\n *\n * On Android it causes the chrome toolbar to pop down as you drag down, and hide as you drag up.\n * When it's in between two toolbar states it causes the framerate to drop way below 60fps on\n * the bottom sheet drag interaction.\n *\n * This hook does two things\n * - Provides a imparative API to activate and deactivate the body scroll lock\n * - And ensures the activation and deactivation doesn't happen twice for a single target\n */\nexport function useScrollLock({\n  targetRef,\n  enabled,\n  reserveScrollBarGap,\n}: UseScrollLockProps): React.MutableRefObject<ScrollLockMethods> {\n  const active = React.useRef(false);\n  // Imparative functions which users can call\n  const ref = React.useRef<ScrollLockMethods>({\n    activate: () => {\n      throw new TypeError('Tried to activate scroll lock too early');\n    },\n    deactivate: () => {},\n    active,\n  });\n\n  React.useEffect(() => {\n    // if it's disabled we just return NOOP, so the functions do nothing even if called.\n    if (!enabled) {\n      ref.current = { activate: () => {}, deactivate: () => {}, active };\n      return;\n    }\n\n    const target = (targetRef ? targetRef.current : document.body) as HTMLElement;\n    active.current = false;\n\n    ref.current = {\n      activate: () => {\n        // if we are already active do nothig\n        if (active.current) return;\n        // if not, set the active=true so next time this is called we know it's true\n        active.current = true;\n        if (!target) return;\n        disableBodyScroll(target, {\n          allowTouchMove: (el: any) => el.closest('[data-body-scroll-lock-ignore]'),\n          reserveScrollBarGap,\n        });\n      },\n      deactivate: () => {\n        // only deactivate if we are active\n        if (!active.current) return;\n        active.current = false;\n        if (!target) return;\n        enableBodyScroll(target);\n      },\n      active,\n    };\n  }, [enabled, targetRef, reserveScrollBarGap]);\n\n  return ref;\n}\n"],"names":["useScrollLock","_ref","targetRef","enabled","reserveScrollBarGap","active","React","useRef","ref","activate","TypeError","deactivate","useEffect","current","target","document","body","disableBodyScroll","allowTouchMove","el","closest","enableBodyScroll"],"mappings":";;;AAAA;AACA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,aAAaA,CAAAC,IAAA,EAIqC;AAAA,EAAA,IAHhEC,SAAS,GAAAD,IAAA,CAATC,SAAS;IACTC,OAAO,GAAAF,IAAA,CAAPE,OAAO;IACPC,mBAAmB,GAAAH,IAAA,CAAnBG,mBAAmB,CAAA;AAEnB,EAAA,IAAMC,MAAM,GAAGC,cAAK,CAACC,MAAM,CAAC,KAAK,CAAC,CAAA;AAClC;AACA,EAAA,IAAMC,GAAG,GAAGF,cAAK,CAACC,MAAM,CAAoB;AAC1CE,IAAAA,QAAQ,EAAE,SAAVA,QAAQA,GAAQ;AACd,MAAA,MAAM,IAAIC,SAAS,CAAC,yCAAyC,CAAC,CAAA;KAC/D;AACDC,IAAAA,UAAU,EAAE,SAAZA,UAAUA,GAAQ,EAAE;AACpBN,IAAAA,MAAM,EAANA,MAAAA;AACF,GAAC,CAAC,CAAA;EAEFC,cAAK,CAACM,SAAS,CAAC,YAAM;AACpB;IACA,IAAI,CAACT,OAAO,EAAE;MACZK,GAAG,CAACK,OAAO,GAAG;AAAEJ,QAAAA,QAAQ,EAAE,SAAVA,QAAQA,GAAQ,EAAE;AAAEE,QAAAA,UAAU,EAAE,SAAZA,UAAUA,GAAQ,EAAE;AAAEN,QAAAA,MAAM,EAANA,MAAAA;OAAQ,CAAA;AAClE,MAAA,OAAA;AACF,KAAA;IAEA,IAAMS,MAAM,GAAIZ,SAAS,GAAGA,SAAS,CAACW,OAAO,GAAGE,QAAQ,CAACC,IAAoB,CAAA;IAC7EX,MAAM,CAACQ,OAAO,GAAG,KAAK,CAAA;IAEtBL,GAAG,CAACK,OAAO,GAAG;AACZJ,MAAAA,QAAQ,EAAE,SAAVA,QAAQA,GAAQ;AACd;QACA,IAAIJ,MAAM,CAACQ,OAAO,EAAE,OAAA;AACpB;QACAR,MAAM,CAACQ,OAAO,GAAG,IAAI,CAAA;QACrB,IAAI,CAACC,MAAM,EAAE,OAAA;QACbG,iBAAiB,CAACH,MAAM,EAAE;AACxBI,UAAAA,cAAc,EAAE,SAAhBA,cAAcA,CAAGC,EAAO,EAAA;AAAA,YAAA,OAAKA,EAAE,CAACC,OAAO,CAAC,gCAAgC,CAAC,CAAA;AAAA,WAAA;AACzEhB,UAAAA,mBAAmB,EAAnBA,mBAAAA;AACF,SAAC,CAAC,CAAA;OACH;AACDO,MAAAA,UAAU,EAAE,SAAZA,UAAUA,GAAQ;AAChB;AACA,QAAA,IAAI,CAACN,MAAM,CAACQ,OAAO,EAAE,OAAA;QACrBR,MAAM,CAACQ,OAAO,GAAG,KAAK,CAAA;QACtB,IAAI,CAACC,MAAM,EAAE,OAAA;QACbO,gBAAgB,CAACP,MAAM,CAAC,CAAA;OACzB;AACDT,MAAAA,MAAM,EAANA,MAAAA;KACD,CAAA;GACF,EAAE,CAACF,OAAO,EAAED,SAAS,EAAEE,mBAAmB,CAAC,CAAC,CAAA;AAE7C,EAAA,OAAOI,GAAG,CAAA;AACZ;;;;"}