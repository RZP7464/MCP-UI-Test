{"version":3,"file":"CollapsibleBodyContent.web.js","sources":["../../../../../../src/components/Collapsible/CollapsibleBodyContent.web.tsx"],"sourcesContent":["import type { ReactElement, TransitionEventHandler } from 'react';\nimport { useRef } from 'react';\nimport styled from 'styled-components';\nimport { useCollapsible } from './CollapsibleContext';\nimport type { CollapsibleBodyContentProps } from './types';\nimport {\n  getCollapsibleBodyContentBoxProps,\n  getOpacity,\n  getTransitionDuration,\n  getTransitionEasing,\n} from './commonStyles';\nimport { castWebType, makeSize } from '~utils';\nimport { Box } from '~components/Box';\nimport { useDidUpdate } from '~utils/useDidUpdate';\nimport BaseBox from '~components/Box/BaseBox';\n\ntype StyledCollapsibleBodyContentProps = {\n  defaultIsExpanded: boolean;\n  isExpanded: boolean;\n};\n\n/**\n * We can't animate to and from `auto` height, these are used for imperative css transitions.\n * Overall on expanding height will change as: 0px -> Actual height -> auto\n */\nconst HEIGHT_EXPANDED = 'auto';\nconst HEIGHT_COLLAPSED = '0px';\n\nconst StyledCollapsibleBodyContent = styled(BaseBox)<StyledCollapsibleBodyContentProps>((props) => {\n  const { theme, defaultIsExpanded, isExpanded } = props;\n  const transitionDuration = castWebType(getTransitionDuration(theme));\n  const transitionTimingFunction = castWebType(getTransitionEasing(theme));\n\n  return {\n    transitionDuration,\n    transitionTimingFunction,\n    transitionProperty: 'height, opacity',\n    opacity: getOpacity({ isExpanded }),\n    /**\n     * We need height explicitly here for initial styles because the component might be rendered on server,\n     * in which case for expanded items this should be `auto` because we don't know the actual pixel value.\n     *\n     * This is based on `defaultIsExpanded` rather than `isExpanded` because post initial render inline styles take over.\n     * Otherwise, changing `height` both here and in inline styles sometimes causes animation flickers due to styles mismatch.\n     */\n    height: defaultIsExpanded ? HEIGHT_EXPANDED : HEIGHT_COLLAPSED,\n    display: defaultIsExpanded ? 'block' : 'none',\n    overflowY: 'hidden',\n  };\n});\n\nconst CollapsibleBodyContent = ({\n  children,\n  _hasMargin,\n}: CollapsibleBodyContentProps): ReactElement => {\n  const { isExpanded, defaultIsExpanded, direction } = useCollapsible();\n  const collapsibleBodyContentRef = useRef<HTMLDivElement>(null);\n\n  /**\n   * This effect imperatively updates height to make css transitions work:\n   * - for expanded items: auto height -> actual height -> 0px\n   * - for collapsed items: 0px -> actual height -> auto height\n   * - uses `requestAnimationFrame` to set the styles just before the next repaint\n   */\n  useDidUpdate(() => {\n    const collapsibleBodyContentElement = collapsibleBodyContentRef.current;\n\n    if (!collapsibleBodyContentElement) {\n      return;\n    }\n\n    // In collapsed state display is set to none, change it back to block\n    collapsibleBodyContentElement.style.display = 'block';\n    const actualHeight = collapsibleBodyContentElement.scrollHeight;\n\n    if (!isExpanded) {\n      // collapse\n      requestAnimationFrame(() => {\n        collapsibleBodyContentElement.style.height = makeSize(actualHeight);\n\n        requestAnimationFrame(() => {\n          collapsibleBodyContentElement.style.height = makeSize(0);\n        });\n      });\n    } else {\n      // expand\n      requestAnimationFrame(() => {\n        collapsibleBodyContentElement.style.height = makeSize(0);\n\n        requestAnimationFrame(() => {\n          collapsibleBodyContentElement.style.height = makeSize(actualHeight);\n\n          /**\n           * After this we want to wait for the animation to finish\n           * before setting the height back to auto\n           *\n           * `onTransitionEnd` takes over\n           */\n        });\n      });\n    }\n  }, [isExpanded]);\n\n  /**\n   * When expanding, waits for the animation to finish first.\n   * Then sets the height of expanded item to auto from actual height.\n   */\n  const onTransitionEnd: TransitionEventHandler = ({ propertyName }) => {\n    const collapsibleBodyContentElement = collapsibleBodyContentRef.current;\n    if (propertyName === 'height' && collapsibleBodyContentElement) {\n      if (isExpanded) {\n        // Body content has expanded and finished animating at this point\n        requestAnimationFrame(() => {\n          collapsibleBodyContentElement.style.height = HEIGHT_EXPANDED;\n        });\n      } else {\n        // Body content has collapsed\n        requestAnimationFrame(() => {\n          collapsibleBodyContentElement.style.display = 'none';\n        });\n      }\n    }\n  };\n\n  return (\n    <StyledCollapsibleBodyContent\n      ref={collapsibleBodyContentRef}\n      isExpanded={isExpanded}\n      defaultIsExpanded={defaultIsExpanded}\n      onTransitionEnd={onTransitionEnd}\n    >\n      <Box {...getCollapsibleBodyContentBoxProps({ direction, _hasMargin })}>{children}</Box>\n    </StyledCollapsibleBodyContent>\n  );\n};\n\nexport { CollapsibleBodyContent };\n"],"names":["HEIGHT_EXPANDED","HEIGHT_COLLAPSED","StyledCollapsibleBodyContent","styled","BaseBox","withConfig","displayName","componentId","props","theme","defaultIsExpanded","isExpanded","transitionDuration","castWebType","getTransitionDuration","transitionTimingFunction","getTransitionEasing","transitionProperty","opacity","getOpacity","height","display","overflowY","CollapsibleBodyContent","_ref","children","_hasMargin","_useCollapsible","useCollapsible","direction","collapsibleBodyContentRef","useRef","useDidUpdate","collapsibleBodyContentElement","current","style","actualHeight","scrollHeight","requestAnimationFrame","makeSize","onTransitionEnd","_ref2","propertyName","_jsx","ref","Box","_objectSpread","getCollapsibleBodyContentBoxProps"],"mappings":"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"}