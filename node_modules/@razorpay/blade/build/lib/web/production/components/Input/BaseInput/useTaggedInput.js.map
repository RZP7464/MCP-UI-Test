{"version":3,"file":"useTaggedInput.js","sources":["../../../../../../../src/components/Input/BaseInput/useTaggedInput.ts"],"sourcesContent":["import React from 'react';\nimport type { BaseInputProps } from './BaseInput';\nimport type { BladeElementRefWithValue } from '~utils/types';\nimport type { FormInputOnEvent, FormInputOnKeyDownEvent } from '~components/Form/FormTypes';\nimport { getTagsGroup } from '~components/Tag/getTagsGroup';\nimport { isReactNative } from '~utils';\nimport { useControllableState } from '~utils/useControllable';\n\ntype TaggedInputProps = {\n  isTaggedInput?: boolean;\n  tags?: string[];\n  onTagChange?: ({ tags }: { tags: string[] }) => void;\n};\n\ntype UseTaggedInputProps = TaggedInputProps &\n  Pick<BaseInputProps, 'isDisabled' | 'onChange' | 'name' | 'value' | 'defaultValue'> & {\n    inputRef: React.RefObject<BladeElementRefWithValue | null>;\n  };\n\ntype UseTaggedInputReturn = {\n  activeTagIndex: number;\n  setActiveTagIndex: (activeTagIndex: number) => void;\n  getTags: ({ size }: { size: NonNullable<BaseInputProps['size']> }) => React.ReactElement[];\n  handleTaggedInputKeydown: (e: FormInputOnKeyDownEvent) => void;\n  handleTaggedInputChange: FormInputOnEvent;\n  handleTagsClear: () => void;\n};\n\nconst useTaggedInput = ({\n  tags,\n  isDisabled,\n  onTagChange,\n  isTaggedInput,\n  inputRef,\n  onChange,\n  name,\n  value,\n  defaultValue,\n}: UseTaggedInputProps): UseTaggedInputReturn => {\n  const [activeTagIndex, setActiveTagIndex] = React.useState(-1);\n  const [inputValueUncontrolled, setInputValueUncontrolled] = React.useState(defaultValue ?? '');\n  const [tagsValue, setTagsValue] = useControllableState({\n    value: tags,\n    defaultValue: [],\n    onChange: (tags) => {\n      onTagChange?.({ tags });\n    },\n  });\n\n  const getNewTagsArray = (indexToRemove: number): string[] => {\n    const currentTags = tagsValue;\n\n    if (!currentTags) {\n      return [];\n    }\n\n    // Check if the index is valid\n    if (indexToRemove < 0 || indexToRemove >= currentTags.length) {\n      return currentTags; // Return the original array\n    }\n\n    // Create a new array without the element at the specified index\n    const newArray = currentTags\n      .slice(0, indexToRemove)\n      .concat(currentTags.slice(indexToRemove + 1));\n\n    return newArray;\n  };\n\n  const getTags = React.useMemo(\n    () => ({ size }: { size: NonNullable<BaseInputProps['size']> }): React.ReactElement[] => {\n      return getTagsGroup({\n        size,\n        tags: tagsValue,\n        activeTagIndex,\n        isDisabled,\n        onDismiss: ({ tagIndex }) => {\n          setTagsValue(() => getNewTagsArray(tagIndex));\n        },\n      });\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [activeTagIndex, tags, tagsValue, isDisabled],\n  );\n\n  const handleTaggedInputChange: FormInputOnEvent = ({ value }) => {\n    if (!isTaggedInput) {\n      return;\n    }\n    setInputValueUncontrolled(value ?? '');\n  };\n\n  const handleTagsClear = (): void => {\n    if (!isTaggedInput) {\n      return;\n    }\n\n    setTagsValue(() => []);\n  };\n\n  const clearInput = (): void => {\n    const isControlledValue = value !== undefined;\n\n    if (isControlledValue) {\n      // In Controlled component, we don't clear input ourselves. We just call onChange with empty value\n      onChange?.({ name, value: '' });\n      return;\n    }\n\n    if (!inputRef.current) {\n      return;\n    }\n\n    setInputValueUncontrolled('');\n\n    if (isReactNative()) {\n      setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/prefer-ts-expect-error\n        // @ts-ignore: clear does exist in react native\n        inputRef.current?.clear();\n      }, 10);\n      return;\n    }\n\n    inputRef.current.value = '';\n  };\n\n  const handleTaggedInputKeydown = (e: FormInputOnKeyDownEvent): void => {\n    if (!isTaggedInput) {\n      return;\n    }\n\n    const currentTags = tagsValue;\n    const isControlledValue = value !== undefined;\n    const inputValue = isControlledValue ? value?.trim() : inputValueUncontrolled.trim();\n    if (e.key === 'Enter' || e.key === ',') {\n      e.event.preventDefault?.(); // we don't want textarea to treat enter as line break in tagged inputs\n      if (inputValue) {\n        setTagsValue(() => [...currentTags, inputValue]);\n        clearInput();\n        setActiveTagIndex(-1);\n      }\n    }\n    if (e.key === 'Backspace' && !inputValue && activeTagIndex < 0 && currentTags.length > 0) {\n      setTagsValue(() => currentTags.slice(0, -1));\n    }\n  };\n\n  return {\n    activeTagIndex,\n    setActiveTagIndex,\n    getTags,\n    handleTaggedInputKeydown,\n    handleTaggedInputChange,\n    handleTagsClear,\n  };\n};\n\nexport type { TaggedInputProps };\nexport { useTaggedInput };\n"],"names":["useTaggedInput","_ref","tags","isDisabled","onTagChange","isTaggedInput","inputRef","onChange","name","value","defaultValue","_React$useState","React","useState","_React$useState2","_slicedToArray","activeTagIndex","setActiveTagIndex","_React$useState3","_React$useState4","inputValueUncontrolled","setInputValueUncontrolled","_useControllableState","useControllableState","_useControllableState2","tagsValue","setTagsValue","getNewTagsArray","indexToRemove","currentTags","length","newArray","slice","concat","getTags","useMemo","_ref2","size","getTagsGroup","onDismiss","_ref3","tagIndex","handleTaggedInputChange","_ref4","handleTagsClear","clearInput","isControlledValue","undefined","current","isReactNative","setTimeout","_inputRef$current","clear","handleTaggedInputKeydown","e","inputValue","trim","key","_e$event$preventDefau","_e$event","event","preventDefault","call","_toConsumableArray"],"mappings":";;;;;;;;AA4BA,IAAMA,cAAc,GAAG,SAAjBA,cAAcA,CAAAC,IAAA,EAU6B;AAAA,EAAA,IAT/CC,IAAI,GAAAD,IAAA,CAAJC,IAAI;IACJC,UAAU,GAAAF,IAAA,CAAVE,UAAU;IACVC,WAAW,GAAAH,IAAA,CAAXG,WAAW;IACXC,aAAa,GAAAJ,IAAA,CAAbI,aAAa;IACbC,QAAQ,GAAAL,IAAA,CAARK,QAAQ;IACRC,QAAQ,GAAAN,IAAA,CAARM,QAAQ;IACRC,IAAI,GAAAP,IAAA,CAAJO,IAAI;IACJC,KAAK,GAAAR,IAAA,CAALQ,KAAK;IACLC,YAAY,GAAAT,IAAA,CAAZS,YAAY,CAAA;EAEZ,IAAAC,eAAA,GAA4CC,cAAK,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;IAAAC,gBAAA,GAAAC,cAAA,CAAAJ,eAAA,EAAA,CAAA,CAAA;AAAvDK,IAAAA,cAAc,GAAAF,gBAAA,CAAA,CAAA,CAAA;AAAEG,IAAAA,iBAAiB,GAAAH,gBAAA,CAAA,CAAA,CAAA,CAAA;AACxC,EAAA,IAAAI,gBAAA,GAA4DN,cAAK,CAACC,QAAQ,CAACH,YAAY,KAAA,IAAA,IAAZA,YAAY,KAAA,KAAA,CAAA,GAAZA,YAAY,GAAI,EAAE,CAAC;IAAAS,gBAAA,GAAAJ,cAAA,CAAAG,gBAAA,EAAA,CAAA,CAAA;AAAvFE,IAAAA,sBAAsB,GAAAD,gBAAA,CAAA,CAAA,CAAA;AAAEE,IAAAA,yBAAyB,GAAAF,gBAAA,CAAA,CAAA,CAAA,CAAA;EACxD,IAAAG,qBAAA,GAAkCC,oBAAoB,CAAC;AACrDd,MAAAA,KAAK,EAAEP,IAAI;AACXQ,MAAAA,YAAY,EAAE,EAAE;AAChBH,MAAAA,QAAQ,EAAE,SAAVA,QAAQA,CAAGL,IAAI,EAAK;AAClBE,QAAAA,WAAW,KAAXA,IAAAA,IAAAA,WAAW,KAAXA,KAAAA,CAAAA,IAAAA,WAAW,CAAG;AAAEF,UAAAA,IAAI,EAAJA,IAAAA;AAAK,SAAC,CAAC,CAAA;AACzB,OAAA;AACF,KAAC,CAAC;IAAAsB,sBAAA,GAAAT,cAAA,CAAAO,qBAAA,EAAA,CAAA,CAAA;AANKG,IAAAA,SAAS,GAAAD,sBAAA,CAAA,CAAA,CAAA;AAAEE,IAAAA,YAAY,GAAAF,sBAAA,CAAA,CAAA,CAAA,CAAA;AAQ9B,EAAA,IAAMG,eAAe,GAAG,SAAlBA,eAAeA,CAAIC,aAAqB,EAAe;IAC3D,IAAMC,WAAW,GAAGJ,SAAS,CAAA;IAE7B,IAAI,CAACI,WAAW,EAAE;AAChB,MAAA,OAAO,EAAE,CAAA;AACX,KAAA;;AAEA;IACA,IAAID,aAAa,GAAG,CAAC,IAAIA,aAAa,IAAIC,WAAW,CAACC,MAAM,EAAE;MAC5D,OAAOD,WAAW,CAAC;AACrB,KAAA;;AAEA;IACA,IAAME,QAAQ,GAAGF,WAAW,CACzBG,KAAK,CAAC,CAAC,EAAEJ,aAAa,CAAC,CACvBK,MAAM,CAACJ,WAAW,CAACG,KAAK,CAACJ,aAAa,GAAG,CAAC,CAAC,CAAC,CAAA;AAE/C,IAAA,OAAOG,QAAQ,CAAA;GAChB,CAAA;AAED,EAAA,IAAMG,OAAO,GAAGtB,cAAK,CAACuB,OAAO,CAC3B,YAAA;IAAA,OAAM,UAAAC,KAAA,EAAmF;AAAA,MAAA,IAAhFC,IAAI,GAAAD,KAAA,CAAJC,IAAI,CAAA;AACX,MAAA,OAAOC,YAAY,CAAC;AAClBD,QAAAA,IAAI,EAAJA,IAAI;AACJnC,QAAAA,IAAI,EAAEuB,SAAS;AACfT,QAAAA,cAAc,EAAdA,cAAc;AACdb,QAAAA,UAAU,EAAVA,UAAU;AACVoC,QAAAA,SAAS,EAAE,SAAXA,SAASA,CAAAC,KAAA,EAAoB;AAAA,UAAA,IAAfC,QAAQ,GAAAD,KAAA,CAARC,QAAQ,CAAA;AACpBf,UAAAA,YAAY,CAAC,YAAA;YAAA,OAAMC,eAAe,CAACc,QAAQ,CAAC,CAAA;WAAC,CAAA,CAAA;AAC/C,SAAA;AACF,OAAC,CAAC,CAAA;KACH,CAAA;AAAA,GAAA;AACD;EACA,CAACzB,cAAc,EAAEd,IAAI,EAAEuB,SAAS,EAAEtB,UAAU,CAC9C,CAAC,CAAA;AAED,EAAA,IAAMuC,uBAAyC,GAAG,SAA5CA,uBAAyCA,CAAAC,KAAA,EAAkB;AAAA,IAAA,IAAZlC,KAAK,GAAAkC,KAAA,CAALlC,KAAK,CAAA;IACxD,IAAI,CAACJ,aAAa,EAAE;AAClB,MAAA,OAAA;AACF,KAAA;IACAgB,yBAAyB,CAACZ,KAAK,KAALA,IAAAA,IAAAA,KAAK,cAALA,KAAK,GAAI,EAAE,CAAC,CAAA;GACvC,CAAA;AAED,EAAA,IAAMmC,eAAe,GAAG,SAAlBA,eAAeA,GAAe;IAClC,IAAI,CAACvC,aAAa,EAAE;AAClB,MAAA,OAAA;AACF,KAAA;AAEAqB,IAAAA,YAAY,CAAC,YAAA;AAAA,MAAA,OAAM,EAAE,CAAA;KAAC,CAAA,CAAA;GACvB,CAAA;AAED,EAAA,IAAMmB,UAAU,GAAG,SAAbA,UAAUA,GAAe;AAC7B,IAAA,IAAMC,iBAAiB,GAAGrC,KAAK,KAAKsC,SAAS,CAAA;AAE7C,IAAA,IAAID,iBAAiB,EAAE;AACrB;AACAvC,MAAAA,QAAQ,KAARA,IAAAA,IAAAA,QAAQ,KAARA,KAAAA,CAAAA,IAAAA,QAAQ,CAAG;AAAEC,QAAAA,IAAI,EAAJA,IAAI;AAAEC,QAAAA,KAAK,EAAE,EAAA;AAAG,OAAC,CAAC,CAAA;AAC/B,MAAA,OAAA;AACF,KAAA;AAEA,IAAA,IAAI,CAACH,QAAQ,CAAC0C,OAAO,EAAE;AACrB,MAAA,OAAA;AACF,KAAA;IAEA3B,yBAAyB,CAAC,EAAE,CAAC,CAAA;IAE7B,IAAI4B,aAAa,EAAE,EAAE;AACnBC,MAAAA,UAAU,CAAC,YAAM;AAAA,QAAA,IAAAC,iBAAA,CAAA;AACf;AACA;AACA,QAAA,CAAAA,iBAAA,GAAA7C,QAAQ,CAAC0C,OAAO,MAAA,IAAA,IAAAG,iBAAA,KAAA,KAAA,CAAA,IAAhBA,iBAAA,CAAkBC,KAAK,EAAE,CAAA;OAC1B,EAAE,EAAE,CAAC,CAAA;AACN,MAAA,OAAA;AACF,KAAA;AAEA9C,IAAAA,QAAQ,CAAC0C,OAAO,CAACvC,KAAK,GAAG,EAAE,CAAA;GAC5B,CAAA;AAED,EAAA,IAAM4C,wBAAwB,GAAG,SAA3BA,wBAAwBA,CAAIC,CAA0B,EAAW;IACrE,IAAI,CAACjD,aAAa,EAAE;AAClB,MAAA,OAAA;AACF,KAAA;IAEA,IAAMwB,WAAW,GAAGJ,SAAS,CAAA;AAC7B,IAAA,IAAMqB,iBAAiB,GAAGrC,KAAK,KAAKsC,SAAS,CAAA;AAC7C,IAAA,IAAMQ,UAAU,GAAGT,iBAAiB,GAAGrC,KAAK,KAAA,IAAA,IAALA,KAAK,KAALA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,KAAK,CAAE+C,IAAI,EAAE,GAAGpC,sBAAsB,CAACoC,IAAI,EAAE,CAAA;IACpF,IAAIF,CAAC,CAACG,GAAG,KAAK,OAAO,IAAIH,CAAC,CAACG,GAAG,KAAK,GAAG,EAAE;MAAA,IAAAC,qBAAA,EAAAC,QAAA,CAAA;AACtC,MAAA,CAAAD,qBAAA,GAAAC,CAAAA,QAAA,GAAAL,CAAC,CAACM,KAAK,EAACC,cAAc,cAAAH,qBAAA,KAAA,KAAA,CAAA,IAAtBA,qBAAA,CAAAI,IAAA,CAAAH,QAAyB,CAAC,CAAC;AAC3B,MAAA,IAAIJ,UAAU,EAAE;AACd7B,QAAAA,YAAY,CAAC,YAAA;AAAA,UAAA,OAAA,EAAA,CAAAO,MAAA,CAAA8B,kBAAA,CAAUlC,WAAW,IAAE0B,UAAU,CAAA,CAAA,CAAA;AAAA,SAAC,CAAC,CAAA;AAChDV,QAAAA,UAAU,EAAE,CAAA;QACZ5B,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAA;AACvB,OAAA;AACF,KAAA;AACA,IAAA,IAAIqC,CAAC,CAACG,GAAG,KAAK,WAAW,IAAI,CAACF,UAAU,IAAIvC,cAAc,GAAG,CAAC,IAAIa,WAAW,CAACC,MAAM,GAAG,CAAC,EAAE;AACxFJ,MAAAA,YAAY,CAAC,YAAA;QAAA,OAAMG,WAAW,CAACG,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAA;OAAC,CAAA,CAAA;AAC9C,KAAA;GACD,CAAA;EAED,OAAO;AACLhB,IAAAA,cAAc,EAAdA,cAAc;AACdC,IAAAA,iBAAiB,EAAjBA,iBAAiB;AACjBiB,IAAAA,OAAO,EAAPA,OAAO;AACPmB,IAAAA,wBAAwB,EAAxBA,wBAAwB;AACxBX,IAAAA,uBAAuB,EAAvBA,uBAAuB;AACvBE,IAAAA,eAAe,EAAfA,eAAAA;GACD,CAAA;AACH;;;;"}