{"version":3,"file":"LiveAnnouncer.web.js","sources":["../../../../../../src/components/LiveAnnouncer/LiveAnnouncer.web.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\n\n// Modified version of @react-aria/live-announcer\n// https://github.com/adobe/react-spectrum/blob/main/packages/@react-aria/live-announcer/src/LiveAnnouncer.tsx\n// LiveAnnouncer is implemented using vanilla DOM, not React.\n// While the spectrum team had their own reasons for using vanillajs,\n// For us:\n// 1. It's significantly easier to maintain & understand LiveAnnouncer code in vanillajs than React.\n//    With React maintaining a singleton instance of LiveAnnouncer is tricky because we need\n//    to save the instance of ReactElement to a top level ref, and then use ReactDOM.render() to render it\n// 2. Providing imperative APIs like `announce()` is also trikcky which involves using lesser known\n//    React hook `useImperativeHandle` to give users imperative access.\n\nimport type { Assertiveness } from './types';\nimport { screenReaderStyles } from '~components/VisuallyHidden/ScreenReaderStyles';\n\nconst LIVEREGION_TIMEOUT_DELAY = 1000;\nlet liveAnnouncer: LiveAnnouncer | null = null;\n\nclass LiveAnnouncer {\n  node: HTMLElement;\n  assertiveLog: HTMLElement;\n  politeLog: HTMLElement;\n\n  constructor() {\n    this.node = document.createElement('div');\n    this.node.dataset.liveAnnouncer = 'true';\n    Object.assign(this.node.style, screenReaderStyles);\n\n    this.assertiveLog = this.createLog('assertive');\n    this.node.appendChild(this.assertiveLog);\n\n    this.politeLog = this.createLog('polite');\n    this.node.appendChild(this.politeLog);\n\n    document.body.prepend(this.node);\n  }\n\n  createLog(ariaLive: string): HTMLDivElement {\n    const node = document.createElement('div');\n    node.setAttribute('role', 'log');\n    node.setAttribute('aria-live', ariaLive);\n    node.setAttribute('aria-relevant', 'additions');\n    return node;\n  }\n\n  destroy(): void {\n    if (!this.node) {\n      return;\n    }\n\n    document.body.removeChild(this.node);\n    // @ts-expect-error\n    this.node = null;\n  }\n\n  announce(message: string, assertiveness: Assertiveness = 'assertive'): void {\n    if (!this.node) {\n      return;\n    }\n\n    const node = document.createElement('div');\n    node.textContent = message;\n\n    if (assertiveness === 'assertive') {\n      this.assertiveLog.appendChild(node);\n    } else {\n      this.politeLog.appendChild(node);\n    }\n\n    if (message !== '') {\n      setTimeout(() => {\n        node.remove();\n      }, LIVEREGION_TIMEOUT_DELAY);\n    }\n  }\n\n  clear(assertiveness: Assertiveness): void {\n    if (!this.node) {\n      return;\n    }\n\n    if (!assertiveness || assertiveness === 'assertive') {\n      this.assertiveLog.innerHTML = '';\n    }\n\n    if (!assertiveness || assertiveness === 'polite') {\n      this.politeLog.innerHTML = '';\n    }\n  }\n}\n\n/**\n * Announces the message using screen reader technology.\n */\nexport function announce(message: string, assertiveness: Assertiveness = 'assertive'): void {\n  if (!liveAnnouncer) {\n    liveAnnouncer = new LiveAnnouncer();\n  }\n\n  liveAnnouncer.announce(message, assertiveness);\n}\n\n/**\n * Stops all queued announcements.\n */\nexport function clearAnnouncer(assertiveness: Assertiveness): void {\n  if (liveAnnouncer) {\n    liveAnnouncer.clear(assertiveness);\n  }\n}\n\n/**\n * Removes the announcer from the DOM.\n */\nexport function destroyAnnouncer(): void {\n  if (liveAnnouncer) {\n    liveAnnouncer.destroy();\n    liveAnnouncer = null;\n  }\n}\n"],"names":["LIVEREGION_TIMEOUT_DELAY","liveAnnouncer","LiveAnnouncer","_classCallCheck","node","document","createElement","dataset","Object","assign","style","screenReaderStyles","assertiveLog","createLog","appendChild","politeLog","body","prepend","_createClass","key","value","ariaLive","setAttribute","destroy","removeChild","announce","message","assertiveness","arguments","length","undefined","textContent","setTimeout","remove","clear","innerHTML","clearAnnouncer","destroyAnnouncer"],"mappings":"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"}