{"version":3,"file":"useDropdown.js","sources":["../../../../../../src/components/Dropdown/useDropdown.ts"],"sourcesContent":["import React from 'react';\n\nimport {\n  ensureScrollVisiblity,\n  getActionFromKey,\n  getIndexByLetter,\n  getUpdatedIndex,\n  makeInputDisplayValue,\n  makeInputValue,\n  performAction,\n} from './dropdownUtils';\nimport type { SelectActionsType } from './dropdownUtils';\nimport type { DropdownProps } from './types';\n\nimport { dropdownComponentIds } from './dropdownComponentIds';\nimport type { FormInputHandleOnKeyDownEvent } from '~components/Form/FormTypes';\nimport { isReactNative, isBrowser } from '~utils';\nimport type { ContainerElementType } from '~utils/types';\nimport { fireNativeEvent } from '~utils/fireNativeEvent';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst noop = (): void => {};\n\ntype OptionsType = {\n  title: string;\n  value: string;\n  onClickTrigger?: (isSelected: boolean) => void;\n}[];\n\ntype DropdownContextType = {\n  isOpen: boolean;\n  setIsOpen: (isOpen: boolean) => void;\n  close: () => void;\n  /**\n   * contains the indexes of selected items\n   */\n  selectedIndices: number[];\n  setSelectedIndices: (value: number[]) => void;\n  /**\n   * contains the indexes of selected items during controlled selection\n   */\n  controlledValueIndices: number[];\n  setControlledValueIndices: (value: number[]) => void;\n  /**\n   * contains information about all the options inside actionlist\n   */\n  options: OptionsType;\n  setOptions: (value: OptionsType) => void;\n\n  /**\n   * Filtered values for AutoComplete Inputs\n   */\n  filteredValues: string[];\n  setFilteredValues: (values: string[]) => void;\n\n  /** Currently active (focussed) index  */\n  activeIndex: number;\n  setActiveIndex: (value: number) => void;\n\n  /** Currently active (focussed) tag  */\n  activeTagIndex: number;\n  setActiveTagIndex: (value: number) => void;\n\n  /**\n   * Sometimes we want to ignore the blur event to keep dropdown open but not ignore the blur animation from selectinput\n   * E.g. When someone clicks on Footer, we just want to ignore the blur event and not the blur animation\n   */\n  shouldIgnoreBlurAnimation: boolean;\n  setShouldIgnoreBlurAnimation: (value: boolean) => void;\n  /** Tells you if keyboard was used. Its false by default and turns into true when keydown is called  */\n  isKeydownPressed: boolean;\n  setIsKeydownPressed: (value: boolean) => void;\n  /** common baseId which is prepended to multiple other ids inside this dropdown  */\n  dropdownBaseId: string;\n  /** Which element has triggered the dropdown */\n  dropdownTriggerer?:\n    | 'SelectInput'\n    | 'DropdownButton'\n    | 'DropdownIconButton'\n    | 'AutoComplete'\n    | 'DropdownLink'\n    | 'SearchInput'\n    | 'FilterChipSelectInput'\n    | 'InputDropdownButton';\n\n  /** ref of triggerer. Used to call focus in certain places */\n  triggererRef: React.MutableRefObject<HTMLButtonElement | null>;\n  headerAutoCompleteRef: React.MutableRefObject<HTMLButtonElement | null>;\n  triggererWrapperRef: React.MutableRefObject<ContainerElementType | null>;\n  actionListItemRef: React.RefObject<HTMLDivElement | null>;\n  isTagDismissedRef: React.RefObject<{ value: boolean } | null>;\n  visibleTagsCountRef: React.RefObject<{ value: number } | null>;\n\n  selectionType?: DropdownProps['selectionType'];\n  /** whether footer has an action item.\n   * certain a11y behaviour changes happen here\n   * E.g. tabbing moves focus to that action instead of outside\n   */\n  hasFooterAction: boolean;\n  setHasFooterAction: (value: boolean) => void;\n\n  /**\n   * Apart from dropdownTriggerer prop, we also set this boolean because in BottomSheetHeader and DropdownHeader, the trigger can be Select but they can also have autocomplete inside of header\n   */\n  hasAutoCompleteInHeader: boolean;\n  setHasAutoCompleteInHeader: (value: boolean) => void;\n\n  /**\n   * A value that can be used in dependency array to know when Dropdown value is changed.\n   *\n   * E.g.\n   * ```ts\n   * useEffect(() => {\n   *  console.log('Uncontrolled value change');\n   * }, [changeCallbackTriggerer])\n   * ```\n   */\n  changeCallbackTriggerer: number;\n  setChangeCallbackTriggerer: (changeCallbackTriggerer: number) => void;\n\n  /**\n   * true when SelectInput has `value` prop (when it is controlled)\n   */\n  isControlled: boolean;\n  setIsControlled: (isControlled: boolean) => void;\n};\n\nconst DropdownContext = React.createContext<DropdownContextType>({\n  isOpen: false,\n  setIsOpen: noop,\n  close: noop,\n  selectedIndices: [],\n  setSelectedIndices: noop,\n  controlledValueIndices: [],\n  setControlledValueIndices: noop,\n  options: [],\n  setOptions: noop,\n  filteredValues: [],\n  setFilteredValues: noop,\n  activeIndex: -1,\n  setActiveIndex: noop,\n  activeTagIndex: -1,\n  setActiveTagIndex: noop,\n  shouldIgnoreBlurAnimation: false,\n  setShouldIgnoreBlurAnimation: noop,\n  hasFooterAction: false,\n  setHasFooterAction: noop,\n  hasAutoCompleteInHeader: false,\n  setHasAutoCompleteInHeader: noop,\n  isKeydownPressed: false,\n  setIsKeydownPressed: noop,\n  changeCallbackTriggerer: 0,\n  setChangeCallbackTriggerer: noop,\n  isControlled: false,\n  setIsControlled: noop,\n  dropdownBaseId: '',\n  actionListItemRef: {\n    current: null,\n  },\n  triggererRef: {\n    current: null,\n  },\n  headerAutoCompleteRef: {\n    current: null,\n  },\n  isTagDismissedRef: {\n    current: null,\n  },\n  visibleTagsCountRef: {\n    current: null,\n  },\n  triggererWrapperRef: {\n    current: null,\n  },\n});\n\nlet searchTimeout: number;\nlet searchString = '';\n\ntype UseDropdownReturnValue = DropdownContextType & {\n  /**\n   * Click event on combobox. Toggles the dropdown\n   */\n  onTriggerClick: () => void;\n\n  /**\n   * Keydown event of combobox. Handles most of the keyboard accessibility of dropdown\n   */\n  onTriggerKeydown: FormInputHandleOnKeyDownEvent | undefined;\n\n  /**\n   * Handles the click even on option.\n   *\n   * Contains the logic that selects the option, moves the focus, etc\n   */\n  onOptionClick: (\n    e: React.MouseEvent<HTMLButtonElement> | React.KeyboardEvent<HTMLInputElement>,\n    index: number,\n  ) => void;\n\n  /**\n   * Removes the option with given optionsIndex\n   */\n  removeOption: (index: number) => void;\n\n  /**\n   * value that is used during form submissions\n   */\n  value: string;\n  /**\n   * This is the value that is displayed inside select after selection\n   */\n  displayValue: string;\n};\n\n/**\n * Handles almost all the functionality of dropdown.\n *\n * Returns the values from DropdownContext along with some helper functions and event handlers\n *\n */\nconst useDropdown = (): UseDropdownReturnValue => {\n  const {\n    isOpen,\n    setIsOpen,\n    close,\n    selectedIndices,\n    setSelectedIndices,\n    activeIndex,\n    setActiveIndex,\n    activeTagIndex,\n    setActiveTagIndex,\n    visibleTagsCountRef,\n    isKeydownPressed,\n    setIsKeydownPressed,\n    options,\n    selectionType,\n    changeCallbackTriggerer,\n    setChangeCallbackTriggerer,\n    isControlled,\n    setControlledValueIndices,\n    filteredValues,\n    dropdownTriggerer,\n    ...rest\n  } = React.useContext(DropdownContext);\n\n  type SelectOptionType = (\n    index: number,\n    properties?: {\n      closeOnSelection?: boolean;\n    },\n  ) => boolean;\n\n  const setIndices = (indices: number[]): void => {\n    if (isControlled) {\n      setControlledValueIndices(indices);\n    } else {\n      setSelectedIndices(indices);\n    }\n  };\n\n  const removeOption = (index: number): void => {\n    // remove existing item\n    const existingItemIndex = selectedIndices.indexOf(index);\n    if (existingItemIndex < 0) {\n      return;\n    }\n\n    setIndices([\n      ...selectedIndices.slice(0, existingItemIndex),\n      ...selectedIndices.slice(existingItemIndex + 1),\n    ]);\n  };\n\n  /**\n   * Marks the given index as selected.\n   *\n   * In single select, it also closes the menu.\n   * In multiselect, it keeps the menu open for more selections\n   */\n  const selectOption: SelectOptionType = (\n    index,\n    properties = {\n      closeOnSelection: true,\n    },\n  ) => {\n    let isSelected = false;\n\n    if (index < 0 || index > options.length - 1) {\n      return isSelected;\n    }\n\n    if (selectionType === 'multiple') {\n      if (selectedIndices.includes(index)) {\n        removeOption(index);\n        isSelected = false;\n      } else {\n        setIndices([...selectedIndices, index]);\n        isSelected = true;\n      }\n    } else {\n      setIndices([index]);\n      isSelected = true;\n    }\n\n    // Triggers `onChange` on SelectInput\n    setChangeCallbackTriggerer(changeCallbackTriggerer + 1);\n\n    if (activeIndex !== index) {\n      setActiveIndex(index);\n    }\n\n    if (properties?.closeOnSelection && selectionType !== 'multiple') {\n      close();\n    }\n\n    return isSelected;\n  };\n\n  /**\n   * Click listener for combobox (or any triggerer of the dropdown)\n   */\n  const onTriggerClick = (): void => {\n    if (isOpen) {\n      close();\n    } else {\n      setIsOpen(true);\n    }\n  };\n\n  /**\n   * Function that we call when we want to move focus from one option to other\n   */\n  const onOptionChange = (actionType: SelectActionsType, index?: number): void => {\n    setActiveTagIndex(-1);\n    const newIndex = index ?? activeIndex;\n    let updatedIndex: number;\n    const hasAutoComplete =\n      rest.hasAutoCompleteInHeader ||\n      dropdownTriggerer === dropdownComponentIds.triggers.AutoComplete;\n    if (hasAutoComplete && filteredValues.length > 0) {\n      // When its autocomplete, we don't loop over all options. We only loop on filtered options\n\n      const filteredIndexes = filteredValues\n        .map((filteredValue) => options.findIndex((option) => option.value === filteredValue))\n        .sort((a, b) => a - b);\n\n      updatedIndex =\n        filteredIndexes[\n          getUpdatedIndex({\n            currentIndex: filteredIndexes.indexOf(newIndex),\n            maxIndex: filteredIndexes.length - 1,\n            actionType,\n          })\n        ];\n    } else {\n      updatedIndex = getUpdatedIndex({\n        currentIndex: newIndex,\n        maxIndex: options.length - 1,\n        actionType,\n      });\n    }\n    setActiveIndex(updatedIndex);\n\n    const optionValues = options.map((option) => option.value);\n    ensureScrollVisiblity(updatedIndex, rest.actionListItemRef.current, optionValues);\n    if (isBrowser()) {\n      fireNativeEvent(rest.actionListItemRef as React.RefObject<HTMLElement>, ['change', 'input']);\n    }\n  };\n\n  /**\n   * Click handler when user clicks on any particular option.\n   *\n   * It\n   * - changes the option focus\n   * - selects that option\n   * - moves focus to combobox\n   */\n  const onOptionClick = (\n    e: React.MouseEvent<HTMLButtonElement> | React.KeyboardEvent<HTMLInputElement>,\n    index: number,\n  ): void => {\n    setIsKeydownPressed(false);\n    const actionType = getActionFromKey(e, isOpen, dropdownTriggerer);\n    if (typeof actionType === 'number') {\n      onOptionChange(actionType, index);\n    }\n    selectOption(index);\n\n    if (!isReactNative()) {\n      if (rest.hasAutoCompleteInHeader) {\n        // move focus to autocomplete\n        rest.headerAutoCompleteRef.current?.focus();\n      } else {\n        rest.triggererRef.current?.focus();\n      }\n    }\n  };\n\n  /**\n   * Function we call to handle the typeahead.\n   *\n   * It takes a letter, stores that letter in searchString (and clears it after timeout) to maintain a word\n   *\n   * Then searches for that word in options and moves focus there.\n   */\n  const onComboType = (letter: string, actionType: SelectActionsType): void => {\n    // open the listbox if it is closed\n    setIsOpen(true);\n\n    if (\n      rest.hasAutoCompleteInHeader ||\n      dropdownTriggerer === dropdownComponentIds.triggers.AutoComplete\n    ) {\n      return;\n    }\n\n    if (typeof searchTimeout === 'number') {\n      window.clearTimeout(searchTimeout);\n    }\n\n    searchTimeout = window.setTimeout(() => {\n      searchString = '';\n    }, 500);\n    // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n    searchString = searchString + letter;\n    const optionTitles = options.map((option) => option.title);\n    const searchIndex = getIndexByLetter(optionTitles, searchString, activeIndex + 1);\n\n    // if a match was found, go to it\n    if (searchIndex >= 0) {\n      onOptionChange(actionType, searchIndex);\n    }\n    // if no matches, clear the timeout and search string\n    else {\n      window.clearTimeout(searchTimeout);\n      searchString = '';\n    }\n  };\n\n  /**\n   * Keydown event of combobox. Handles most of the keyboard accessibility of dropdown\n   */\n  const onTriggerKeydown = (e: {\n    event: React.KeyboardEvent<HTMLInputElement | HTMLButtonElement>;\n  }): void => {\n    if (!isKeydownPressed && ![' ', 'Enter', 'Escape', 'Meta'].includes(e.event.key)) {\n      // When keydown is not already pressed and its not Enter, Space, Command, or Escape key (those are generic keys and we only want to handle arrow keys or home buttons etc)\n      setIsKeydownPressed(true);\n    }\n\n    const actionType = getActionFromKey(e.event, isOpen, dropdownTriggerer);\n\n    if (actionType) {\n      performAction(actionType, e, {\n        setIsOpen,\n        close,\n        onOptionChange,\n        onComboType,\n        selectCurrentOption: () => {\n          if (activeIndex < 0) {\n            return;\n          }\n\n          const isSelected = selectOption(activeIndex);\n          if (rest.hasFooterAction && !isReactNative()) {\n            rest.triggererRef.current?.focus();\n          }\n\n          options[activeIndex].onClickTrigger?.(isSelected);\n        },\n      });\n    }\n  };\n\n  return {\n    isOpen,\n    setIsOpen,\n    close,\n    selectedIndices,\n    setSelectedIndices,\n    filteredValues,\n    removeOption,\n    setControlledValueIndices,\n    onTriggerClick,\n    onTriggerKeydown,\n    onOptionClick,\n    activeIndex,\n    setActiveIndex,\n    activeTagIndex,\n    setActiveTagIndex,\n    visibleTagsCountRef,\n    isKeydownPressed,\n    setIsKeydownPressed,\n    changeCallbackTriggerer,\n    setChangeCallbackTriggerer,\n    isControlled,\n    options,\n    value: makeInputValue(selectedIndices, options),\n    displayValue: makeInputDisplayValue(selectedIndices, options),\n    selectionType,\n    dropdownTriggerer,\n    ...rest,\n  };\n};\n\nexport type { DropdownContextType, OptionsType };\nexport { useDropdown, DropdownContext };\n"],"names":["noop","DropdownContext","React","createContext","isOpen","setIsOpen","close","selectedIndices","setSelectedIndices","controlledValueIndices","setControlledValueIndices","options","setOptions","filteredValues","setFilteredValues","activeIndex","setActiveIndex","activeTagIndex","setActiveTagIndex","shouldIgnoreBlurAnimation","setShouldIgnoreBlurAnimation","hasFooterAction","setHasFooterAction","hasAutoCompleteInHeader","setHasAutoCompleteInHeader","isKeydownPressed","setIsKeydownPressed","changeCallbackTriggerer","setChangeCallbackTriggerer","isControlled","setIsControlled","dropdownBaseId","actionListItemRef","current","triggererRef","headerAutoCompleteRef","isTagDismissedRef","visibleTagsCountRef","triggererWrapperRef","searchTimeout","searchString","useDropdown","_React$useContext","useContext","selectionType","dropdownTriggerer","rest","_objectWithoutProperties","_excluded","setIndices","indices","removeOption","index","existingItemIndex","indexOf","concat","_toConsumableArray","slice","selectOption","properties","arguments","length","undefined","closeOnSelection","isSelected","includes","onTriggerClick","onOptionChange","actionType","newIndex","updatedIndex","hasAutoComplete","dropdownComponentIds","triggers","AutoComplete","filteredIndexes","map","filteredValue","findIndex","option","value","sort","a","b","getUpdatedIndex","currentIndex","maxIndex","optionValues","ensureScrollVisiblity","isBrowser","fireNativeEvent","onOptionClick","e","getActionFromKey","isReactNative","_rest$headerAutoCompl","focus","_rest$triggererRef$cu","onComboType","letter","window","clearTimeout","setTimeout","optionTitles","title","searchIndex","getIndexByLetter","onTriggerKeydown","event","key","performAction","selectCurrentOption","_options$activeIndex$","_options$activeIndex","_rest$triggererRef$cu2","onClickTrigger","call","_objectSpread","makeInputValue","displayValue","makeInputDisplayValue"],"mappings":"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"}