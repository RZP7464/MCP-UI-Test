{"version":3,"file":"useMenu.js","sources":["../../../../../../src/components/Menu/useMenu.ts"],"sourcesContent":["import React from 'react';\nimport {\n  autoUpdate,\n  flip,\n  offset,\n  safePolygon,\n  shift,\n  size,\n  useClick,\n  useDismiss,\n  useFloating,\n  useFloatingNodeId,\n  useFloatingParentNodeId,\n  useFloatingTree,\n  useHover,\n  useInteractions,\n  useListNavigation,\n  useListItem,\n  useRole,\n  useTransitionStyles,\n} from '@floating-ui/react';\nimport type { MenuContextType, UseFloatingMenuProps, UseFloatingMenuReturnType } from './types';\nimport { useControllableState } from '~utils/useControllable';\nimport { OVERLAY_OFFSET, OVERLAY_TRANSITION_OFFSET } from '~components/BaseMenu/tokens';\nimport { makeSize, useTheme } from '~utils';\n\nconst MenuContext = React.createContext<MenuContextType>({\n  getItemProps: () => ({}),\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  setHasFocusInside: () => {},\n  isOpen: false,\n});\n\nconst useMenu = (): MenuContextType => {\n  const contextValue = React.useContext(MenuContext);\n  return contextValue;\n};\n\nconst useFloatingMenuSetup = ({\n  elementsRef,\n  openInteraction,\n  onOpenChange,\n  isOpen,\n}: UseFloatingMenuProps): UseFloatingMenuReturnType => {\n  const [isControllableOpen, setIsControllableOpen] = useControllableState({\n    value: isOpen,\n    defaultValue: false,\n    onChange: (isOpen) => onOpenChange?.({ isOpen }),\n  });\n  const [activeIndex, setActiveIndex] = React.useState<number | null>(null);\n\n  const tree = useFloatingTree();\n  const nodeId = useFloatingNodeId();\n  const parentId = useFloatingParentNodeId();\n  const item = useListItem();\n  const { theme } = useTheme();\n\n  const isNested = parentId != null;\n\n  const { floatingStyles, refs, context } = useFloating<HTMLButtonElement>({\n    nodeId,\n    open: isControllableOpen,\n    onOpenChange: (_isOpen) => setIsControllableOpen(() => _isOpen),\n    placement: isNested ? 'right-start' : 'bottom-start',\n    middleware: [\n      offset({ mainAxis: isNested ? 12 : OVERLAY_OFFSET, alignmentAxis: isNested ? -16 : 0 }),\n      flip(),\n      shift(),\n      size({\n        apply({ availableHeight, elements }) {\n          elements.floating.style.maxHeight = `${availableHeight}px`;\n        },\n      }),\n    ],\n    whileElementsMounted: autoUpdate,\n  });\n\n  const hover = useHover(context, {\n    enabled: isNested || openInteraction === 'hover',\n    delay: { open: 75 },\n    handleClose: safePolygon({ blockPointerEvents: true }),\n  });\n  const click = useClick(context, {\n    event: 'mousedown',\n    toggle: !isNested,\n    ignoreMouse: isNested,\n  });\n  const role = useRole(context, { role: 'menu' });\n  const dismiss = useDismiss(context, { bubbles: true });\n  const listNavigation = useListNavigation(context, {\n    listRef: elementsRef,\n    activeIndex,\n    nested: isNested,\n    onNavigate: setActiveIndex,\n    focusItemOnHover: false,\n  });\n\n  const { getReferenceProps, getFloatingProps, getItemProps } = useInteractions([\n    hover,\n    click,\n    role,\n    dismiss,\n    listNavigation,\n  ]);\n\n  const { isMounted, styles: floatingTransitionStyles } = useTransitionStyles(context, {\n    duration: theme.motion.duration.quick,\n    initial: ({ side }) => {\n      const transitionOffset = makeSize(OVERLAY_TRANSITION_OFFSET);\n      const transformMap = {\n        top: `translateY(${transitionOffset})`,\n        right: `translateX(-${transitionOffset})`,\n        left: `translateX(${transitionOffset})`,\n        bottom: `translateY(-${transitionOffset})`,\n      } as const;\n\n      return {\n        transform: transformMap[side ?? 'bottom'],\n        opacity: 0,\n      };\n    },\n  });\n\n  // Event emitter allows you to communicate across tree components.\n  // This effect closes all menus when an item gets clicked anywhere\n  // in the tree.\n  React.useEffect(() => {\n    if (!tree) return;\n\n    const handleTreeClick = (): void => {\n      setIsControllableOpen(() => false);\n    };\n\n    const onSubMenuOpen = (event: { nodeId: string; parentId: string }): void => {\n      if (event.nodeId !== nodeId && event.parentId === parentId) {\n        setIsControllableOpen(() => false);\n      }\n    };\n\n    tree.events.on('click', handleTreeClick);\n    tree.events.on('menuopen', onSubMenuOpen);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      // Cleanup\n      tree.events.off('click', handleTreeClick);\n      tree.events.off('menuopen', onSubMenuOpen);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tree, nodeId, parentId]);\n\n  React.useEffect(() => {\n    if (isOpen && tree) {\n      tree.events.emit('menuopen', { parentId, nodeId });\n    }\n  }, [tree, isOpen, nodeId, parentId]);\n\n  return {\n    getReferenceProps,\n    getFloatingProps,\n    getItemProps,\n    item,\n    context,\n    nodeId,\n    isOpen: isControllableOpen,\n    floatingStyles,\n    refs,\n    isNested,\n    isMounted,\n    floatingTransitionStyles,\n  };\n};\n\nexport { MenuContext, useMenu, useFloatingMenuSetup };\n"],"names":["MenuContext","React","createContext","getItemProps","setHasFocusInside","isOpen","useMenu","contextValue","useContext","useFloatingMenuSetup","_ref","elementsRef","openInteraction","onOpenChange","_useControllableState","useControllableState","value","defaultValue","onChange","_useControllableState2","_slicedToArray","isControllableOpen","setIsControllableOpen","_React$useState","useState","_React$useState2","activeIndex","setActiveIndex","tree","useFloatingTree","nodeId","useFloatingNodeId","parentId","useFloatingParentNodeId","item","useListItem","_useTheme","useTheme","theme","isNested","_useFloating","useFloating","open","_isOpen","placement","middleware","offset","mainAxis","OVERLAY_OFFSET","alignmentAxis","flip","shift","size","apply","_ref2","availableHeight","elements","floating","style","maxHeight","concat","whileElementsMounted","autoUpdate","floatingStyles","refs","context","hover","useHover","enabled","delay","handleClose","safePolygon","blockPointerEvents","click","useClick","event","toggle","ignoreMouse","role","useRole","dismiss","useDismiss","bubbles","listNavigation","useListNavigation","listRef","nested","onNavigate","focusItemOnHover","_useInteractions","useInteractions","getReferenceProps","getFloatingProps","_useTransitionStyles","useTransitionStyles","duration","motion","quick","initial","_ref3","side","transitionOffset","makeSize","OVERLAY_TRANSITION_OFFSET","transformMap","top","right","left","bottom","transform","opacity","isMounted","floatingTransitionStyles","styles","useEffect","handleTreeClick","onSubMenuOpen","events","on","off","emit"],"mappings":"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"}