{"version":3,"file":"dropdownUtils.js","sources":["../../../../../../src/components/Dropdown/dropdownUtils.ts"],"sourcesContent":["/*\n * This content is licensed according to the W3C Software License at\n * https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document\n *\n * This software or document includes material copied from or derived from\n * https://www.w3.org/WAI/ARIA/apg/example-index/combobox/combobox-select-only.html.\n * Copyright © 2022 W3C® (MIT, ERCIM, Keio, Beihang)\n */\n\nimport type { DropdownContextType, OptionsType } from './useDropdown';\nimport { dropdownComponentIds } from './dropdownComponentIds';\nimport type { SpacingValueType } from '~components/Box/BaseBox';\n\nexport type SelectActionsType =\n  | 'Close'\n  | 'CloseSelect'\n  | 'First'\n  | 'Last'\n  | 'Next'\n  | 'Open'\n  | 'PageDown'\n  | 'PageUp'\n  | 'Previous'\n  | 'Select'\n  | 'Type';\n\n// Save a list of named combobox actions, for future readability\nconst SelectActions: Record<SelectActionsType, SelectActionsType> = {\n  Close: 'Close',\n  CloseSelect: 'CloseSelect',\n  First: 'First',\n  Last: 'Last',\n  Next: 'Next',\n  Open: 'Open',\n  PageDown: 'PageDown',\n  PageUp: 'PageUp',\n  Previous: 'Previous',\n  Select: 'Select',\n  Type: 'Type',\n};\n\n/**\n * Filter an array of options against an input string\n * returns an array of options that begin with the filter string, case-independent\n *\n */\nexport function filterOptions(\n  options: string[] = [],\n  filter: string,\n  exclude: string[] = [],\n): string[] {\n  return options.filter((option) => {\n    const matches = String(option).toLowerCase().startsWith(filter.toLowerCase());\n    return matches && !exclude.includes(option);\n  });\n}\n\n/**\n * Map a keypress to action\n */\nexport function getActionFromKey(\n  e: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>,\n  isOpen: boolean,\n  dropdownTriggerer: DropdownContextType['dropdownTriggerer'],\n): SelectActionsType | undefined {\n  if (!e) {\n    return undefined;\n  }\n\n  const { altKey, ctrlKey, metaKey } = e;\n  let key = '';\n  if ('key' in e) {\n    key = e.key;\n  }\n  const openKeys = ['ArrowDown', 'ArrowUp', 'Enter', ' ']; // all keys that will do the default open action\n  if (!key) return undefined;\n  // handle opening when closed\n  if (!isOpen && key && openKeys.includes(key)) {\n    return SelectActions.Open;\n  }\n\n  // home and end move the selected option when open or closed\n  if (key === 'Home') {\n    return SelectActions.First;\n  }\n  if (key === 'End') {\n    return SelectActions.Last;\n  }\n\n  // handle typing characters when open or closed\n  if (\n    key === 'Backspace' ||\n    key === 'Clear' ||\n    (key.length === 1 && key !== ' ' && !altKey && !ctrlKey && !metaKey)\n  ) {\n    return SelectActions.Type;\n  }\n\n  // handle keys when open\n  if (isOpen) {\n    if (key === 'ArrowUp' && altKey) {\n      return SelectActions.CloseSelect;\n    } else if (key === 'ArrowDown' && !altKey) {\n      return SelectActions.Next;\n    } else if (key === 'ArrowUp') {\n      return SelectActions.Previous;\n    } else if (key === 'PageUp') {\n      return SelectActions.PageUp;\n    } else if (key === 'PageDown') {\n      return SelectActions.PageDown;\n    } else if (key === 'Escape') {\n      return SelectActions.Close;\n    } else if (\n      key === 'Enter' ||\n      // we ignore the spacebar select in autocomplete since hitting spacebar might be expected while typing\n      (dropdownTriggerer !== dropdownComponentIds.triggers.AutoComplete &&\n        dropdownTriggerer !== dropdownComponentIds.triggers.SearchInput &&\n        key === ' ')\n    ) {\n      return SelectActions.CloseSelect;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Return the index of an option from an array of options, based on a search string\n *\n * if the filter is multiple iterations of the same letter (e.g \"aaa\"), then cycle through first-letter matches\n **/\nexport function getIndexByLetter(options: string[], filter: string, startIndex = 0): number {\n  const orderedOptions = [...options.slice(startIndex), ...options.slice(0, startIndex)];\n  const firstMatch = filterOptions(orderedOptions, filter)[0];\n  const allSameLetter = (array: string[]): boolean => array.every((letter) => letter === array[0]);\n\n  // first check if there is an exact match for the typed string\n  if (firstMatch) {\n    return options.indexOf(firstMatch);\n  }\n\n  // if the same letter is being repeated, cycle through first-letter matches\n  else if (allSameLetter(filter.split(''))) {\n    const matches = filterOptions(orderedOptions, filter[0]);\n    return options.indexOf(matches[0]);\n  }\n\n  // if no matches, return -1\n  else {\n    return -1;\n  }\n}\n\n/**\n * This functions makes sure the optionsIndex is not going out of possible options\n */\nexport function getUpdatedIndex({\n  currentIndex,\n  maxIndex,\n  actionType,\n}: {\n  currentIndex: number;\n  maxIndex: number;\n  actionType: SelectActionsType;\n}): number {\n  // On PageUP or PageDown, we jump focus by 10 items or to the first or last element\n  // Details: https://www.w3.org/WAI/ARIA/apg/example-index/combobox/combobox-select-only.html#:~:text=PageUp,to%20last%20option).\n  const pageSize = 10;\n\n  switch (actionType) {\n    case SelectActions.First:\n      return 0;\n    case SelectActions.Last:\n      return maxIndex;\n    case SelectActions.Previous:\n      return Math.max(0, currentIndex - 1);\n    case SelectActions.Next:\n      return Math.min(maxIndex, currentIndex + 1);\n    case SelectActions.PageUp:\n      return Math.max(0, currentIndex - pageSize);\n    case SelectActions.PageDown:\n      return Math.min(maxIndex, currentIndex + pageSize);\n    default:\n      return currentIndex;\n  }\n}\n\n/**\n * Checks if the given HTML element is visible on screen\n */\nexport function isElementVisibleOnScreen(element: HTMLElement): boolean {\n  const bounding = element.getBoundingClientRect();\n\n  return (\n    bounding.top >= 0 &&\n    bounding.left >= 0 &&\n    bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n    bounding.right <= (window.innerWidth || document.documentElement.clientWidth)\n  );\n}\n\n/**\n * Checks if element is visible inside the given container\n */\nfunction isElementVisible(container: HTMLElement, element: HTMLElement): boolean {\n  const containerRect = container.getBoundingClientRect();\n  const elementRect = element.getBoundingClientRect();\n\n  const isVerticalVisible =\n    elementRect.top >= containerRect.top && elementRect.bottom <= containerRect.bottom;\n\n  return isVerticalVisible;\n}\n\n/**\n * Checks if the dropdown is scrollable\n */\nexport function isScrollable(element: HTMLElement): boolean {\n  return element && element.clientHeight < element.scrollHeight;\n}\n\ntype ActionsType = {\n  setIsOpen: DropdownContextType['setIsOpen'];\n  close: DropdownContextType['close'];\n  selectCurrentOption: () => void;\n  onOptionChange: (action: SelectActionsType) => void;\n  onComboType: (letter: string, action: SelectActionsType) => void;\n};\n/**\n * Performs the action when actionType is passed\n *\n * This function handles all the keydown actions.\n */\nexport const performAction = (\n  action: SelectActionsType,\n  payload: {\n    event: React.KeyboardEvent<HTMLInputElement | HTMLButtonElement>;\n  },\n  actions: ActionsType,\n): boolean => {\n  const { event } = payload;\n\n  switch (action) {\n    case SelectActions.Last:\n    // @ts-expect-error: intentional fallthrough, ignoring the warning\n    case SelectActions.First:\n      actions.setIsOpen(true);\n    // intentional fallthrough\n    case SelectActions.Next:\n    case SelectActions.Previous:\n    case SelectActions.PageUp:\n    case SelectActions.PageDown:\n      event.preventDefault();\n      actions.onOptionChange(action);\n      return true;\n    case SelectActions.CloseSelect:\n      event.preventDefault();\n      actions.selectCurrentOption();\n      return true;\n    case SelectActions.Close:\n      event.preventDefault();\n      actions.close();\n      return true;\n    case SelectActions.Type:\n      actions.onComboType(event.key, action);\n      return true;\n    case SelectActions.Open:\n      event.preventDefault();\n      actions.setIsOpen(true);\n      return true;\n\n    default:\n      break;\n  }\n\n  return false;\n};\n\n/**\n * When options list is large, it can have a scrollbar.\n *\n * This function ensures the active option is always in the viewport\n */\nexport const ensureScrollVisiblity = (\n  newActiveIndex: number,\n  containerElement: HTMLElement | null,\n  options: string[],\n): void => {\n  // ensure the new option is in view\n  if (containerElement) {\n    if (isScrollable(containerElement)) {\n      const optionEl = containerElement.querySelectorAll<HTMLElement>(\n        '[role=\"option\"], [role=\"menuitem\"]',\n      );\n      // Making sure its the same element as the one from options state\n      if (\n        newActiveIndex >= 0 &&\n        optionEl[newActiveIndex].dataset.value === options[newActiveIndex]\n      ) {\n        const activeElement = optionEl[newActiveIndex];\n\n        if (!isElementVisible(containerElement, activeElement)) {\n          activeElement.scrollIntoView({ inline: 'nearest' });\n        }\n\n        if (!isElementVisibleOnScreen(optionEl[newActiveIndex])) {\n          activeElement.scrollIntoView({ behavior: 'smooth' });\n        }\n      }\n    }\n  }\n};\n\n/**\n * value that is set in the actual form input\n */\nexport const makeInputValue = (selectedIndices: number[], options: OptionsType): string => {\n  if (options.length === 0) {\n    return '';\n  }\n  return selectedIndices.map((selectedIndex) => options[selectedIndex]?.value).join(', ');\n};\n\n/**\n * Value that is displayed inside the select field\n */\nexport const makeInputDisplayValue = (selectedIndices: number[], options: OptionsType): string => {\n  // When no item is selected or no item is present\n  if (options.length === 0 || selectedIndices.length === 0) {\n    return '';\n  }\n\n  // When one item is selected, we display that item's title in input\n  if (selectedIndices.length === 1) {\n    return options[selectedIndices[0]]?.title;\n  }\n\n  // When more than one item is selected, we display the count of items\n  return `${selectedIndices.length} items selected`;\n};\n\nexport type DropdownPosition = {\n  top?: SpacingValueType;\n  bottom?: SpacingValueType;\n  left?: SpacingValueType;\n  right?: SpacingValueType;\n};\n"],"names":["SelectActions","Close","CloseSelect","First","Last","Next","Open","PageDown","PageUp","Previous","Select","Type","filterOptions","options","arguments","length","undefined","filter","exclude","option","matches","String","toLowerCase","startsWith","includes","getActionFromKey","e","isOpen","dropdownTriggerer","altKey","ctrlKey","metaKey","key","openKeys","dropdownComponentIds","triggers","AutoComplete","SearchInput","getIndexByLetter","startIndex","orderedOptions","concat","_toConsumableArray","slice","firstMatch","allSameLetter","array","every","letter","indexOf","split","getUpdatedIndex","_ref","currentIndex","maxIndex","actionType","pageSize","Math","max","min","isElementVisibleOnScreen","element","bounding","getBoundingClientRect","top","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","isElementVisible","container","containerRect","elementRect","isVerticalVisible","isScrollable","scrollHeight","performAction","action","payload","actions","event","setIsOpen","preventDefault","onOptionChange","selectCurrentOption","close","onComboType","ensureScrollVisiblity","newActiveIndex","containerElement","optionEl","querySelectorAll","dataset","value","activeElement","scrollIntoView","inline","behavior","makeInputValue","selectedIndices","map","selectedIndex","_options$selectedInde","join","makeInputDisplayValue","_options$selectedIndi","title"],"mappings":"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"}