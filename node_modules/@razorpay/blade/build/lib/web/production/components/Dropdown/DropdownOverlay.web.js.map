{"version":3,"file":"DropdownOverlay.web.js","sources":["../../../../../../src/components/Dropdown/DropdownOverlay.web.tsx"],"sourcesContent":["import React from 'react';\nimport {\n  autoUpdate,\n  offset,\n  size as sizeMiddleware,\n  useFloating,\n  useTransitionStyles,\n  flip,\n  FloatingPortal,\n  useDismiss,\n  useInteractions,\n} from '@floating-ui/react';\nimport { useDropdown } from './useDropdown';\nimport { StyledDropdownOverlay } from './StyledDropdownOverlay';\nimport type { DropdownOverlayProps } from './types';\nimport { dropdownComponentIds } from './dropdownComponentIds';\nimport { useTheme } from '~components/BladeProvider';\n// Reading directly because its not possible to get theme object on top level to be used in keyframes\nimport { size } from '~tokens/global';\nimport { makeSize } from '~utils';\nimport { metaAttribute, MetaConstants } from '~utils/metaAttribute';\nimport { assignWithoutSideEffects } from '~utils/assignWithoutSideEffects';\nimport { useBottomSheetAndDropdownGlue } from '~components/BottomSheet/BottomSheetContext';\nimport BaseBox from '~components/Box/BaseBox';\nimport { componentZIndices } from '~utils/componentZIndices';\nimport { OVERLAY_OFFSET, OVERLAY_TRANSITION_OFFSET } from '~components/BaseMenu/tokens';\nimport { makeAnalyticsAttribute } from '~utils/makeAnalyticsAttribute';\n\nconst OVERLAY_PADDING: number = size['12']; // doesn't have to be exact. Just rough padding for floating ui to decide to show overlay on top or bottom\n\n/**\n * Overlay of dropdown\n *\n * Wrap your ActionList within this component\n */\nconst _DropdownOverlay = ({\n  children,\n  testID,\n  zIndex = componentZIndices.dropdownOverlay,\n  width,\n  minWidth,\n  maxWidth,\n  referenceRef,\n  defaultPlacement = 'bottom-start',\n  _isNestedDropdown = false,\n  ...dataAnalyticsProps\n}: DropdownOverlayProps): React.ReactElement | null => {\n  const { isOpen, triggererRef, triggererWrapperRef, dropdownTriggerer, setIsOpen } = useDropdown();\n  const { theme } = useTheme();\n  const bottomSheetAndDropdownGlue = useBottomSheetAndDropdownGlue();\n\n  const isMenu =\n    (dropdownTriggerer !== dropdownComponentIds.triggers.SelectInput &&\n      dropdownTriggerer !== dropdownComponentIds.triggers.SearchInput &&\n      dropdownTriggerer !== dropdownComponentIds.triggers.AutoComplete &&\n      referenceRef == undefined) ||\n    _isNestedDropdown;\n\n  const { refs, floatingStyles, context } = useFloating({\n    open: isOpen,\n    onOpenChange: setIsOpen,\n    strategy: 'fixed',\n    placement: defaultPlacement,\n    elements: {\n      // Input triggers have their ref on internal input element but we want width height of overall visible input hence wrapperRef is needed\n      // We fallback to use `triggererRef` for triggers like button and link where wrapper is not needed\n      // Checkout: https://github.com/razorpay/blade/pull/1559#discussion_r1305438920\n      reference: (referenceRef?.current ??\n        triggererWrapperRef.current ??\n        triggererRef.current) as Element,\n    },\n    middleware: [\n      offset({\n        mainAxis: OVERLAY_OFFSET,\n      }),\n      flip({\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        padding: OVERLAY_OFFSET + OVERLAY_PADDING,\n      }),\n      sizeMiddleware({\n        apply({ rects, elements }) {\n          const overlayWidth = isMenu ? undefined : makeSize(rects.reference.width);\n          const overlayMinWidth = isMenu ? makeSize(size['240']) : undefined;\n          const overlayMaxWidth = isMenu ? makeSize(size['400']) : undefined;\n\n          Object.assign(elements.floating.style, {\n            // in menu, we have flexible width between min and max\n            // in input triggers, we just take width of trigger\n            width: width ?? overlayWidth,\n            minWidth: minWidth ?? overlayMinWidth,\n            maxWidth: maxWidth ?? overlayMaxWidth,\n          });\n        },\n      }),\n    ],\n    whileElementsMounted: autoUpdate,\n  });\n\n  const dismiss = useDismiss(context);\n  const { getFloatingProps } = useInteractions([dismiss]);\n\n  const { isMounted, styles } = useTransitionStyles(context, {\n    duration: theme.motion.duration.quick,\n    initial: () => ({\n      transform: `translateY(-${makeSize(OVERLAY_TRANSITION_OFFSET)})`,\n      opacity: 0,\n    }),\n  });\n\n  React.useEffect(() => {\n    if (isOpen) {\n      // On Safari clicking on a non input element doesn't focuses it https://bugs.webkit.org/show_bug.cgi?id=22261\n      triggererRef.current?.focus();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isOpen]);\n\n  return (\n    <FloatingPortal>\n      <BaseBox\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        ref={refs.setFloating as any}\n        style={floatingStyles}\n        zIndex={zIndex}\n        display={isMounted ? 'flex' : 'none'}\n        {...getFloatingProps()}\n      >\n        <StyledDropdownOverlay\n          isInBottomSheet={bottomSheetAndDropdownGlue?.dropdownHasBottomSheet}\n          elevation={bottomSheetAndDropdownGlue?.dropdownHasBottomSheet ? undefined : 'midRaised'}\n          style={{ ...styles }}\n          width={width ? width : '100%'}\n          minWidth={minWidth}\n          maxWidth={maxWidth}\n          {...metaAttribute({ name: MetaConstants.DropdownOverlay, testID })}\n          {...makeAnalyticsAttribute(dataAnalyticsProps)}\n        >\n          {children}\n        </StyledDropdownOverlay>\n      </BaseBox>\n    </FloatingPortal>\n  );\n};\n\nconst DropdownOverlay = assignWithoutSideEffects(_DropdownOverlay, {\n  componentId: dropdownComponentIds.DropdownOverlay,\n});\n\nexport { DropdownOverlay };\n"],"names":["OVERLAY_PADDING","size","_DropdownOverlay","_ref","_ref2","_referenceRef$current","children","testID","_ref$zIndex","zIndex","componentZIndices","dropdownOverlay","width","minWidth","maxWidth","referenceRef","_ref$defaultPlacement","defaultPlacement","_ref$_isNestedDropdow","_isNestedDropdown","dataAnalyticsProps","_objectWithoutProperties","_excluded","_useDropdown","useDropdown","isOpen","triggererRef","triggererWrapperRef","dropdownTriggerer","setIsOpen","_useTheme","useTheme","theme","bottomSheetAndDropdownGlue","useBottomSheetAndDropdownGlue","isMenu","dropdownComponentIds","triggers","SelectInput","SearchInput","AutoComplete","undefined","_useFloating","useFloating","open","onOpenChange","strategy","placement","elements","reference","current","middleware","offset","mainAxis","OVERLAY_OFFSET","flip","padding","sizeMiddleware","apply","_ref3","rects","overlayWidth","makeSize","overlayMinWidth","overlayMaxWidth","Object","assign","floating","style","whileElementsMounted","autoUpdate","refs","floatingStyles","context","dismiss","useDismiss","_useInteractions","useInteractions","getFloatingProps","_useTransitionStyles","useTransitionStyles","duration","motion","quick","initial","transform","concat","OVERLAY_TRANSITION_OFFSET","opacity","isMounted","styles","React","useEffect","_triggererRef$current","focus","_jsx","FloatingPortal","BaseBox","_objectSpread","ref","setFloating","display","StyledDropdownOverlay","isInBottomSheet","dropdownHasBottomSheet","elevation","metaAttribute","name","MetaConstants","DropdownOverlay","makeAnalyticsAttribute","assignWithoutSideEffects","componentId"],"mappings":"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"}