{"version":3,"file":"TabIndicator.web.js","sources":["../../../../../../src/components/Tabs/TabIndicator.web.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable consistent-return */\nimport React from 'react';\nimport styled from 'styled-components';\nimport { useTabsContext } from './TabsContext';\nimport { useTheme } from '~components/BladeProvider';\nimport { castWebType, makeMotionTime } from '~utils';\nimport { useIsomorphicLayoutEffect } from '~utils/useIsomorphicLayoutEffect';\nimport BaseBox from '~components/Box/BaseBox';\nimport { metaAttribute, MetaConstants } from '~utils/metaAttribute';\n\nconst StyledTabIndicator = styled(BaseBox)(({ theme }) => {\n  return {\n    cursor: 'pointer',\n    '&:hover': {\n      backgroundColor: theme.colors.interactive.background.primary.fadedHighlighted,\n    },\n  };\n});\n\nconst TabIndicator = ({\n  tabListContainerRef,\n}: {\n  tabListContainerRef: React.RefObject<HTMLElement | null>;\n}): React.ReactElement => {\n  const { theme } = useTheme();\n  const { selectedValue, baseId, variant } = useTabsContext();\n  const [hasMeasured, setHasMeasured] = React.useState(false);\n  const [activeElementDimensions, setActiveElementDimensions] = React.useState({\n    width: 0,\n    height: 0,\n    x: 0,\n    y: 0,\n  });\n\n  // Update the dimensions of the active element\n  const updateDimensions = React.useCallback(() => {\n    const tabItemId = `${baseId}-${selectedValue}-tabitem`;\n    const activeTabItem = document.getElementById(tabItemId);\n    if (!activeTabItem) return;\n\n    setActiveElementDimensions({\n      width: activeTabItem.offsetWidth,\n      height: activeTabItem.offsetHeight,\n      x: activeTabItem.offsetLeft,\n      y:\n        variant === 'filled'\n          ? // on filled variant the indicator is positioned on top of the tab item\n            // so no need to add offsetHeight\n            activeTabItem.offsetTop\n          : activeTabItem.offsetTop + activeTabItem.offsetHeight - 1.5,\n    });\n  }, [baseId, selectedValue, tabListContainerRef, variant]);\n\n  // Update the dimensions when the selected value changes\n  useIsomorphicLayoutEffect(() => {\n    if (!selectedValue) return;\n\n    updateDimensions();\n\n    const id = requestAnimationFrame(() => {\n      setHasMeasured(true);\n    });\n\n    return () => {\n      if (id) {\n        cancelAnimationFrame(id);\n      }\n    };\n  }, [baseId, selectedValue]);\n\n  // Update the dimensions when the window resizes or when the font loads\n  React.useEffect(() => {\n    if (!tabListContainerRef.current) return;\n\n    // check for FontFace API support\n    // FontFaceAPI is widely supported but better to be safe than sorry\n    if ('fonts' in document) {\n      try {\n        // wait for fonts to be loaded and then recalculate the dimensions\n        void document.fonts.ready.then(() => {\n          updateDimensions();\n        });\n      } catch (err: unknown) {\n        /* empty */\n      }\n    }\n\n    window.addEventListener('resize', updateDimensions);\n\n    return () => {\n      if (!tabListContainerRef.current) return;\n      window.removeEventListener('resize', updateDimensions);\n    };\n  }, [tabListContainerRef, updateDimensions]);\n\n  const transitionProps = {\n    transitionProperty: 'transform, width, background-color',\n    transitionDuration: hasMeasured\n      ? castWebType(makeMotionTime(theme.motion.duration.gentle))\n      : '0ms',\n    transitionTimingFunction: castWebType(theme.motion.easing.standard),\n  };\n\n  if (variant === 'filled') {\n    return (\n      <StyledTabIndicator\n        pointerEvents=\"none\"\n        position=\"absolute\"\n        left=\"0px\"\n        top=\"0px\"\n        borderRadius=\"small\"\n        backgroundColor=\"interactive.background.primary.faded\"\n        style={{\n          ...transitionProps,\n          width: `${activeElementDimensions.width}px`,\n          height: `${activeElementDimensions.height}px`,\n          transform: `translate(${activeElementDimensions.x}px, ${activeElementDimensions.y}px)`,\n        }}\n        {...metaAttribute({ name: MetaConstants.TabIndicator })}\n      />\n    );\n  }\n\n  return (\n    <StyledTabIndicator\n      pointerEvents=\"none\"\n      position=\"absolute\"\n      left=\"0%\"\n      top=\"-0.5px\"\n      height=\"2px\"\n      backgroundColor=\"interactive.background.primary.default\"\n      style={{\n        ...transitionProps,\n        width: `${activeElementDimensions.width}px`,\n        transform: `translate(${activeElementDimensions.x}px, ${activeElementDimensions.y}px)`,\n      }}\n      {...metaAttribute({ name: MetaConstants.TabIndicator })}\n    />\n  );\n};\n\nexport { TabIndicator };\n"],"names":["StyledTabIndicator","styled","BaseBox","withConfig","displayName","componentId","_ref","theme","cursor","backgroundColor","colors","interactive","background","primary","fadedHighlighted","TabIndicator","_ref2","tabListContainerRef","_useTheme","useTheme","_useTabsContext","useTabsContext","selectedValue","baseId","variant","_React$useState","React","useState","_React$useState2","_slicedToArray","hasMeasured","setHasMeasured","_React$useState3","width","height","x","y","_React$useState4","activeElementDimensions","setActiveElementDimensions","updateDimensions","useCallback","tabItemId","concat","activeTabItem","document","getElementById","offsetWidth","offsetHeight","offsetLeft","offsetTop","useIsomorphicLayoutEffect","id","requestAnimationFrame","cancelAnimationFrame","useEffect","current","fonts","ready","then","err","window","addEventListener","removeEventListener","transitionProps","transitionProperty","transitionDuration","castWebType","makeMotionTime","motion","duration","gentle","transitionTimingFunction","easing","standard","_jsx","_objectSpread","pointerEvents","position","left","top","borderRadius","style","transform","metaAttribute","name","MetaConstants"],"mappings":";;;;;;;;;;;;;;;;;;;;AAYA,IAAMA,kBAAkB,gBAAGC,MAAM,CAACC,OAAO,CAAC,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,qCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAC,CAAA,CAAA,UAAAC,IAAA,EAAe;AAAA,EAAA,IAAZC,KAAK,GAAAD,IAAA,CAALC,KAAK,CAAA;EACjD,OAAO;AACLC,IAAAA,MAAM,EAAE,SAAS;AACjB,IAAA,SAAS,EAAE;MACTC,eAAe,EAAEF,KAAK,CAACG,MAAM,CAACC,WAAW,CAACC,UAAU,CAACC,OAAO,CAACC,gBAAAA;AAC/D,KAAA;GACD,CAAA;AACH,CAAC,CAAC,CAAA;AAEF,IAAMC,YAAY,GAAG,SAAfA,YAAYA,CAAAC,KAAA,EAIQ;AAAA,EAAA,IAHxBC,mBAAmB,GAAAD,KAAA,CAAnBC,mBAAmB,CAAA;AAInB,EAAA,IAAAC,SAAA,GAAkBC,QAAQ,EAAE;IAApBZ,KAAK,GAAAW,SAAA,CAALX,KAAK,CAAA;AACb,EAAA,IAAAa,eAAA,GAA2CC,cAAc,EAAE;IAAnDC,aAAa,GAAAF,eAAA,CAAbE,aAAa;IAAEC,MAAM,GAAAH,eAAA,CAANG,MAAM;IAAEC,OAAO,GAAAJ,eAAA,CAAPI,OAAO,CAAA;AACtC,EAAA,IAAAC,eAAA,GAAsCC,cAAK,CAACC,QAAQ,CAAC,KAAK,CAAC;IAAAC,gBAAA,GAAAC,cAAA,CAAAJ,eAAA,EAAA,CAAA,CAAA;AAApDK,IAAAA,WAAW,GAAAF,gBAAA,CAAA,CAAA,CAAA;AAAEG,IAAAA,cAAc,GAAAH,gBAAA,CAAA,CAAA,CAAA,CAAA;AAClC,EAAA,IAAAI,gBAAA,GAA8DN,cAAK,CAACC,QAAQ,CAAC;AAC3EM,MAAAA,KAAK,EAAE,CAAC;AACRC,MAAAA,MAAM,EAAE,CAAC;AACTC,MAAAA,CAAC,EAAE,CAAC;AACJC,MAAAA,CAAC,EAAE,CAAA;AACL,KAAC,CAAC;IAAAC,gBAAA,GAAAR,cAAA,CAAAG,gBAAA,EAAA,CAAA,CAAA;AALKM,IAAAA,uBAAuB,GAAAD,gBAAA,CAAA,CAAA,CAAA;AAAEE,IAAAA,0BAA0B,GAAAF,gBAAA,CAAA,CAAA,CAAA,CAAA;;AAO1D;AACA,EAAA,IAAMG,gBAAgB,GAAGd,cAAK,CAACe,WAAW,CAAC,YAAM;IAC/C,IAAMC,SAAS,MAAAC,MAAA,CAAMpB,MAAM,EAAAoB,GAAAA,CAAAA,CAAAA,MAAA,CAAIrB,aAAa,EAAU,UAAA,CAAA,CAAA;AACtD,IAAA,IAAMsB,aAAa,GAAGC,QAAQ,CAACC,cAAc,CAACJ,SAAS,CAAC,CAAA;IACxD,IAAI,CAACE,aAAa,EAAE,OAAA;AAEpBL,IAAAA,0BAA0B,CAAC;MACzBN,KAAK,EAAEW,aAAa,CAACG,WAAW;MAChCb,MAAM,EAAEU,aAAa,CAACI,YAAY;MAClCb,CAAC,EAAES,aAAa,CAACK,UAAU;MAC3Bb,CAAC,EACCZ,OAAO,KAAK,QAAQ;AAChB;AACA;MACAoB,aAAa,CAACM,SAAS,GACvBN,aAAa,CAACM,SAAS,GAAGN,aAAa,CAACI,YAAY,GAAG,GAAA;AAC/D,KAAC,CAAC,CAAA;GACH,EAAE,CAACzB,MAAM,EAAED,aAAa,EAAEL,mBAAmB,EAAEO,OAAO,CAAC,CAAC,CAAA;;AAEzD;AACA2B,EAAAA,yBAAyB,CAAC,YAAM;IAC9B,IAAI,CAAC7B,aAAa,EAAE,OAAA;AAEpBkB,IAAAA,gBAAgB,EAAE,CAAA;AAElB,IAAA,IAAMY,EAAE,GAAGC,qBAAqB,CAAC,YAAM;MACrCtB,cAAc,CAAC,IAAI,CAAC,CAAA;AACtB,KAAC,CAAC,CAAA;AAEF,IAAA,OAAO,YAAM;AACX,MAAA,IAAIqB,EAAE,EAAE;QACNE,oBAAoB,CAACF,EAAE,CAAC,CAAA;AAC1B,OAAA;KACD,CAAA;AACH,GAAC,EAAE,CAAC7B,MAAM,EAAED,aAAa,CAAC,CAAC,CAAA;;AAE3B;EACAI,cAAK,CAAC6B,SAAS,CAAC,YAAM;AACpB,IAAA,IAAI,CAACtC,mBAAmB,CAACuC,OAAO,EAAE,OAAA;;AAElC;AACA;IACA,IAAI,OAAO,IAAIX,QAAQ,EAAE;MACvB,IAAI;AACF;QACA,KAAKA,QAAQ,CAACY,KAAK,CAACC,KAAK,CAACC,IAAI,CAAC,YAAM;AACnCnB,UAAAA,gBAAgB,EAAE,CAAA;AACpB,SAAC,CAAC,CAAA;OACH,CAAC,OAAOoB,GAAY,EAAE;AACrB;AAAA,OAAA;AAEJ,KAAA;AAEAC,IAAAA,MAAM,CAACC,gBAAgB,CAAC,QAAQ,EAAEtB,gBAAgB,CAAC,CAAA;AAEnD,IAAA,OAAO,YAAM;AACX,MAAA,IAAI,CAACvB,mBAAmB,CAACuC,OAAO,EAAE,OAAA;AAClCK,MAAAA,MAAM,CAACE,mBAAmB,CAAC,QAAQ,EAAEvB,gBAAgB,CAAC,CAAA;KACvD,CAAA;AACH,GAAC,EAAE,CAACvB,mBAAmB,EAAEuB,gBAAgB,CAAC,CAAC,CAAA;AAE3C,EAAA,IAAMwB,eAAe,GAAG;AACtBC,IAAAA,kBAAkB,EAAE,oCAAoC;AACxDC,IAAAA,kBAAkB,EAAEpC,WAAW,GAC3BqC,WAAW,CAACC,cAAc,CAAC7D,KAAK,CAAC8D,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,GACzD,KAAK;IACTC,wBAAwB,EAAEL,WAAW,CAAC5D,KAAK,CAAC8D,MAAM,CAACI,MAAM,CAACC,QAAQ,CAAA;GACnE,CAAA;EAED,IAAIlD,OAAO,KAAK,QAAQ,EAAE;AACxB,IAAA,oBACEmD,GAAA,CAAC3E,kBAAkB,EAAA4E,aAAA,CAAA;AACjBC,MAAAA,aAAa,EAAC,MAAM;AACpBC,MAAAA,QAAQ,EAAC,UAAU;AACnBC,MAAAA,IAAI,EAAC,KAAK;AACVC,MAAAA,GAAG,EAAC,KAAK;AACTC,MAAAA,YAAY,EAAC,OAAO;AACpBxE,MAAAA,eAAe,EAAC,sCAAsC;AACtDyE,MAAAA,KAAK,EAAAN,aAAA,CAAAA,aAAA,KACAZ,eAAe,CAAA,EAAA,EAAA,EAAA;AAClB/B,QAAAA,KAAK,KAAAU,MAAA,CAAKL,uBAAuB,CAACL,KAAK,EAAI,IAAA,CAAA;AAC3CC,QAAAA,MAAM,KAAAS,MAAA,CAAKL,uBAAuB,CAACJ,MAAM,EAAI,IAAA,CAAA;QAC7CiD,SAAS,EAAA,YAAA,CAAAxC,MAAA,CAAeL,uBAAuB,CAACH,CAAC,EAAA,MAAA,CAAA,CAAAQ,MAAA,CAAOL,uBAAuB,CAACF,CAAC,EAAA,KAAA,CAAA;AAAK,OAAA,CAAA;AACtF,KAAA,EACEgD,aAAa,CAAC;MAAEC,IAAI,EAAEC,aAAa,CAACvE,YAAAA;KAAc,CAAC,CACxD,CAAC,CAAA;AAEN,GAAA;AAEA,EAAA,oBACE4D,GAAA,CAAC3E,kBAAkB,EAAA4E,aAAA,CAAA;AACjBC,IAAAA,aAAa,EAAC,MAAM;AACpBC,IAAAA,QAAQ,EAAC,UAAU;AACnBC,IAAAA,IAAI,EAAC,IAAI;AACTC,IAAAA,GAAG,EAAC,QAAQ;AACZ9C,IAAAA,MAAM,EAAC,KAAK;AACZzB,IAAAA,eAAe,EAAC,wCAAwC;AACxDyE,IAAAA,KAAK,EAAAN,aAAA,CAAAA,aAAA,KACAZ,eAAe,CAAA,EAAA,EAAA,EAAA;AAClB/B,MAAAA,KAAK,KAAAU,MAAA,CAAKL,uBAAuB,CAACL,KAAK,EAAI,IAAA,CAAA;MAC3CkD,SAAS,EAAA,YAAA,CAAAxC,MAAA,CAAeL,uBAAuB,CAACH,CAAC,EAAA,MAAA,CAAA,CAAAQ,MAAA,CAAOL,uBAAuB,CAACF,CAAC,EAAA,KAAA,CAAA;AAAK,KAAA,CAAA;AACtF,GAAA,EACEgD,aAAa,CAAC;IAAEC,IAAI,EAAEC,aAAa,CAACvE,YAAAA;GAAc,CAAC,CACxD,CAAC,CAAA;AAEN;;;;"}