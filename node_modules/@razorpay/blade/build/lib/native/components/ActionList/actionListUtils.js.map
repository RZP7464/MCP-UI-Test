{"version":3,"file":"actionListUtils.js","sources":["../../../../../src/components/ActionList/actionListUtils.ts"],"sourcesContent":["import React from 'react';\nimport { componentIds } from './componentIds';\nimport type { ActionListItemProps } from './ActionListItem';\nimport type { OptionsType } from '~components/Dropdown/useDropdown';\nimport { isReactNative } from '~utils';\nimport type { BaseTextProps } from '~components/Typography/BaseText/types';\nimport { getComponentId, isValidAllowedChildren } from '~utils/isValidAllowedChildren';\nimport { throwBladeError } from '~utils/logger';\n\n/**\n * Returns if there is ActionListItem after ActionListSection\n * and an index of last ActionListSection\n *\n * It is used to decide if ActionListSection add divider at the end\n */\nconst getActionListSectionPosition = (\n  children: React.ReactNode,\n): {\n  isActionListItemPresentAfterSection: boolean;\n  lastActionListSectionIndex: number;\n} => {\n  // Creating an array of componentIds\n  const childComponentIdArray = React.Children.toArray(children).map((child) =>\n    getComponentId(child),\n  );\n\n  // Reading the last `ActionListSection` component's index\n  const lastActionListSectionIndex = childComponentIdArray.lastIndexOf(\n    componentIds.ActionListSection,\n  );\n\n  // Checking if there is any `ActionListItem` present after `ActionListSection`\n  const isActionListItemPresentAfterSection = childComponentIdArray\n    .slice(lastActionListSectionIndex)\n    .includes(componentIds.ActionListItem);\n\n  return {\n    isActionListItemPresentAfterSection,\n    lastActionListSectionIndex,\n  };\n};\n\nconst actionListAllowedChildren = [componentIds.ActionListItem, componentIds.ActionListSection];\n\nexport type SectionData = {\n  title: string;\n  hideDivider: boolean;\n  data: ActionListItemProps[];\n}[];\n\n/**\n * Loops over action list items and returns different properties from children like option values, header and footer child, etc\n */\nconst getActionListProperties = (\n  children: React.ReactNode,\n): {\n  sectionData: SectionData;\n  childrenWithId?: React.ReactNode[] | null;\n  actionListOptions: OptionsType;\n} => {\n  const sectionData: SectionData = [];\n  let currentSection: string | null = null;\n  const actionListOptions: OptionsType = [];\n\n  const getActionListItemWithId = (\n    child: React.ReactNode,\n    hideDivider: boolean,\n  ): React.ReactNode => {\n    if (React.isValidElement(child) && !child.props.isDisabled) {\n      actionListOptions.push({\n        title: child.props.title,\n        value: child.props.value,\n        onClickTrigger: (value) => {\n          const anchorLink = child.props.href;\n          child.props.onClick?.({\n            name: child.props.value,\n            value: child.props.isSelected ?? value,\n          });\n\n          if (anchorLink && !isReactNative()) {\n            const target = child.props.target ?? '_self';\n            window.open(anchorLink, target);\n            if (window.top) {\n              window.top.open(anchorLink, target);\n            }\n          }\n        },\n      });\n      const currentIndex = actionListOptions.length - 1;\n\n      const foundSection = sectionData.find((v) => v.title === currentSection);\n      // push the item in the appropriate bucket\n      if (foundSection) {\n        foundSection?.data.push({\n          ...child.props,\n          _index: currentIndex,\n        });\n      } else {\n        // create a new bucket\n        sectionData.push({\n          title: currentSection!,\n          hideDivider,\n          data: [\n            {\n              ...child.props,\n              _index: currentIndex,\n            },\n          ],\n        });\n      }\n\n      const clonedChild = React.cloneElement(child, {\n        // @ts-expect-error: TS doesn't understand the child's props\n        _index: currentIndex,\n      });\n      return clonedChild;\n    }\n\n    return child;\n  };\n\n  let isActionListItemPresentAfterSection: boolean;\n  // eslint-disable-next-line one-var\n  let lastActionListSectionIndex: number;\n\n  if (isReactNative()) {\n    // We're reading this so that we can decide whether to show the divider or not.\n    // If ActionListSection is final item and no ActionListItem is present after that, we hide the divider\n\n    // On web, we do it using descendant styling\n    ({\n      isActionListItemPresentAfterSection,\n      lastActionListSectionIndex,\n    } = getActionListSectionPosition(children));\n  }\n\n  // Looping through ActionListItems to add index to them and get an options array for moving focus between items\n  const childrenWithId = React.Children.map(children, (child, index) => {\n    if (React.isValidElement(child)) {\n      if (isValidAllowedChildren(child, componentIds.ActionListSection)) {\n        const shouldHideDivider =\n          index === lastActionListSectionIndex && !isActionListItemPresentAfterSection;\n        const sectionChildValues: string[] = [];\n        return React.cloneElement(child, {\n          // @ts-expect-error: TS doesn't understand the child's props\n          children: React.Children.map(child.props.children, (childInSection) => {\n            currentSection = child.props.title;\n            sectionChildValues.push(childInSection.props.value);\n            if (isValidAllowedChildren(childInSection, componentIds.ActionListItem)) {\n              return getActionListItemWithId(childInSection, shouldHideDivider);\n            }\n\n            return childInSection;\n          }),\n          // On web, we handle it with descendant styling in css so no need of JS there\n          _hideDivider: isReactNative() ? shouldHideDivider : undefined,\n          _sectionChildValues: sectionChildValues,\n        });\n      }\n\n      if (isValidAllowedChildren(child, componentIds.ActionListItem)) {\n        return getActionListItemWithId(child, true);\n      }\n\n      if (__DEV__) {\n        throwBladeError({\n          message: `Only ${actionListAllowedChildren.join(', ')} supported inside ActionList`,\n          moduleName: 'ActionList',\n        });\n      }\n    }\n    return child;\n  });\n\n  return {\n    sectionData,\n    childrenWithId,\n    actionListOptions,\n  };\n};\n\nconst validateActionListItemProps = ({\n  leading,\n  trailing,\n  titleSuffix,\n}: {\n  leading: ActionListItemProps['leading'];\n  trailing: ActionListItemProps['trailing'];\n  titleSuffix: ActionListItemProps['titleSuffix'];\n}): void => {\n  if (__DEV__) {\n    React.Children.map(trailing, (child) => {\n      if (\n        !isValidAllowedChildren(child, componentIds.ActionListItemIcon) &&\n        !isValidAllowedChildren(child, componentIds.ActionListItemText)\n      ) {\n        throwBladeError({\n          message: `Only ${componentIds.ActionListItemIcon} and ${componentIds.ActionListItemText} are allowed in trailing prop`,\n          moduleName: 'ActionListItem',\n        });\n      }\n    });\n\n    React.Children.map(titleSuffix, (child) => {\n      if (\n        !isValidAllowedChildren(child, componentIds.ActionListItemBadge) &&\n        !isValidAllowedChildren(child, componentIds.ActionListItemBadgeGroup)\n      ) {\n        throwBladeError({\n          message: `Only ${componentIds.ActionListItemBadge} and ${componentIds.ActionListItemBadgeGroup} are allowed in titleSuffix prop`,\n          moduleName: 'ActionListItem',\n        });\n      }\n    });\n\n    React.Children.map(leading, (child) => {\n      if (\n        !isValidAllowedChildren(child, componentIds.ActionListItemIcon) &&\n        !isValidAllowedChildren(child, componentIds.ActionListItemText) &&\n        !isValidAllowedChildren(child, componentIds.ActionListItemAsset) &&\n        !isValidAllowedChildren(child, componentIds.ActionListItemAvatar)\n      ) {\n        throwBladeError({\n          message: `Only ${componentIds.ActionListItemIcon}, ${componentIds.ActionListItemAvatar}, ${componentIds.ActionListItemAsset}, and ${componentIds.ActionListItemText} are allowed in leading prop`,\n          moduleName: 'ActionListItem',\n        });\n      }\n    });\n  }\n};\n\nconst getNormalTextColor = (\n  isDisabled: boolean | undefined,\n  { isMuted }: { isMuted?: boolean } = {},\n): Extract<\n  BaseTextProps['color'],\n  'interactive.text.gray.disabled' | 'interactive.text.gray.muted' | 'interactive.text.gray.normal'\n> => {\n  if (isDisabled) {\n    return 'interactive.text.gray.disabled';\n  }\n\n  if (isMuted) {\n    return 'interactive.text.gray.muted';\n  }\n\n  return 'interactive.text.gray.normal';\n};\n\nexport { getActionListProperties, validateActionListItemProps, getNormalTextColor };\n"],"names":["getActionListSectionPosition","children","childComponentIdArray","React","Children","toArray","map","child","getComponentId","lastActionListSectionIndex","lastIndexOf","componentIds","ActionListSection","isActionListItemPresentAfterSection","slice","includes","ActionListItem","actionListAllowedChildren","getActionListProperties","sectionData","currentSection","actionListOptions","getActionListItemWithId","hideDivider","isValidElement","props","isDisabled","push","title","value","onClickTrigger","_child$props$isSelect","anchorLink","href","onClick","name","isSelected","isReactNative","_child$props$target","target","window","open","top","currentIndex","length","foundSection","find","v","data","Object","assign","_index","clonedChild","cloneElement","_getActionListSection","childrenWithId","index","isValidAllowedChildren","shouldHideDivider","sectionChildValues","childInSection","_hideDivider","undefined","_sectionChildValues","__DEV__","throwBladeError","message","join","moduleName","validateActionListItemProps","_ref","leading","trailing","titleSuffix","ActionListItemIcon","ActionListItemText","ActionListItemBadge","ActionListItemBadgeGroup","ActionListItemAsset","ActionListItemAvatar","getNormalTextColor","_ref2","arguments","isMuted"],"mappings":";;;;;;;;;AAeA,IAAMA,4BAA4B,CAAG,SAA/BA,4BAA4BA,CAChCC,QAAyB,CAItB,CAEH,IAAMC,qBAAqB,CAAGC,cAAK,CAACC,QAAQ,CAACC,OAAO,CAACJ,QAAQ,CAAC,CAACK,GAAG,CAAC,SAACC,KAAK,CACvE,CAAA,OAAAC,cAAc,CAACD,KAAK,CAAC,CACvB,CAAA,CAAC,CAGD,IAAME,0BAA0B,CAAGP,qBAAqB,CAACQ,WAAW,CAClEC,YAAY,CAACC,iBACf,CAAC,CAGD,IAAMC,mCAAmC,CAAGX,qBAAqB,CAC9DY,KAAK,CAACL,0BAA0B,CAAC,CACjCM,QAAQ,CAACJ,YAAY,CAACK,cAAc,CAAC,CAExC,OAAO,CACLH,mCAAmC,CAAnCA,mCAAmC,CACnCJ,0BAA0B,CAA1BA,0BACF,CAAC,CACH,CAAC,CAED,IAAMQ,yBAAyB,CAAG,CAACN,YAAY,CAACK,cAAc,CAAEL,YAAY,CAACC,iBAAiB,CAAC,CAWzF,IAAAM,uBAAuB,CAAG,SAA1BA,uBAAuBA,CAC3BjB,QAAyB,CAKtB,CACH,IAAMkB,WAAwB,CAAG,EAAE,CACnC,IAAIC,cAA6B,CAAG,IAAI,CACxC,IAAMC,iBAA8B,CAAG,EAAE,CAEzC,IAAMC,uBAAuB,CAAG,SAA1BA,uBAAuBA,CAC3Bf,KAAsB,CACtBgB,WAAoB,CACA,CACpB,GAAIpB,cAAK,CAACqB,cAAc,CAACjB,KAAK,CAAC,EAAI,CAACA,KAAK,CAACkB,KAAK,CAACC,UAAU,CAAE,CAC1DL,iBAAiB,CAACM,IAAI,CAAC,CACrBC,KAAK,CAAErB,KAAK,CAACkB,KAAK,CAACG,KAAK,CACxBC,KAAK,CAAEtB,KAAK,CAACkB,KAAK,CAACI,KAAK,CACxBC,cAAc,CAAE,SAAAA,cAACD,CAAAA,KAAK,CAAK,CAAA,IAAAE,qBAAA,CACzB,IAAMC,UAAU,CAAGzB,KAAK,CAACkB,KAAK,CAACQ,IAAI,CACnC1B,KAAK,CAACkB,KAAK,CAACS,OAAO,EAAnB3B,IAAAA,CAAAA,KAAAA,CAAAA,CAAAA,KAAK,CAACkB,KAAK,CAACS,OAAO,CAAG,CACpBC,IAAI,CAAE5B,KAAK,CAACkB,KAAK,CAACI,KAAK,CACvBA,KAAK,CAAA,CAAAE,qBAAA,CAAExB,KAAK,CAACkB,KAAK,CAACW,UAAU,GAAA,IAAA,CAAAL,qBAAA,CAAIF,KACnC,CAAC,CAAC,CAEF,GAAIG,UAAU,EAAI,CAACK,aAAa,EAAE,CAAE,CAAA,IAAAC,mBAAA,CAClC,IAAMC,MAAM,CAAAD,CAAAA,mBAAA,CAAG/B,KAAK,CAACkB,KAAK,CAACc,MAAM,GAAAD,IAAAA,CAAAA,mBAAA,CAAI,OAAO,CAC5CE,MAAM,CAACC,IAAI,CAACT,UAAU,CAAEO,MAAM,CAAC,CAC/B,GAAIC,MAAM,CAACE,GAAG,CAAE,CACdF,MAAM,CAACE,GAAG,CAACD,IAAI,CAACT,UAAU,CAAEO,MAAM,CAAC,CACrC,CACF,CACF,CACF,CAAC,CAAC,CACF,IAAMI,YAAY,CAAGtB,iBAAiB,CAACuB,MAAM,CAAG,CAAC,CAEjD,IAAMC,YAAY,CAAG1B,WAAW,CAAC2B,IAAI,CAAC,SAACC,CAAC,CAAK,CAAA,OAAAA,CAAC,CAACnB,KAAK,GAAKR,cAAc,CAAC,CAAA,CAAA,CAExE,GAAIyB,YAAY,CAAE,CAChBA,YAAY,EAAA,IAAA,CAAA,KAAA,CAAA,CAAZA,YAAY,CAAEG,IAAI,CAACrB,IAAI,CAAAsB,MAAA,CAAAC,MAAA,CAAA,EAAA,CAClB3C,KAAK,CAACkB,KAAK,CAAA,CACd0B,MAAM,CAAER,YAAY,CAAA,CACrB,CAAC,CACJ,CAAC,KAAM,CAELxB,WAAW,CAACQ,IAAI,CAAC,CACfC,KAAK,CAAER,cAAe,CACtBG,WAAW,CAAXA,WAAW,CACXyB,IAAI,CAAE,CAAAC,MAAA,CAAAC,MAAA,CAEC3C,EAAAA,CAAAA,KAAK,CAACkB,KAAK,CACd0B,CAAAA,MAAM,CAAER,YAAY,CAG1B,CAAA,CAAA,CAAC,CAAC,CACJ,CAEA,IAAMS,WAAW,CAAGjD,cAAK,CAACkD,YAAY,CAAC9C,KAAK,CAAE,CAE5C4C,MAAM,CAAER,YACV,CAAC,CAAC,CACF,OAAOS,WAAW,CACpB,CAEA,OAAO7C,KAAK,CACd,CAAC,CAED,IAAIM,mCAA4C,CAEhD,IAAIJ,0BAAkC,CAEtC,GAAI4B,aAAa,EAAE,CAAE,CAAAiB,IAAAA,qBAAA,CAQftD,4BAA4B,CAACC,QAAQ,CAAC,CAFxCY,mCAAmC,CAAAyC,qBAAA,CAAnCzC,mCAAmC,CACnCJ,0BAA0B,CAAA6C,qBAAA,CAA1B7C,0BAA0B,CAE9B,CAGA,IAAM8C,cAAc,CAAGpD,cAAK,CAACC,QAAQ,CAACE,GAAG,CAACL,QAAQ,CAAE,SAACM,KAAK,CAAEiD,KAAK,CAAK,CACpE,GAAIrD,cAAK,CAACqB,cAAc,CAACjB,KAAK,CAAC,CAAE,CAC/B,GAAIkD,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACC,iBAAiB,CAAC,CAAE,CACjE,IAAM8C,iBAAiB,CACrBF,KAAK,GAAK/C,0BAA0B,EAAI,CAACI,mCAAmC,CAC9E,IAAM8C,kBAA4B,CAAG,EAAE,CACvC,OAAOxD,cAAK,CAACkD,YAAY,CAAC9C,KAAK,CAAE,CAE/BN,QAAQ,CAAEE,cAAK,CAACC,QAAQ,CAACE,GAAG,CAACC,KAAK,CAACkB,KAAK,CAACxB,QAAQ,CAAE,SAAC2D,cAAc,CAAK,CACrExC,cAAc,CAAGb,KAAK,CAACkB,KAAK,CAACG,KAAK,CAClC+B,kBAAkB,CAAChC,IAAI,CAACiC,cAAc,CAACnC,KAAK,CAACI,KAAK,CAAC,CACnD,GAAI4B,sBAAsB,CAACG,cAAc,CAAEjD,YAAY,CAACK,cAAc,CAAC,CAAE,CACvE,OAAOM,uBAAuB,CAACsC,cAAc,CAAEF,iBAAiB,CAAC,CACnE,CAEA,OAAOE,cAAc,CACvB,CAAC,CAAC,CAEFC,YAAY,CAAExB,aAAa,EAAE,CAAGqB,iBAAiB,CAAGI,SAAS,CAC7DC,mBAAmB,CAAEJ,kBACvB,CAAC,CAAC,CACJ,CAEA,GAAIF,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACK,cAAc,CAAC,CAAE,CAC9D,OAAOM,uBAAuB,CAACf,KAAK,CAAE,IAAI,CAAC,CAC7C,CAEA,GAAIyD,OAAO,CAAE,CACXC,eAAe,CAAC,CACdC,OAAO,CAAE,CAAQjD,KAAAA,EAAAA,yBAAyB,CAACkD,IAAI,CAAC,IAAI,CAAC,CAA8B,4BAAA,CAAA,CACnFC,UAAU,CAAE,YACd,CAAC,CAAC,CACJ,CACF,CACA,OAAO7D,KAAK,CACd,CAAC,CAAC,CAEF,OAAO,CACLY,WAAW,CAAXA,WAAW,CACXoC,cAAc,CAAdA,cAAc,CACdlC,iBAAiB,CAAjBA,iBACF,CAAC,CACH,EAEM,IAAAgD,2BAA2B,CAAG,SAA9BA,2BAA2BA,CAAAC,IAAA,CAQrB,CAAA,IAPVC,OAAO,CAAAD,IAAA,CAAPC,OAAO,CACPC,QAAQ,CAAAF,IAAA,CAARE,QAAQ,CACRC,WAAW,CAAAH,IAAA,CAAXG,WAAW,CAMX,GAAIT,OAAO,CAAE,CACX7D,cAAK,CAACC,QAAQ,CAACE,GAAG,CAACkE,QAAQ,CAAE,SAACjE,KAAK,CAAK,CACtC,GACE,CAACkD,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAAC+D,kBAAkB,CAAC,EAC/D,CAACjB,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACgE,kBAAkB,CAAC,CAC/D,CACAV,eAAe,CAAC,CACdC,OAAO,CAAE,CAAA,KAAA,EAAQvD,YAAY,CAAC+D,kBAAkB,CAAA,KAAA,EAAQ/D,YAAY,CAACgE,kBAAkB,CAAA,6BAAA,CAA+B,CACtHP,UAAU,CAAE,gBACd,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CAEFjE,cAAK,CAACC,QAAQ,CAACE,GAAG,CAACmE,WAAW,CAAE,SAAClE,KAAK,CAAK,CACzC,GACE,CAACkD,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACiE,mBAAmB,CAAC,EAChE,CAACnB,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACkE,wBAAwB,CAAC,CACrE,CACAZ,eAAe,CAAC,CACdC,OAAO,CAAE,CAAQvD,KAAAA,EAAAA,YAAY,CAACiE,mBAAmB,CAAQjE,KAAAA,EAAAA,YAAY,CAACkE,wBAAwB,CAAkC,gCAAA,CAAA,CAChIT,UAAU,CAAE,gBACd,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CAEFjE,cAAK,CAACC,QAAQ,CAACE,GAAG,CAACiE,OAAO,CAAE,SAAChE,KAAK,CAAK,CACrC,GACE,CAACkD,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAAC+D,kBAAkB,CAAC,EAC/D,CAACjB,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACgE,kBAAkB,CAAC,EAC/D,CAAClB,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACmE,mBAAmB,CAAC,EAChE,CAACrB,sBAAsB,CAAClD,KAAK,CAAEI,YAAY,CAACoE,oBAAoB,CAAC,CACjE,CACAd,eAAe,CAAC,CACdC,OAAO,CAAE,CAAA,KAAA,EAAQvD,YAAY,CAAC+D,kBAAkB,CAAA,EAAA,EAAK/D,YAAY,CAACoE,oBAAoB,CAAA,EAAA,EAAKpE,YAAY,CAACmE,mBAAmB,CAAA,MAAA,EAASnE,YAAY,CAACgE,kBAAkB,CAAA,4BAAA,CAA8B,CACjMP,UAAU,CAAE,gBACd,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CACJ,CACF,EAEM,IAAAY,kBAAkB,CAAG,SAArBA,kBAAkBA,CACtBtD,UAA+B,CAK5B,CAAA,IAAAuD,KAAA,CAAAC,SAAA,CAAAtC,MAAA,CAAA,CAAA,EAAAsC,SAAA,CAAA,CAAA,CAAA,GAAApB,SAAA,CAAAoB,SAAA,CAAA,CAAA,CAAA,CAJkC,EAAE,CAArCC,OAAO,CAAAF,KAAA,CAAPE,OAAO,CAKT,GAAIzD,UAAU,CAAE,CACd,OAAO,gCAAgC,CACzC,CAEA,GAAIyD,OAAO,CAAE,CACX,OAAO,6BAA6B,CACtC,CAEA,OAAO,8BAA8B,CACvC;;;;"}