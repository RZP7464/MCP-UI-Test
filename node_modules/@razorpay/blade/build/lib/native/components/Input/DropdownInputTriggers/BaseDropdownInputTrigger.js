import React__default from 'react';
import { BaseInput } from '../BaseInput/BaseInput.js';
import { InputChevronIcon } from './InputChevronIcon.native.js';
import { useDropdown } from '../../Dropdown/useDropdown.js';
import 'react-native';
import '@babel/runtime/helpers/slicedToArray';
import { isReactNative } from '../../../utils/platform/isReactNative.js';
import '../../BladeProvider/useTheme.js';
import { getActionListContainerRole } from '../../ActionList/getA11yRoles.js';
import '@babel/runtime/helpers/defineProperty';
import { MetaConstants } from '../../../utils/metaAttribute/metaConstants.js';
import { getTagsGroup } from '../../Tag/getTagsGroup.js';
import { useTableContext } from '../../Table/TableContext.js';
import { rowDensityToIsTableInputCellMapping, tableEditableCellRowDensityToInputSizeMap, validationStateToInputTrailingIconMap } from '../../Table/tokens.js';
import { useTableEditableCell } from '../../Table/TableEditableCellContext.js';
import { makeAnalyticsAttribute } from '../../../utils/makeAnalyticsAttribute/makeAnalyticsAttribute.js';
import { dropdownComponentIds } from '../../Dropdown/dropdownComponentIds.js';
import { useControlledDropdownInput } from '../../../utils/useControlledDropdownInput/useControlledDropdownInput.js';
import { jsx } from 'react/jsx-runtime';

var _BaseDropdownInputTrigger=function _BaseDropdownInputTrigger(props,ref){var _props$placeholder,_props$validationStat,_props$maxRows,_props$label;var _useDropdown=useDropdown(),isOpen=_useDropdown.isOpen,activeTagIndex=_useDropdown.activeTagIndex,setActiveTagIndex=_useDropdown.setActiveTagIndex,displayValue=_useDropdown.displayValue,selectionType=_useDropdown.selectionType,dropdownTriggerer=_useDropdown.dropdownTriggerer,dropdownBaseId=_useDropdown.dropdownBaseId,selectedIndices=_useDropdown.selectedIndices,triggererRef=_useDropdown.triggererRef,headerAutoCompleteRef=_useDropdown.headerAutoCompleteRef,triggererWrapperRef=_useDropdown.triggererWrapperRef,isTagDismissedRef=_useDropdown.isTagDismissedRef,onTriggerClick=_useDropdown.onTriggerClick,value=_useDropdown.value,shouldIgnoreBlurAnimation=_useDropdown.shouldIgnoreBlurAnimation,setShouldIgnoreBlurAnimation=_useDropdown.setShouldIgnoreBlurAnimation,activeIndex=_useDropdown.activeIndex,hasFooterAction=_useDropdown.hasFooterAction,options=_useDropdown.options,removeOption=_useDropdown.removeOption,setChangeCallbackTriggerer=_useDropdown.setChangeCallbackTriggerer,changeCallbackTriggerer=_useDropdown.changeCallbackTriggerer;var _useTableContext=useTableContext(),rowDensity=_useTableContext.rowDensity;var _useTableEditableCell=useTableEditableCell(),isInsideTableEditableCell=_useTableEditableCell.isInsideTableEditableCell;var dropdownTriggerPlaceholder=(_props$placeholder=props.placeholder)!=null?_props$placeholder:'Select Option';var isAutoCompleteInHeader=!props.isSelectInput&&dropdownTriggerer!==dropdownComponentIds.triggers.AutoComplete;var getShowAllTags=React__default.useCallback(function(){if(isAutoCompleteInHeader){if(props.isSelectInput){return false;}return true;}return isOpen;},[isAutoCompleteInHeader,props.isSelectInput,isOpen]);useControlledDropdownInput({onChange:props.onChange,name:props.name,value:props.value,defaultValue:props.defaultValue,syncInputValueWithSelection:props.syncInputValueWithSelection,isSelectInput:props.isSelectInput,triggererRef:triggererRef});var getValue=function getValue(){var prefix='';if(props.labelPosition==='inside-input'&&props.label){prefix=`${props.label}: `;}if(props.isSelectInput){if(selectionType==='single'){return `${prefix}${displayValue}`;}return undefined;}return props.inputValue;};var getTags=React__default.useMemo(function(){return function(_ref){var size=_ref.size;if(selectionType==='single'){return undefined;}return getTagsGroup({size:size,tags:selectedIndices.map(function(selectedIndex){var _options$selectedInde;return (_options$selectedInde=options[selectedIndex])==null?void 0:_options$selectedInde.title;}),activeTagIndex:activeTagIndex,isDisabled:props.isDisabled,onDismiss:function onDismiss(_ref2){var tagIndex=_ref2.tagIndex;if(isTagDismissedRef.current){isTagDismissedRef.current.value=true;}if(!isReactNative()){var _triggererRef$current;(_triggererRef$current=triggererRef.current)==null?void 0:_triggererRef$current.focus();}removeOption(selectedIndices[tagIndex]);setChangeCallbackTriggerer(Number(changeCallbackTriggerer)+1);}});};},[selectedIndices,selectionType,activeTagIndex,changeCallbackTriggerer,options]);var tableInputProps={isTableInputCell:rowDensityToIsTableInputCellMapping[rowDensity],id:'table-editable-cell-input',size:tableEditableCellRowDensityToInputSizeMap[rowDensity],trailingIcon:validationStateToInputTrailingIconMap[(_props$validationStat=props.validationState)!=null?_props$validationStat:'none'],showHintsAsTooltip:true};var isValidationStateNone=props.validationState==='none'||props.validationState===undefined;return jsx(BaseInput,Object.assign({as:props.isSelectInput?'button':'input',ref:isReactNative()?null:function(node){if(isAutoCompleteInHeader){headerAutoCompleteRef.current=node;}else {triggererRef.current=node;}if(ref){if(typeof ref==='function'){ref(node);}else {ref.current=node;}}},isDropdownTrigger:true,setInputWrapperRef:function setInputWrapperRef(wrapperNode){if(!isAutoCompleteInHeader){triggererWrapperRef.current=wrapperNode;}},maxTagRows:(_props$maxRows=props.maxRows)!=null?_props$maxRows:'single',tags:getTags({size:props.size||'medium'}),showAllTags:getShowAllTags(),activeTagIndex:activeTagIndex,setActiveTagIndex:setActiveTagIndex,shouldIgnoreBlurAnimation:shouldIgnoreBlurAnimation,setShouldIgnoreBlurAnimation:setShouldIgnoreBlurAnimation,textAlign:"left",label:props.label,placeholder:selectionType==='multiple'&&selectedIndices.length>0?undefined:dropdownTriggerPlaceholder,hideLabelText:((_props$label=props.label)==null?void 0:_props$label.length)===0,accessibilityLabel:props.accessibilityLabel,labelPosition:props.labelPosition==='inside-input'?undefined:props.labelPosition,isLabelInsideInput:props.labelPosition==='inside-input',necessityIndicator:props.necessityIndicator,autoCompleteSuggestionType:"none",validationState:props.validationState,helpText:props.helpText,errorText:props.errorText,successText:props.successText,name:props.name,isDisabled:props.isDisabled,isRequired:props.isRequired,prefix:props.prefix,suffix:props.suffix,valueSuffix:typeof props.valueSuffix==='function'?props.valueSuffix({values:options.filter(function(option,index){return selectedIndices.includes(index);}).map(function(option){return option.value;})}):undefined,autoFocus:props.autoFocus,value:getValue(),onClick:function onClick(e){if(props.isDisabled){return;}props.onTriggerClick==null?void 0:props.onTriggerClick(e);},onFocus:props.onFocus,onBlur:function onBlur(_ref3){var name=_ref3.name;props.onBlur==null?void 0:props.onBlur({name:name,value:value});},leadingIcon:props.icon,componentName:props.isSelectInput?MetaConstants.SelectInput:MetaConstants.AutoComplete,testID:props.testID,id:`${dropdownBaseId}-trigger`,labelId:`${dropdownBaseId}-label`,role:isAutoCompleteInHeader?'searchbox':'combobox',hasPopup:isAutoCompleteInHeader?false:getActionListContainerRole(hasFooterAction,dropdownTriggerer),isPopupExpanded:isOpen,activeDescendant:activeIndex>=0?`${dropdownBaseId}-${activeIndex}`:undefined,popupId:isAutoCompleteInHeader?undefined:`${dropdownBaseId}-actionlist`,onChange:props.isSelectInput?undefined:props.onInputValueChange,onKeyDown:props.onTriggerKeydown,size:props.size},makeAnalyticsAttribute(props),{onTrailingInteractionElementClick:function onTrailingInteractionElementClick(){if(!props.isDisabled){if(!isReactNative()){var _triggererRef$current2;(_triggererRef$current2=triggererRef.current)==null?void 0:_triggererRef$current2.focus();}onTriggerClick();}},trailingInteractionElement:isAutoCompleteInHeader||isInsideTableEditableCell&&!isValidationStateNone?null:jsx(InputChevronIcon,{isDisabled:props.isDisabled,isOpen:isOpen})},isInsideTableEditableCell?tableInputProps:undefined,{tabIndex:isAutoCompleteInHeader?0:undefined}));};var BaseDropdownInputTrigger=React__default.forwardRef(_BaseDropdownInputTrigger);

export { BaseDropdownInputTrigger };
//# sourceMappingURL=BaseDropdownInputTrigger.js.map
