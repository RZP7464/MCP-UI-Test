{"version":3,"file":"CircularProgressBar.native.js","sources":["../../../../../src/components/ProgressBar/CircularProgressBar.native.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport styled from 'styled-components/native';\nimport Animated, {\n  cancelAnimation,\n  useAnimatedStyle,\n  useSharedValue,\n  withDelay,\n  withRepeat,\n  withSequence,\n  withTiming,\n} from 'react-native-reanimated';\nimport { Text as SVGText, Circle } from 'react-native-svg';\nimport type { CircularProgressBarFilledProps } from './types';\nimport { circularProgressSizeTokens, getCircularProgressSVGTokens } from './progressBarTokens';\nimport { CircularProgressLabel } from './CircularProgressLabel';\nimport getIn from '~utils/lodashButBetter/get';\nimport BaseBox from '~components/Box/BaseBox';\nimport { makeMotionTime } from '~utils/makeMotionTime';\nimport type { TextProps } from '~components/Typography';\nimport { getTextProps } from '~components/Typography';\nimport { useTheme } from '~components/BladeProvider';\nimport { castNativeType } from '~utils';\nimport { Svg } from '~components/Icons/_Svg';\nimport getBaseTextStyles from '~components/Typography/BaseText/getBaseTextStyles';\n\nconst pulseAnimation = {\n  opacityInitial: 1,\n  opacityMid: 0.65,\n  opacityFinal: 1,\n};\n\nconst StyledSVGText = styled(SVGText)<Pick<TextProps<{ variant: 'body' }>, 'size' | 'weight'>>(\n  ({ theme, size, weight }) => {\n    const textProps = getTextProps({ variant: 'body', size, weight });\n\n    return {\n      ...getBaseTextStyles({ theme, ...textProps }),\n      strokeWidth: 0,\n      fill:\n        textProps.color === 'currentColor'\n          ? textProps.color\n          : getIn(theme.colors, textProps.color!),\n    };\n  },\n);\n\nconst CircularProgressBarFilled = ({\n  progressPercent,\n  fillColor,\n  backgroundColor,\n  size = 'small',\n  label,\n  showPercentage = true,\n  isMeter,\n  motionEasing,\n  pulseMotionDuration,\n  pulseMotionDelay,\n  fillMotionDuration,\n}: CircularProgressBarFilledProps): React.ReactElement => {\n  const {\n    sqSize,\n    strokeWidth,\n    radius,\n    viewBox,\n    dashArray,\n    dashOffset,\n  } = getCircularProgressSVGTokens({ size, progressPercent });\n\n  const AnimatedCircle = Animated.createAnimatedComponent(Circle);\n  const animatedOpacity = useSharedValue(pulseAnimation.opacityInitial);\n  const animatedStrokeDashoffset = useSharedValue(dashOffset);\n  const { theme } = useTheme();\n  const fillAndPulseEasing = getIn(theme.motion, motionEasing);\n  const pulseDuration =\n    castNativeType(makeMotionTime(getIn(theme.motion, pulseMotionDuration))) / 2;\n\n  // Trigger animation for progress fill\n  useEffect(() => {\n    const fillDuration = castNativeType(makeMotionTime(getIn(theme.motion, fillMotionDuration)));\n    animatedStrokeDashoffset.value = withTiming(dashOffset, {\n      duration: fillDuration,\n      easing: fillAndPulseEasing,\n    });\n    return () => {\n      cancelAnimation(animatedStrokeDashoffset);\n    };\n  }, [dashOffset, animatedStrokeDashoffset, fillMotionDuration, theme, fillAndPulseEasing]);\n\n  // Trigger pulsating animation\n  useEffect(() => {\n    const pulsatingAnimationTimingConfig = {\n      duration: pulseDuration,\n      easing: fillAndPulseEasing,\n    };\n    if (!isMeter) {\n      animatedOpacity.value = withDelay(\n        castNativeType(makeMotionTime(getIn(theme.motion, pulseMotionDelay))),\n        withRepeat(\n          withSequence(\n            withTiming(pulseAnimation.opacityMid, pulsatingAnimationTimingConfig),\n            withTiming(pulseAnimation.opacityFinal, pulsatingAnimationTimingConfig),\n          ),\n          -1,\n        ),\n      );\n    }\n\n    return () => {\n      cancelAnimation(animatedOpacity);\n    };\n  }, [animatedOpacity, fillAndPulseEasing, pulseDuration, pulseMotionDelay, theme, isMeter]);\n\n  const firstIndicatorStyles = useAnimatedStyle(() => {\n    return {\n      strokeDashoffset: animatedStrokeDashoffset.value,\n      opacity: progressPercent < 100 ? animatedOpacity.value : 1,\n    };\n  });\n\n  return (\n    <BaseBox display=\"flex\" width=\"fit-content\" alignItems=\"center\">\n      <Svg width={String(sqSize)} height={String(sqSize)} viewBox={viewBox}>\n        <Circle\n          fill=\"none\"\n          stroke={backgroundColor}\n          cx={String(sqSize / 2)}\n          cy={String(sqSize / 2)}\n          r={String(radius)}\n          strokeWidth={`${strokeWidth}px`}\n        />\n\n        <AnimatedCircle\n          fill=\"none\"\n          stroke={fillColor}\n          cx={sqSize / 2}\n          cy={sqSize / 2}\n          r={radius}\n          strokeWidth={`${strokeWidth}px`}\n          // Start progress marker at 12 O'Clock\n          transform={`rotate(-90 ${sqSize / 2} ${sqSize / 2})`}\n          strokeDasharray={dashArray}\n          strokeDashoffset={dashOffset}\n          style={firstIndicatorStyles}\n        />\n\n        {showPercentage && size !== 'small' && (\n          <StyledSVGText\n            size={circularProgressSizeTokens[size].percentTextSize}\n            weight=\"semibold\"\n            x=\"50%\"\n            y=\"50%\"\n            textAnchor=\"middle\"\n            dy=\".5em\"\n          >\n            {`${progressPercent}%`}\n          </StyledSVGText>\n        )}\n      </Svg>\n\n      <CircularProgressLabel\n        progressPercent={progressPercent}\n        size={size}\n        label={label}\n        showPercentage={showPercentage}\n      />\n    </BaseBox>\n  );\n};\n\nexport { CircularProgressBarFilled };\n"],"names":["pulseAnimation","opacityInitial","opacityMid","opacityFinal","StyledSVGText","styled","SVGText","_ref","theme","size","weight","textProps","getTextProps","variant","Object","assign","getBaseTextStyles","strokeWidth","fill","color","getIn","colors","CircularProgressBarFilled","_ref2","progressPercent","fillColor","backgroundColor","_ref2$size","label","_ref2$showPercentage","showPercentage","isMeter","motionEasing","pulseMotionDuration","pulseMotionDelay","fillMotionDuration","_getCircularProgressS","getCircularProgressSVGTokens","sqSize","radius","viewBox","dashArray","dashOffset","AnimatedCircle","Animated","createAnimatedComponent","Circle","animatedOpacity","useSharedValue","animatedStrokeDashoffset","_useTheme","useTheme","fillAndPulseEasing","motion","pulseDuration","castNativeType","makeMotionTime","useEffect","fillDuration","value","withTiming","duration","easing","cancelAnimation","pulsatingAnimationTimingConfig","withDelay","withRepeat","withSequence","firstIndicatorStyles","useAnimatedStyle","strokeDashoffset","opacity","_jsxs","BaseBox","display","width","alignItems","children","Svg","String","height","_jsx","stroke","cx","cy","r","transform","strokeDasharray","style","circularProgressSizeTokens","percentTextSize","x","y","textAnchor","dy","CircularProgressLabel"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAyBA,IAAMA,cAAc,CAAG,CACrBC,cAAc,CAAE,CAAC,CACjBC,UAAU,CAAE,IAAI,CAChBC,YAAY,CAAE,CAChB,CAAC,CAED,IAAMC,aAAa,CAAGC,MAAM,CAACC,IAAO,CAAC,CACnC,SAAAC,IAAA,CAA6B,CAAA,IAA1BC,KAAK,CAAAD,IAAA,CAALC,KAAK,CAAEC,IAAI,CAAAF,IAAA,CAAJE,IAAI,CAAEC,MAAM,CAAAH,IAAA,CAANG,MAAM,CACpB,IAAMC,SAAS,CAAGC,YAAY,CAAC,CAAEC,OAAO,CAAE,MAAM,CAAEJ,IAAI,CAAJA,IAAI,CAAEC,MAAM,CAANA,MAAO,CAAC,CAAC,CAEjE,OAAAI,MAAA,CAAAC,MAAA,CACKC,EAAAA,CAAAA,iBAAiB,CAAAF,MAAA,CAAAC,MAAA,CAAA,CAAGP,KAAK,CAALA,KAAK,CAAKG,CAAAA,SAAS,CAAE,CAAC,CAC7CM,CAAAA,WAAW,CAAE,CAAC,CACdC,IAAI,CACFP,SAAS,CAACQ,KAAK,GAAK,cAAc,CAC9BR,SAAS,CAACQ,KAAK,CACfC,KAAK,CAACZ,KAAK,CAACa,MAAM,CAAEV,SAAS,CAACQ,KAAM,CAAC,CAE/C,CAAA,CAAA,CACF,CAAC,CAEK,IAAAG,yBAAyB,CAAG,SAA5BA,yBAAyBA,CAAAC,KAAA,CAY2B,CAAA,IAXxDC,eAAe,CAAAD,KAAA,CAAfC,eAAe,CACfC,SAAS,CAAAF,KAAA,CAATE,SAAS,CACTC,eAAe,CAAAH,KAAA,CAAfG,eAAe,CAAAC,UAAA,CAAAJ,KAAA,CACfd,IAAI,CAAJA,IAAI,CAAAkB,UAAA,GAAA,KAAA,CAAA,CAAG,OAAO,CAAAA,UAAA,CACdC,KAAK,CAAAL,KAAA,CAALK,KAAK,CAAAC,oBAAA,CAAAN,KAAA,CACLO,cAAc,CAAdA,cAAc,CAAAD,oBAAA,GAAG,KAAA,CAAA,CAAA,IAAI,CAAAA,oBAAA,CACrBE,OAAO,CAAAR,KAAA,CAAPQ,OAAO,CACPC,YAAY,CAAAT,KAAA,CAAZS,YAAY,CACZC,mBAAmB,CAAAV,KAAA,CAAnBU,mBAAmB,CACnBC,gBAAgB,CAAAX,KAAA,CAAhBW,gBAAgB,CAChBC,kBAAkB,CAAAZ,KAAA,CAAlBY,kBAAkB,CAElB,IAAAC,qBAAA,CAOIC,4BAA4B,CAAC,CAAE5B,IAAI,CAAJA,IAAI,CAAEe,eAAe,CAAfA,eAAgB,CAAC,CAAC,CANzDc,MAAM,CAAAF,qBAAA,CAANE,MAAM,CACNrB,WAAW,CAAAmB,qBAAA,CAAXnB,WAAW,CACXsB,MAAM,CAAAH,qBAAA,CAANG,MAAM,CACNC,OAAO,CAAAJ,qBAAA,CAAPI,OAAO,CACPC,SAAS,CAAAL,qBAAA,CAATK,SAAS,CACTC,UAAU,CAAAN,qBAAA,CAAVM,UAAU,CAGZ,IAAMC,cAAc,CAAGC,QAAQ,CAACC,uBAAuB,CAACC,MAAM,CAAC,CAC/D,IAAMC,eAAe,CAAGC,cAAc,CAAChD,cAAc,CAACC,cAAc,CAAC,CACrE,IAAMgD,wBAAwB,CAAGD,cAAc,CAACN,UAAU,CAAC,CAC3D,IAAAQ,SAAA,CAAkBC,QAAQ,EAAE,CAApB3C,KAAK,CAAA0C,SAAA,CAAL1C,KAAK,CACb,IAAM4C,kBAAkB,CAAGhC,KAAK,CAACZ,KAAK,CAAC6C,MAAM,CAAErB,YAAY,CAAC,CAC5D,IAAMsB,aAAa,CACjBC,cAAc,CAACC,cAAc,CAACpC,KAAK,CAACZ,KAAK,CAAC6C,MAAM,CAAEpB,mBAAmB,CAAC,CAAC,CAAC,CAAG,CAAC,CAG9EwB,SAAS,CAAC,UAAM,CACd,IAAMC,YAAY,CAAGH,cAAc,CAACC,cAAc,CAACpC,KAAK,CAACZ,KAAK,CAAC6C,MAAM,CAAElB,kBAAkB,CAAC,CAAC,CAAC,CAC5Fc,wBAAwB,CAACU,KAAK,CAAGC,UAAU,CAAClB,UAAU,CAAE,CACtDmB,QAAQ,CAAEH,YAAY,CACtBI,MAAM,CAAEV,kBACV,CAAC,CAAC,CACF,OAAa,UAAA,CACXW,eAAe,CAACd,wBAAwB,CAAC,CAC3C,CAAC,CACH,CAAC,CAAE,CAACP,UAAU,CAAEO,wBAAwB,CAAEd,kBAAkB,CAAE3B,KAAK,CAAE4C,kBAAkB,CAAC,CAAC,CAGzFK,SAAS,CAAC,UAAM,CACd,IAAMO,8BAA8B,CAAG,CACrCH,QAAQ,CAAEP,aAAa,CACvBQ,MAAM,CAAEV,kBACV,CAAC,CACD,GAAI,CAACrB,OAAO,CAAE,CACZgB,eAAe,CAACY,KAAK,CAAGM,SAAS,CAC/BV,cAAc,CAACC,cAAc,CAACpC,KAAK,CAACZ,KAAK,CAAC6C,MAAM,CAAEnB,gBAAgB,CAAC,CAAC,CAAC,CACrEgC,UAAU,CACRC,YAAY,CACVP,UAAU,CAAC5D,cAAc,CAACE,UAAU,CAAE8D,8BAA8B,CAAC,CACrEJ,UAAU,CAAC5D,cAAc,CAACG,YAAY,CAAE6D,8BAA8B,CACxE,CAAC,CACD,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAa,UAAA,CACXD,eAAe,CAAChB,eAAe,CAAC,CAClC,CAAC,CACH,CAAC,CAAE,CAACA,eAAe,CAAEK,kBAAkB,CAAEE,aAAa,CAAEpB,gBAAgB,CAAE1B,KAAK,CAAEuB,OAAO,CAAC,CAAC,CAE1F,IAAMqC,oBAAoB,CAAGC,gBAAgB,CAAC,UAAM,CAClD,OAAO,CACLC,gBAAgB,CAAErB,wBAAwB,CAACU,KAAK,CAChDY,OAAO,CAAE/C,eAAe,CAAG,GAAG,CAAGuB,eAAe,CAACY,KAAK,CAAG,CAC3D,CAAC,CACH,CAAC,CAAC,CAEF,OACEa,IAAA,CAACC,OAAO,EAACC,OAAO,CAAC,MAAM,CAACC,KAAK,CAAC,aAAa,CAACC,UAAU,CAAC,QAAQ,CAAAC,QAAA,CAC7DL,CAAAA,IAAA,CAACM,GAAG,CAACH,CAAAA,KAAK,CAAEI,MAAM,CAACzC,MAAM,CAAE,CAAC0C,MAAM,CAAED,MAAM,CAACzC,MAAM,CAAE,CAACE,OAAO,CAAEA,OAAQ,CAAAqC,QAAA,CAAA,CACnEI,GAAA,CAACnC,MAAM,CACL5B,CAAAA,IAAI,CAAC,MAAM,CACXgE,MAAM,CAAExD,eAAgB,CACxByD,EAAE,CAAEJ,MAAM,CAACzC,MAAM,CAAG,CAAC,CAAE,CACvB8C,EAAE,CAAEL,MAAM,CAACzC,MAAM,CAAG,CAAC,CAAE,CACvB+C,CAAC,CAAEN,MAAM,CAACxC,MAAM,CAAE,CAClBtB,WAAW,CAAE,CAAGA,EAAAA,WAAW,IAAK,CACjC,CAAC,CAEFgE,GAAA,CAACtC,cAAc,EACbzB,IAAI,CAAC,MAAM,CACXgE,MAAM,CAAEzD,SAAU,CAClB0D,EAAE,CAAE7C,MAAM,CAAG,CAAE,CACf8C,EAAE,CAAE9C,MAAM,CAAG,CAAE,CACf+C,CAAC,CAAE9C,MAAO,CACVtB,WAAW,CAAE,GAAGA,WAAW,CAAA,EAAA,CAAK,CAEhCqE,SAAS,CAAE,cAAchD,MAAM,CAAG,CAAC,CAAA,CAAA,EAAIA,MAAM,CAAG,CAAC,CAAI,CAAA,CAAA,CACrDiD,eAAe,CAAE9C,SAAU,CAC3B6B,gBAAgB,CAAE5B,UAAW,CAC7B8C,KAAK,CAAEpB,oBAAqB,CAC7B,CAAC,CAEDtC,cAAc,EAAIrB,IAAI,GAAK,OAAO,EACjCwE,GAAA,CAAC7E,aAAa,CAAA,CACZK,IAAI,CAAEgF,0BAA0B,CAAChF,IAAI,CAAC,CAACiF,eAAgB,CACvDhF,MAAM,CAAC,UAAU,CACjBiF,CAAC,CAAC,KAAK,CACPC,CAAC,CAAC,KAAK,CACPC,UAAU,CAAC,QAAQ,CACnBC,EAAE,CAAC,MAAM,CAAAjB,QAAA,CAER,CAAA,EAAGrD,eAAe,CAAA,CAAA,CAAG,CACT,CAChB,CAAA,CACE,CAAC,CAENyD,GAAA,CAACc,qBAAqB,CACpBvE,CAAAA,eAAe,CAAEA,eAAgB,CACjCf,IAAI,CAAEA,IAAK,CACXmB,KAAK,CAAEA,KAAM,CACbE,cAAc,CAAEA,cAAe,CAChC,CAAC,CAAA,CACK,CAAC,CAEd;;;;"}