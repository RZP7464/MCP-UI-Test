{"version":3,"file":"ProgressBarFilled.native.js","sources":["../../../../../src/components/ProgressBar/ProgressBarFilled.native.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport Animated, {\n  cancelAnimation,\n  Easing,\n  useAnimatedStyle,\n  useSharedValue,\n  withDelay,\n  withRepeat,\n  withSequence,\n  withTiming,\n} from 'react-native-reanimated';\nimport type { ProgressBarFilledProps } from './types';\nimport { indeterminateAnimation, pulseAnimation } from './progressBarTokens';\nimport getIn from '~utils/lodashButBetter/get';\nimport { useTheme } from '~components/BladeProvider';\nimport { castNativeType } from '~utils';\nimport { makeMotionTime } from '~utils/makeMotionTime';\n\nconst ProgressBarIndeterminateFilledContainer = styled(Animated.View)<\n  Pick<ProgressBarFilledProps, 'backgroundColor' | 'progress'>\n>(({ backgroundColor }) => ({\n  backgroundColor,\n  height: '100%',\n  width: indeterminateAnimation.fillWidth,\n  position: 'absolute',\n}));\n\nconst ProgressBarDeterminateFilledContainer = styled(Animated.View)<\n  Pick<ProgressBarFilledProps, 'backgroundColor' | 'progress'>\n>(({ backgroundColor, progress }) => ({\n  backgroundColor,\n  height: '100%',\n  width: `${progress}%`,\n}));\n\nconst ProgressBarPulseAnimation = styled(Animated.View)({\n  backgroundColor: pulseAnimation.backgroundColor,\n  opacity: pulseAnimation.opacityInitial,\n  width: '100%',\n  height: '100%',\n});\n\nconst ProgressBarFilled = ({\n  backgroundColor,\n  progress,\n  fillMotionDuration,\n  motionEasing,\n  pulseMotionDuration,\n  pulseMotionDelay,\n  type,\n  isIndeterminate,\n  indeterminateMotionDuration,\n}: ProgressBarFilledProps): React.ReactElement => {\n  const animatedWidth = useSharedValue(progress); // for progress fill animation\n  const animatedOpacity = useSharedValue(pulseAnimation.opacityInitial); // for pulse animation\n  const animatedScaleX = useSharedValue(indeterminateAnimation.scaleXInitial); // for indeterminate scale animation\n  const animatedLeft = useSharedValue(indeterminateAnimation.leftInitial); // for indeterminate slide animation\n\n  const { theme } = useTheme();\n  const fillAndPulseEasing = getIn(theme.motion, motionEasing);\n  const pulseDuration =\n    castNativeType(makeMotionTime(getIn(theme.motion, pulseMotionDuration))) / 2; // divided by 2 since we animate it with 2 steps in a sequence\n\n  // Trigger animation for progress fill\n  useEffect(() => {\n    const fillDuration = castNativeType(makeMotionTime(getIn(theme.motion, fillMotionDuration)));\n    animatedWidth.value = withTiming(progress, {\n      duration: fillDuration,\n      easing: fillAndPulseEasing,\n    });\n    return () => {\n      cancelAnimation(animatedWidth);\n    };\n  }, [progress, animatedWidth, fillMotionDuration, theme, fillAndPulseEasing]);\n\n  // Animated styles for progress fill animation\n  const progressFillAnimatedStyle = useAnimatedStyle(() => {\n    return {\n      width: `${animatedWidth.value}%`,\n    };\n  });\n\n  // Trigger animation for indeterminate progress bar\n  useEffect(() => {\n    if (type === 'progress' && isIndeterminate) {\n      const indeterminateDuration = castNativeType(\n        makeMotionTime(getIn(theme.motion, indeterminateMotionDuration)),\n      );\n      const indeterminateEasing = Easing.linear;\n\n      // Sliding animation\n      animatedLeft.value = withRepeat(\n        withTiming(indeterminateAnimation.leftFinal, {\n          duration: indeterminateDuration,\n          easing: indeterminateEasing,\n        }),\n        -1,\n      );\n\n      // Scaling animation\n      animatedScaleX.value = withRepeat(\n        withSequence(\n          withTiming(indeterminateAnimation.scaleXMid, {\n            duration: indeterminateDuration / 2, // divided by 2 since we animate it with 2 steps in a sequence\n            easing: indeterminateEasing,\n          }),\n          withTiming(indeterminateAnimation.scaleXFinal, {\n            duration: indeterminateDuration / 2, // divided by 2 since we animate it with 2 steps in a sequence\n            easing: indeterminateEasing,\n          }),\n        ),\n        -1,\n      );\n    }\n\n    return () => {\n      cancelAnimation(animatedLeft);\n      cancelAnimation(animatedScaleX);\n    };\n  }, [animatedLeft, animatedScaleX, indeterminateMotionDuration, isIndeterminate, theme, type]);\n\n  // Animated styles for indeterminate animation\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  //@ts-expect-error TS errors originating from reanimated. Should be fixed in future versions. Ref: https://github.com/software-mansion/react-native-reanimated/issues/4840\n  const indeterminateAnimatedStyle = useAnimatedStyle(() => {\n    return {\n      left: animatedLeft.value,\n      transform: [{ scaleX: animatedScaleX.value }],\n    };\n  });\n\n  //Trigger pulsating animation\n  useEffect(() => {\n    const pulsatingAnimationTimingConfig = {\n      duration: pulseDuration,\n      easing: fillAndPulseEasing,\n    };\n    if (type === 'progress') {\n      animatedOpacity.value = withDelay(\n        castNativeType(makeMotionTime(getIn(theme.motion, pulseMotionDelay))),\n        withRepeat(\n          withSequence(\n            withTiming(pulseAnimation.opacityMid, pulsatingAnimationTimingConfig),\n            withTiming(pulseAnimation.opacityFinal, pulsatingAnimationTimingConfig),\n          ),\n          -1,\n        ),\n      );\n    }\n\n    return () => {\n      cancelAnimation(animatedOpacity);\n    };\n  }, [animatedOpacity, fillAndPulseEasing, pulseDuration, pulseMotionDelay, theme, type]);\n\n  // Animated styles for pulse animation\n  const pulseAnimatedStyle = useAnimatedStyle(() => {\n    return {\n      opacity: animatedOpacity.value,\n    };\n  });\n\n  const ProgressBarFilledContainer = isIndeterminate\n    ? ProgressBarIndeterminateFilledContainer\n    : ProgressBarDeterminateFilledContainer;\n\n  return (\n    <ProgressBarFilledContainer\n      style={isIndeterminate ? indeterminateAnimatedStyle : progressFillAnimatedStyle}\n      backgroundColor={backgroundColor}\n      progress={progress}\n    >\n      <ProgressBarPulseAnimation style={pulseAnimatedStyle} />\n    </ProgressBarFilledContainer>\n  );\n};\n\nexport type { ProgressBarFilledProps };\nexport { ProgressBarFilled };\n"],"names":["ProgressBarIndeterminateFilledContainer","styled","Animated","View","_ref","backgroundColor","height","width","indeterminateAnimation","fillWidth","position","ProgressBarDeterminateFilledContainer","_ref2","progress","ProgressBarPulseAnimation","pulseAnimation","opacity","opacityInitial","ProgressBarFilled","_ref3","fillMotionDuration","motionEasing","pulseMotionDuration","pulseMotionDelay","type","isIndeterminate","indeterminateMotionDuration","animatedWidth","useSharedValue","animatedOpacity","animatedScaleX","scaleXInitial","animatedLeft","leftInitial","_useTheme","useTheme","theme","fillAndPulseEasing","getIn","motion","pulseDuration","castNativeType","makeMotionTime","useEffect","fillDuration","value","withTiming","duration","easing","cancelAnimation","progressFillAnimatedStyle","useAnimatedStyle","indeterminateDuration","indeterminateEasing","Easing","linear","withRepeat","leftFinal","withSequence","scaleXMid","scaleXFinal","indeterminateAnimatedStyle","left","transform","scaleX","pulsatingAnimationTimingConfig","withDelay","opacityMid","opacityFinal","pulseAnimatedStyle","ProgressBarFilledContainer","_jsx","style","children"],"mappings":"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"}