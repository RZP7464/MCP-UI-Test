{"version":3,"file":"Popover.native.js","sources":["../../../../../src/components/Popover/Popover.native.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/restrict-plus-operands */\nimport { arrow, shift, useFloating, flip, offset } from '@floating-ui/react-native';\nimport React from 'react';\nimport { Modal, TouchableOpacity } from 'react-native';\nimport { PopoverContent } from './PopoverContent';\nimport type { PopoverProps } from './types';\nimport { ARROW_HEIGHT, ARROW_WIDTH } from './constants';\nimport { PopoverContext } from './PopoverContext';\nimport { useTheme } from '~components/BladeProvider';\nimport { metaAttribute, MetaConstants } from '~utils/metaAttribute';\nimport { mergeProps } from '~utils/mergeProps';\nimport { useControllableState } from '~utils/useControllable';\nimport { PopupArrow } from '~components/PopupArrow';\nimport { getFloatingPlacementParts } from '~utils/getFloatingPlacementParts';\nimport { componentZIndices } from '~utils/componentZIndices';\n\nconst Popover = ({\n  content,\n  children,\n  placement = 'top',\n  onOpenChange,\n  zIndex = componentZIndices.popover,\n  title,\n  titleLeading,\n  footer,\n  isOpen,\n  defaultIsOpen,\n}: PopoverProps): React.ReactElement => {\n  const { theme } = useTheme();\n  const defaultInitialFocusRef = React.useRef(null);\n  const [controllableIsOpen, controllableSetIsOpen] = useControllableState({\n    value: isOpen,\n    defaultValue: defaultIsOpen,\n    onChange: (isOpen) => onOpenChange?.({ isOpen }),\n  });\n\n  const gap = theme.spacing[2];\n  const [side] = getFloatingPlacementParts(placement);\n  const isHorizontal = side === 'left' || side === 'right';\n  const arrowRef = React.useRef();\n  const context = useFloating({\n    sameScrollView: false,\n    placement,\n    middleware: [\n      shift({ crossAxis: false, padding: gap }),\n      flip({ padding: gap, fallbackAxisSideDirection: 'start' }),\n      offset(gap + ARROW_HEIGHT),\n      arrow({\n        element: arrowRef,\n        padding: isHorizontal ? 0 : ARROW_WIDTH,\n      }),\n    ],\n  });\n\n  const { refs, floatingStyles } = context;\n  const [computedSide] = getFloatingPlacementParts(context.placement);\n\n  const handleOpen = React.useCallback(() => {\n    controllableSetIsOpen(() => true);\n    onOpenChange?.({ isOpen: true });\n  }, [controllableSetIsOpen, onOpenChange]);\n\n  const handleClose = React.useCallback(() => {\n    controllableSetIsOpen(() => false);\n    onOpenChange?.({ isOpen: false });\n  }, [controllableSetIsOpen, onOpenChange]);\n\n  // wait for animation to finish before unmounting modal\n  const [isVisible, setIsVisible] = React.useState(() => controllableIsOpen);\n  React.useEffect(() => {\n    const id = setTimeout(() => {\n      if (!controllableIsOpen) {\n        setIsVisible(false);\n      }\n    }, theme.motion.duration.gentle);\n\n    if (controllableIsOpen) {\n      setIsVisible(true);\n    }\n    return () => clearTimeout(id);\n  }, [controllableIsOpen]);\n\n  const contextValue = React.useMemo(() => {\n    return {\n      close: handleClose,\n      defaultInitialFocusRef,\n      titleId: undefined,\n      openInteraction: 'click' as const,\n    };\n  }, [handleClose]);\n\n  return (\n    <PopoverContext.Provider value={contextValue}>\n      {/* Cloning the trigger children to enhance it with ref and event handler */}\n      {React.cloneElement(children, {\n        ...mergeProps(\n          {\n            onTouchEnd: children.props.onTouchEnd,\n          },\n          { onTouchEnd: handleOpen },\n        ),\n        ref: refs.setReference,\n      })}\n      <Modal\n        collapsable={false}\n        transparent\n        visible={Boolean(isVisible)}\n        {...metaAttribute({ testID: 'popover-modal' })}\n      >\n        <TouchableOpacity\n          style={{\n            position: 'absolute',\n            top: 0,\n            bottom: 0,\n            left: 0,\n            right: 0,\n          }}\n          onPress={handleClose}\n          activeOpacity={1}\n          testID=\"popover-modal-backdrop\"\n          {...metaAttribute({ name: MetaConstants.Popover })}\n        />\n        <PopoverContent\n          titleLeading={titleLeading}\n          title={title}\n          footer={footer}\n          isVisible={controllableIsOpen}\n          ref={refs.setFloating}\n          side={computedSide}\n          style={{\n            ...floatingStyles,\n            // TODO: Tokenize zIndex values\n            zIndex,\n          }}\n          arrow={\n            <PopupArrow\n              ref={arrowRef as never}\n              context={context}\n              width={ARROW_WIDTH}\n              height={ARROW_HEIGHT}\n              fillColor={theme.colors.popup.background.subtle}\n              strokeColor={theme.colors.popup.border.subtle}\n            />\n          }\n        >\n          {content}\n        </PopoverContent>\n      </Modal>\n    </PopoverContext.Provider>\n  );\n};\n\nexport { Popover };\n"],"names":["Popover","_ref","content","children","_ref$placement","placement","onOpenChange","_ref$zIndex","zIndex","componentZIndices","popover","title","titleLeading","footer","isOpen","defaultIsOpen","_useTheme","useTheme","theme","defaultInitialFocusRef","React","useRef","_useControllableState","useControllableState","value","defaultValue","onChange","_useControllableState2","_slicedToArray","controllableIsOpen","controllableSetIsOpen","gap","spacing","_getFloatingPlacement","getFloatingPlacementParts","_getFloatingPlacement2","side","isHorizontal","arrowRef","context","useFloating","sameScrollView","middleware","shift","crossAxis","padding","flip","fallbackAxisSideDirection","offset","ARROW_HEIGHT","arrow","element","ARROW_WIDTH","refs","floatingStyles","_getFloatingPlacement3","_getFloatingPlacement4","computedSide","handleOpen","useCallback","handleClose","_React$useState","useState","_React$useState2","isVisible","setIsVisible","useEffect","id","setTimeout","motion","duration","gentle","clearTimeout","contextValue","useMemo","close","titleId","undefined","openInteraction","_jsxs","PopoverContext","Provider","cloneElement","Object","assign","mergeProps","onTouchEnd","props","ref","setReference","Modal","collapsable","transparent","visible","Boolean","metaAttribute","testID","_jsx","TouchableOpacity","style","position","top","bottom","left","right","onPress","activeOpacity","name","MetaConstants","PopoverContent","setFloating","PopupArrow","width","height","fillColor","colors","popup","background","subtle","strokeColor","border"],"mappings":"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"}