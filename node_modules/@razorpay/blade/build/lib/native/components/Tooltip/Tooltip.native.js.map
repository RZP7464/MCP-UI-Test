{"version":3,"file":"Tooltip.native.js","sources":["../../../../../src/components/Tooltip/Tooltip.native.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/restrict-plus-operands */\nimport { arrow, shift, useFloating, flip, offset } from '@floating-ui/react-native';\nimport React from 'react';\nimport { Modal, TouchableOpacity } from 'react-native';\nimport { TooltipContent } from './TooltipContent';\nimport type { TooltipProps } from './types';\nimport { ARROW_HEIGHT, ARROW_WIDTH } from './constants';\nimport { TooltipContext } from './TooltipContext';\nimport { useTheme } from '~components/BladeProvider';\nimport { metaAttribute, MetaConstants } from '~utils/metaAttribute';\nimport { mergeProps } from '~utils/mergeProps';\nimport { PopupArrow } from '~components/PopupArrow';\nimport { getFloatingPlacementParts } from '~utils/getFloatingPlacementParts';\nimport { componentZIndices } from '~utils/componentZIndices';\n\nconst Tooltip = ({\n  title,\n  content,\n  children,\n  placement = 'left',\n  onOpenChange,\n  zIndex = componentZIndices.tooltip,\n}: TooltipProps): React.ReactElement => {\n  const { theme } = useTheme();\n  const [isOpen, setIsOpen] = React.useState(false);\n\n  const gap = theme.spacing[2];\n  const [side] = getFloatingPlacementParts(placement);\n  const isHorizontal = side === 'left' || side === 'right';\n  const arrowRef = React.useRef();\n  const context = useFloating({\n    sameScrollView: false,\n    placement,\n    middleware: [\n      shift({ crossAxis: false, padding: gap }),\n      flip({ padding: gap }),\n      offset(gap + ARROW_HEIGHT),\n      arrow({\n        element: arrowRef,\n        padding: isHorizontal ? 0 : ARROW_WIDTH,\n      }),\n    ],\n  });\n\n  const { refs, floatingStyles } = context;\n\n  const handleOpen = React.useCallback(() => {\n    setIsOpen(true);\n    onOpenChange?.({ isOpen: true });\n  }, [onOpenChange]);\n\n  const handleClose = React.useCallback(() => {\n    setIsOpen(false);\n    onOpenChange?.({ isOpen: false });\n  }, [onOpenChange]);\n\n  // wait for animation to finish before unmounting modal\n  const [isVisible, setIsVisible] = React.useState(() => isOpen);\n  React.useEffect(() => {\n    const id = setTimeout(() => {\n      if (!isOpen) {\n        setIsVisible(false);\n      }\n    }, theme.motion.duration.gentle);\n\n    if (isOpen) {\n      setIsVisible(true);\n    }\n    return () => clearTimeout(id);\n  }, [isOpen]);\n\n  return (\n    <TooltipContext.Provider value={true}>\n      {/* Cloning the trigger children to enhance it with ref and event handler */}\n      {React.cloneElement(children, {\n        ...mergeProps(\n          {\n            onTouchEnd: children.props.onTouchEnd,\n          },\n          { onTouchEnd: handleOpen },\n        ),\n        ref: refs.setReference,\n      })}\n      <Modal accessibilityLabel={content} collapsable={false} transparent visible={isVisible}>\n        <TouchableOpacity\n          style={{\n            flexShrink: 0,\n            flex: 1,\n          }}\n          onPress={handleClose}\n          activeOpacity={1}\n          testID=\"tooltip-modal-backdrop\"\n          {...metaAttribute({ name: MetaConstants.Tooltip })}\n        >\n          <TooltipContent\n            title={title}\n            isVisible={isOpen}\n            ref={refs.setFloating}\n            side={side}\n            style={{\n              ...floatingStyles,\n              // To avoid flash of floating ui content at top, this only happens in RN <70\n              // if the position is zero move the floating element outside of the viewport\n              // this happens because measure is async and it takes few miliseconds to calculate the positions.\n              left: floatingStyles.left || -200,\n              top: floatingStyles.top || -200,\n              // TODO: Tokenize zIndex values\n              zIndex,\n            }}\n            arrow={\n              <PopupArrow\n                ref={arrowRef as never}\n                context={context}\n                width={ARROW_WIDTH}\n                height={ARROW_HEIGHT}\n                fillColor={theme.colors.popup.background.intense}\n                strokeColor={theme.colors.popup.border.intense}\n              />\n            }\n          >\n            {content}\n          </TooltipContent>\n        </TouchableOpacity>\n      </Modal>\n    </TooltipContext.Provider>\n  );\n};\n\nexport { Tooltip };\n"],"names":["Tooltip","_ref","title","content","children","_ref$placement","placement","onOpenChange","_ref$zIndex","zIndex","componentZIndices","tooltip","_useTheme","useTheme","theme","_React$useState","React","useState","_React$useState2","_slicedToArray","isOpen","setIsOpen","gap","spacing","_getFloatingPlacement","getFloatingPlacementParts","_getFloatingPlacement2","side","isHorizontal","arrowRef","useRef","context","useFloating","sameScrollView","middleware","shift","crossAxis","padding","flip","offset","ARROW_HEIGHT","arrow","element","ARROW_WIDTH","refs","floatingStyles","handleOpen","useCallback","handleClose","_React$useState3","_React$useState4","isVisible","setIsVisible","useEffect","id","setTimeout","motion","duration","gentle","clearTimeout","_jsxs","TooltipContext","Provider","value","cloneElement","Object","assign","mergeProps","onTouchEnd","props","ref","setReference","_jsx","Modal","accessibilityLabel","collapsable","transparent","visible","TouchableOpacity","style","flexShrink","flex","onPress","activeOpacity","testID","metaAttribute","name","MetaConstants","TooltipContent","setFloating","left","top","PopupArrow","width","height","fillColor","colors","popup","background","intense","strokeColor","border"],"mappings":"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"}