{"version":3,"file":"useBreakpoint.js","sources":["../../../../../src/utils/useBreakpoint/useBreakpoint.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/restrict-plus-operands */\nimport { useState, useCallback, useMemo } from 'react';\nimport { getPlatformType } from '../getPlatformType';\nimport { getMediaQuery } from '../getMediaQuery';\nimport type { Breakpoints } from '~tokens/global';\nimport { useIsomorphicLayoutEffect } from '~utils/useIsomorphicLayoutEffect';\n\nconst deviceType = {\n  desktop: 'desktop',\n  mobile: 'mobile',\n} as const;\n\ntype DeviceType = keyof typeof deviceType;\ntype Breakpoint = keyof Breakpoints | undefined;\n\ntype BreakpointAndDevice = {\n  matchedBreakpoint: Breakpoint;\n  matchedDeviceType: DeviceType;\n};\n\nexport const useBreakpoint = ({\n  breakpoints,\n}: {\n  breakpoints: Breakpoints;\n}): BreakpointAndDevice => {\n  const supportsMatchMedia =\n    typeof document !== 'undefined' &&\n    typeof window !== 'undefined' &&\n    typeof window?.matchMedia === 'function';\n\n  const breakpointsTokenAndQueryCollection = useMemo(\n    () =>\n      (supportsMatchMedia\n        ? Object.entries(breakpoints).map(([token, screenSize], index, breakpointsArray) => {\n            const min = screenSize;\n            const maxValue = breakpointsArray[index + 1]?.[1];\n            const mediaQuery = getMediaQuery({ min, max: maxValue ? maxValue - 1 : undefined });\n            return { token, screenSize, mediaQuery };\n          })\n        : []) as {\n        token: keyof Breakpoints;\n        screenSize: number;\n        mediaQuery: string;\n      }[],\n    [breakpoints, supportsMatchMedia],\n  );\n\n  const getMatchedDeviceType = useCallback((matchedBreakpoint: Breakpoint): DeviceType => {\n    let matchedDeviceType: DeviceType = deviceType.mobile;\n    const platform = getPlatformType();\n    if (platform === 'react-native') {\n      matchedDeviceType = deviceType.mobile;\n    } else if (platform === 'browser') {\n      if (matchedBreakpoint && ['base', 'xs', 's'].includes(matchedBreakpoint)) {\n        // tablet is also categorised as mobile\n        matchedDeviceType = deviceType.mobile;\n      } else {\n        matchedDeviceType = deviceType.desktop;\n      }\n    } else if (platform === 'node') {\n      //@TODO: Check for useragent for node\n      matchedDeviceType = deviceType.desktop;\n    }\n    return matchedDeviceType;\n  }, []);\n\n  const getMatchedBreakpoint = useCallback(\n    (event?: MediaQueryListEvent): Breakpoint => {\n      const matchedBreakpoint =\n        breakpointsTokenAndQueryCollection.find(({ mediaQuery = '' }) => {\n          // this will run whenever mediaQuery change event is triggered\n          if (event?.media === mediaQuery) {\n            return true;\n          }\n\n          // this will run when the state is initialised for the first time and hence the event object will be empty because the event listener wouldn't have triggered\n          if (window.matchMedia(mediaQuery).matches) {\n            return true;\n          }\n\n          return false;\n        })?.token ?? undefined;\n\n      return matchedBreakpoint;\n    },\n    [breakpointsTokenAndQueryCollection],\n  );\n\n  const [breakpointAndDevice, setBreakpointAndDevice] = useState<BreakpointAndDevice>({\n    matchedBreakpoint: undefined,\n    matchedDeviceType: deviceType.desktop,\n  });\n\n  useIsomorphicLayoutEffect(() => {\n    // set the breakpoint and devicetype for the first time because eventlisteners will only trigger after the screen is actually changed\n    setBreakpointAndDevice(() => {\n      const matchedBreakpoint = getMatchedBreakpoint();\n      const matchedDeviceType = getMatchedDeviceType(matchedBreakpoint);\n      return { matchedBreakpoint, matchedDeviceType };\n    });\n\n    // for react-native and SSR we don't need to register event listeners\n    if (!supportsMatchMedia) {\n      return undefined;\n    }\n\n    const handleMediaQueryChange = (event: MediaQueryListEvent): void => {\n      setBreakpointAndDevice(() => {\n        const matchedBreakpoint = getMatchedBreakpoint(event);\n        const matchedDeviceType = getMatchedDeviceType(matchedBreakpoint);\n        return { matchedBreakpoint, matchedDeviceType };\n      });\n    };\n\n    const mediaQueryInstances = breakpointsTokenAndQueryCollection.map(({ mediaQuery = '' }) => {\n      const mediaQueryInstance = window.matchMedia(mediaQuery);\n      /**\n       * the mediaquery event listener is available on mediaQuery instances and not `window`\n       * we iterate over all the breakpoints we have, register each instance and store them as `mediaQueryInstances` so we can later unregister all of them.\n       */\n      if (mediaQueryInstance.addEventListener) {\n        mediaQueryInstance.addEventListener('change', handleMediaQueryChange);\n      } else {\n        // In older browsers MediaQueryList do not yet inherit from EventTarget, So using addListener as fallback - https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/addListener\n        mediaQueryInstance.addListener(handleMediaQueryChange);\n      }\n      return mediaQueryInstance;\n    });\n\n    return (): void => {\n      mediaQueryInstances.forEach((mediaQueryInstance) => {\n        if (mediaQueryInstance.removeEventListener) {\n          mediaQueryInstance.removeEventListener('change', handleMediaQueryChange);\n        } else {\n          // In older browsers MediaQueryList do not yet inherit from EventTarget, So using removeListener as fallback - https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/removeListener\n          mediaQueryInstance.removeListener(handleMediaQueryChange);\n        }\n      });\n    };\n  }, [\n    breakpointsTokenAndQueryCollection,\n    getMatchedBreakpoint,\n    getMatchedDeviceType,\n    supportsMatchMedia,\n  ]);\n  return breakpointAndDevice;\n};\n\nexport type { DeviceType };\n"],"names":["deviceType","desktop","mobile","useBreakpoint","_ref","_window","breakpoints","supportsMatchMedia","document","window","matchMedia","breakpointsTokenAndQueryCollection","useMemo","Object","entries","map","_ref2","index","breakpointsArray","_breakpointsArray","_ref3","_slicedToArray","token","screenSize","min","maxValue","mediaQuery","getMediaQuery","max","undefined","getMatchedDeviceType","useCallback","matchedBreakpoint","matchedDeviceType","platform","getPlatformType","includes","getMatchedBreakpoint","event","_breakpointsTokenAndQ","_breakpointsTokenAndQ2","find","_ref4","_ref4$mediaQuery","media","matches","_useState","useState","_useState2","breakpointAndDevice","setBreakpointAndDevice","useIsomorphicLayoutEffect","handleMediaQueryChange","mediaQueryInstances","_ref5","_ref5$mediaQuery","mediaQueryInstance","addEventListener","addListener","forEach","removeEventListener","removeListener"],"mappings":"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"}