{"version":3,"file":"useControlledDropdownInput.js","sources":["../../../../../src/utils/useControlledDropdownInput/useControlledDropdownInput.tsx"],"sourcesContent":["import React from 'react';\nimport type { BaseDropdownInputTriggerProps } from '~components/Input/DropdownInputTriggers/types';\nimport isEmpty from '~utils/lodashButBetter/isEmpty';\nimport { isBrowser } from '~utils';\nimport { useFirstRender } from '~utils/useFirstRender';\nimport { fireNativeEvent } from '~utils/fireNativeEvent';\nimport { useDropdown } from '~components/Dropdown/useDropdown';\n\nexport type useControlledDropdownInputProps = Pick<\n  BaseDropdownInputTriggerProps,\n  | 'onChange'\n  | 'name'\n  | 'value'\n  | 'defaultValue'\n  | 'onInputValueChange'\n  | 'syncInputValueWithSelection'\n  | 'isSelectInput'\n> & {\n  triggererRef: React.RefObject<HTMLElement>;\n};\n\nconst useControlledDropdownInput = (props: useControlledDropdownInputProps): void => {\n  const isFirstRender = useFirstRender();\n  const {\n    changeCallbackTriggerer,\n    isControlled,\n    options,\n    selectedIndices,\n    controlledValueIndices,\n    setSelectedIndices,\n    selectionType,\n    setIsControlled,\n  } = useDropdown();\n\n  const getValuesArrayFromIndices = (): string[] => {\n    let indices: number[] = [];\n    if (isControlled) {\n      indices = controlledValueIndices;\n    } else {\n      indices = selectedIndices;\n    }\n\n    return indices.map((selectionIndex) => options[selectionIndex].value);\n  };\n\n  const selectValues = (valuesToSelect: string | string[]): void => {\n    if (options.length > 0) {\n      // we use empty `''` for clearing the input\n      if (isEmpty(valuesToSelect)) {\n        setSelectedIndices([]);\n      } else if (typeof valuesToSelect === 'string') {\n        // single select control\n        const selectedItemIndex = options.findIndex((option) => option.value === valuesToSelect);\n        if (selectedItemIndex >= 0) {\n          setSelectedIndices([selectedItemIndex]);\n        }\n      } else {\n        // multiselect control\n\n        // Handles repeated values in user state\n        const uniqueValues = Array.from(new Set(valuesToSelect));\n        // Handle selectionType single with multiselect values\n        const userValues = selectionType === 'single' ? [valuesToSelect?.[0]] : uniqueValues;\n\n        const selectedItemIndices = userValues\n          .map((optionValue) => options.findIndex((option) => option.value === optionValue))\n          .filter((value) => value >= 0);\n\n        setSelectedIndices(selectedItemIndices);\n      }\n    }\n  };\n\n  // Handles `defaultValue` prop\n  React.useEffect(() => {\n    if (options.length > 0 && props.defaultValue) {\n      selectValues(props.defaultValue);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [options.length]);\n\n  // Handles `value` prop\n  React.useEffect(() => {\n    if (options.length > 0 && props.value !== undefined) {\n      if (!isControlled) {\n        setIsControlled(true);\n      }\n\n      selectValues(props.value);\n\n      // in single select AutoComplete, we have to set inputValue of autocomplete according to the new selection.\n      if (selectionType === 'single' && !Array.isArray(props.value) && !props.isSelectInput) {\n        props.syncInputValueWithSelection?.(props.value);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.value, options]);\n\n  // onChange behaviour\n  React.useEffect(() => {\n    // Ignore calling onChange on mount\n\n    if (!isFirstRender) {\n      props.onChange?.({\n        name: props.name,\n        values: getValuesArrayFromIndices(),\n      });\n      if (isBrowser()) {\n        fireNativeEvent(props.triggererRef, ['change', 'input']);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changeCallbackTriggerer]);\n};\n\nexport { useControlledDropdownInput };\n"],"names":["useControlledDropdownInput","props","isFirstRender","useFirstRender","_useDropdown","useDropdown","changeCallbackTriggerer","isControlled","options","selectedIndices","controlledValueIndices","setSelectedIndices","selectionType","setIsControlled","getValuesArrayFromIndices","indices","map","selectionIndex","value","selectValues","valuesToSelect","length","isEmpty","selectedItemIndex","findIndex","option","uniqueValues","Array","from","Set","userValues","selectedItemIndices","optionValue","filter","React","useEffect","defaultValue","undefined","isArray","isSelectInput","syncInputValueWithSelection","onChange","name","values","isBrowser","fireNativeEvent","triggererRef"],"mappings":"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"}