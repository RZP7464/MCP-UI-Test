{"version":3,"file":"use-presence.cjs.development.js","sources":["../src/usePresence.tsx","../src/usePresenceSwitch.tsx"],"sourcesContent":["import {useEffect, useState} from 'react';\n\ntype SharedTransitionConfig = {\n  /** Duration in milliseconds used both for enter and exit transitions. */\n  transitionDuration: number;\n};\n\ntype SeparateTransitionConfig = {\n  /** Duration in milliseconds used for enter transitions (overrides `transitionDuration` if provided). */\n  enterTransitionDuration: number;\n  /** Duration in milliseconds used for exit transitions (overrides `transitionDuration` if provided). */\n  exitTransitionDuration: number;\n};\n\n/**\n * Animates the appearance of its children.\n */\nexport default function usePresence(\n  /** Indicates whether the component that the resulting values will be used upon should be visible to the user. */\n  isVisible: boolean,\n  opts: (\n    | SharedTransitionConfig\n    | SeparateTransitionConfig\n    | (SharedTransitionConfig & SeparateTransitionConfig)\n  ) & {\n    /** Opt-in to animating the entering of an element if `isVisible` is `true` during the initial mount. */\n    initialEnter?: boolean;\n  }\n) {\n  const exitTransitionDuration =\n    'exitTransitionDuration' in opts\n      ? opts.exitTransitionDuration\n      : opts.transitionDuration;\n  const enterTransitionDuration =\n    'enterTransitionDuration' in opts\n      ? opts.enterTransitionDuration\n      : opts.transitionDuration;\n\n  const initialEnter = opts.initialEnter ?? false;\n  const [animateIsVisible, setAnimateIsVisible] = useState(\n    initialEnter ? false : isVisible\n  );\n  const [isMounted, setIsMounted] = useState(isVisible);\n  const [hasEntered, setHasEntered] = useState(\n    initialEnter ? false : isVisible\n  );\n\n  const isExiting = isMounted && !isVisible;\n  const isEntering = isVisible && !hasEntered;\n  const isAnimating = isEntering || isExiting;\n\n  useEffect(() => {\n    if (isVisible) {\n      // `animateVisible` needs to be set to `true` in a second step, as\n      // when both flags would be flipped at the same time, there would\n      // be no transition. See the second effect below.\n      setIsMounted(true);\n    } else {\n      setHasEntered(false);\n      setAnimateIsVisible(false);\n\n      const timeoutId = setTimeout(() => {\n        setIsMounted(false);\n      }, exitTransitionDuration);\n\n      return () => {\n        clearTimeout(timeoutId);\n      };\n    }\n  }, [isVisible, exitTransitionDuration]);\n\n  useEffect(() => {\n    if (isVisible && isMounted && !animateIsVisible) {\n      // Force a reflow so the initial styles are flushed to the DOM\n      if (typeof document !== undefined) {\n        // We need a side effect so Terser doesn't remove this statement\n        (window as any)._usePresenceReflow = document.body.offsetHeight;\n      }\n\n      const animationFrameId = requestAnimationFrame(() => {\n        setAnimateIsVisible(true);\n      });\n\n      return () => {\n        cancelAnimationFrame(animationFrameId);\n      };\n    }\n  }, [animateIsVisible, enterTransitionDuration, isMounted, isVisible]);\n\n  useEffect(() => {\n    if (animateIsVisible && !hasEntered) {\n      const timeoutId = setTimeout(() => {\n        setHasEntered(true);\n      }, enterTransitionDuration);\n\n      return () => {\n        clearTimeout(timeoutId);\n      };\n    }\n  }, [animateIsVisible, enterTransitionDuration, hasEntered]);\n\n  return {\n    isMounted,\n    isVisible: animateIsVisible,\n    isAnimating,\n    isEntering,\n    isExiting\n  };\n}\n","import {useState, useEffect} from 'react';\nimport usePresence from './usePresence';\n\nexport default function usePresenceSwitch<ItemType>(\n  item: ItemType | undefined,\n  opts: Parameters<typeof usePresence>[1]\n) {\n  const [mountedItem, setMountedItem] = useState(item);\n  const [shouldBeMounted, setShouldBeMounted] = useState(item !== undefined);\n  const {isMounted, ...rest} = usePresence(shouldBeMounted, opts);\n\n  useEffect(() => {\n    if (mountedItem !== item) {\n      if (isMounted) {\n        setShouldBeMounted(false);\n      } else if (item !== undefined) {\n        setMountedItem(item);\n        setShouldBeMounted(true);\n      }\n    } else if (item === undefined) {\n      setShouldBeMounted(false);\n    } else if (item !== undefined) {\n      setShouldBeMounted(true);\n    }\n  }, [item, mountedItem, shouldBeMounted, isMounted]);\n\n  return {\n    ...rest,\n    isMounted: isMounted && mountedItem !== undefined,\n    mountedItem\n  };\n}\n"],"names":["usePresence","isVisible","opts","exitTransitionDuration","transitionDuration","enterTransitionDuration","initialEnter","useState","animateIsVisible","setAnimateIsVisible","isMounted","setIsMounted","hasEntered","setHasEntered","isExiting","isEntering","isAnimating","useEffect","timeoutId","setTimeout","clearTimeout","document","undefined","window","_usePresenceReflow","body","offsetHeight","animationFrameId","requestAnimationFrame","cancelAnimationFrame","usePresenceSwitch","item","mountedItem","setMountedItem","shouldBeMounted","setShouldBeMounted","rest"],"mappings":"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"}