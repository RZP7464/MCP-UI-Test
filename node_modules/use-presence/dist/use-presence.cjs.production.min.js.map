{"version":3,"file":"use-presence.cjs.production.min.js","sources":["../src/usePresence.tsx","../src/usePresenceSwitch.tsx"],"sourcesContent":["import {useEffect, useState} from 'react';\n\ntype SharedTransitionConfig = {\n  /** Duration in milliseconds used both for enter and exit transitions. */\n  transitionDuration: number;\n};\n\ntype SeparateTransitionConfig = {\n  /** Duration in milliseconds used for enter transitions (overrides `transitionDuration` if provided). */\n  enterTransitionDuration: number;\n  /** Duration in milliseconds used for exit transitions (overrides `transitionDuration` if provided). */\n  exitTransitionDuration: number;\n};\n\n/**\n * Animates the appearance of its children.\n */\nexport default function usePresence(\n  /** Indicates whether the component that the resulting values will be used upon should be visible to the user. */\n  isVisible: boolean,\n  opts: (\n    | SharedTransitionConfig\n    | SeparateTransitionConfig\n    | (SharedTransitionConfig & SeparateTransitionConfig)\n  ) & {\n    /** Opt-in to animating the entering of an element if `isVisible` is `true` during the initial mount. */\n    initialEnter?: boolean;\n  }\n) {\n  const exitTransitionDuration =\n    'exitTransitionDuration' in opts\n      ? opts.exitTransitionDuration\n      : opts.transitionDuration;\n  const enterTransitionDuration =\n    'enterTransitionDuration' in opts\n      ? opts.enterTransitionDuration\n      : opts.transitionDuration;\n\n  const initialEnter = opts.initialEnter ?? false;\n  const [animateIsVisible, setAnimateIsVisible] = useState(\n    initialEnter ? false : isVisible\n  );\n  const [isMounted, setIsMounted] = useState(isVisible);\n  const [hasEntered, setHasEntered] = useState(\n    initialEnter ? false : isVisible\n  );\n\n  const isExiting = isMounted && !isVisible;\n  const isEntering = isVisible && !hasEntered;\n  const isAnimating = isEntering || isExiting;\n\n  useEffect(() => {\n    if (isVisible) {\n      // `animateVisible` needs to be set to `true` in a second step, as\n      // when both flags would be flipped at the same time, there would\n      // be no transition. See the second effect below.\n      setIsMounted(true);\n    } else {\n      setHasEntered(false);\n      setAnimateIsVisible(false);\n\n      const timeoutId = setTimeout(() => {\n        setIsMounted(false);\n      }, exitTransitionDuration);\n\n      return () => {\n        clearTimeout(timeoutId);\n      };\n    }\n  }, [isVisible, exitTransitionDuration]);\n\n  useEffect(() => {\n    if (isVisible && isMounted && !animateIsVisible) {\n      // Force a reflow so the initial styles are flushed to the DOM\n      if (typeof document !== undefined) {\n        // We need a side effect so Terser doesn't remove this statement\n        (window as any)._usePresenceReflow = document.body.offsetHeight;\n      }\n\n      const animationFrameId = requestAnimationFrame(() => {\n        setAnimateIsVisible(true);\n      });\n\n      return () => {\n        cancelAnimationFrame(animationFrameId);\n      };\n    }\n  }, [animateIsVisible, enterTransitionDuration, isMounted, isVisible]);\n\n  useEffect(() => {\n    if (animateIsVisible && !hasEntered) {\n      const timeoutId = setTimeout(() => {\n        setHasEntered(true);\n      }, enterTransitionDuration);\n\n      return () => {\n        clearTimeout(timeoutId);\n      };\n    }\n  }, [animateIsVisible, enterTransitionDuration, hasEntered]);\n\n  return {\n    isMounted,\n    isVisible: animateIsVisible,\n    isAnimating,\n    isEntering,\n    isExiting\n  };\n}\n","import {useState, useEffect} from 'react';\nimport usePresence from './usePresence';\n\nexport default function usePresenceSwitch<ItemType>(\n  item: ItemType | undefined,\n  opts: Parameters<typeof usePresence>[1]\n) {\n  const [mountedItem, setMountedItem] = useState(item);\n  const [shouldBeMounted, setShouldBeMounted] = useState(item !== undefined);\n  const {isMounted, ...rest} = usePresence(shouldBeMounted, opts);\n\n  useEffect(() => {\n    if (mountedItem !== item) {\n      if (isMounted) {\n        setShouldBeMounted(false);\n      } else if (item !== undefined) {\n        setMountedItem(item);\n        setShouldBeMounted(true);\n      }\n    } else if (item === undefined) {\n      setShouldBeMounted(false);\n    } else if (item !== undefined) {\n      setShouldBeMounted(true);\n    }\n  }, [item, mountedItem, shouldBeMounted, isMounted]);\n\n  return {\n    ...rest,\n    isMounted: isMounted && mountedItem !== undefined,\n    mountedItem\n  };\n}\n"],"names":["usePresence","isVisible","opts","exitTransitionDuration","transitionDuration","enterTransitionDuration","initialEnter","useState","animateIsVisible","setAnimateIsVisible","isMounted","setIsMounted","hasEntered","setHasEntered","isExiting","isEntering","isAnimating","useEffect","timeoutId","setTimeout","clearTimeout","undefined","document","window","_usePresenceReflow","body","offsetHeight","animationFrameId","requestAnimationFrame","cancelAnimationFrame","item","mountedItem","setMountedItem","shouldBeMounted","setShouldBeMounted","rest"],"mappings":"oGAiBwBA,EAEtBC,EACAC,SASMC,EACJ,2BAA4BD,EACxBA,EAAKC,uBACLD,EAAKE,mBACLC,EACJ,4BAA6BH,EACzBA,EAAKG,wBACLH,EAAKE,mBAELE,WAAeJ,EAAKI,mBACsBC,YAC9CD,GAAuBL,GADlBO,OAAkBC,SAGSF,WAASN,GAApCS,OAAWC,SACkBJ,YAClCD,GAAuBL,GADlBW,OAAYC,OAIbC,EAAYJ,IAAcT,EAC1Bc,EAAad,IAAcW,EAC3BI,EAAcD,GAAcD,SAElCG,aAAU,eACJhB,EAKG,CACLY,GAAc,GACdJ,GAAoB,OAEdS,EAAYC,YAAW,WAC3BR,GAAa,KACZR,UAEI,WACLiB,aAAaF,IAVfP,GAAa,KAad,CAACV,EAAWE,IAEfc,aAAU,cACJhB,GAAaS,IAAcF,EAAkB,MAEvBa,WAAbC,WAERC,OAAeC,mBAAqBF,SAASG,KAAKC,kBAG/CC,EAAmBC,uBAAsB,WAC7CnB,GAAoB,aAGf,WACLoB,qBAAqBF,OAGxB,CAACnB,EAAkBH,EAAyBK,EAAWT,IAE1DgB,aAAU,cACJT,IAAqBI,EAAY,KAC7BM,EAAYC,YAAW,WAC3BN,GAAc,KACbR,UAEI,WACLe,aAAaF,OAGhB,CAACV,EAAkBH,EAAyBO,IAExC,CACLF,UAAAA,EACAT,UAAWO,EACXQ,YAAAA,EACAD,WAAAA,EACAD,UAAAA,uQCtGFgB,EACA5B,SAEsCK,WAASuB,GAAxCC,OAAaC,SAC0BzB,gBAAkBc,IAATS,GAAhDG,OAAiBC,SACKlC,EAAYiC,EAAiB/B,GAAnDQ,IAAAA,UAAcyB,6JAErBlB,aAAU,WACJc,IAAgBD,EACdpB,EACFwB,GAAmB,QACDb,IAATS,IACTE,EAAeF,GACfI,GAAmB,SAEHb,IAATS,EACTI,GAAmB,QACDb,IAATS,GACTI,GAAmB,KAEpB,CAACJ,EAAMC,EAAaE,EAAiBvB,SAGnCyB,GACHzB,UAAWA,QAA6BW,IAAhBU,EACxBA,YAAAA"}